% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  11pt,
  oneside,
  article]{memoir}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\newenvironment{Shaded}{}{}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.50,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.50,0.00}{\textbf{#1}}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\settrims{0pt}{0pt} % page and stock same size
\settypeblocksize{*}{34.5pc}{*} % {height}{width}{ratio}
\setlrmargins{*}{*}{1} % {spine}{edge}{ratio}
\setulmarginsandblock{.98in}{.98in}{*} % height of typeblock computed
\setheadfoot{\onelineskip}{2\onelineskip} % {headheight}{footskip}
\setheaderspaces{*}{1.5\onelineskip}{*} % {headdrop}{headsep}{ratio}
\checkandfixthelayout


\usepackage{amsthm}
\usepackage{mathtools}

\usepackage[inline]{enumitem}
\usepackage{ifthen}
\usepackage[utf8]{inputenc} %allows non-ascii in bib file
\usepackage{xcolor}

\usepackage{newunicodechar}
\newunicodechar{Œª}{\ensuremath{\mathnormal\lambda}}
\newunicodechar{‚àÄ}{\ensuremath{\mathnormal\forall}}
\newunicodechar{‚â°}{\ensuremath{\mathnormal\equiv}}
\newunicodechar{‚Ñì}{\ensuremath{\mathnormal\ell}}
\newunicodechar{Œ∫}{\ensuremath{\mathnormal\kappa}}
\newunicodechar{Œ£}{\ensuremath{\mathnormal\Sigma}}
\newunicodechar{‚äî}{\ensuremath{\mathnormal\sqcup}}
\newunicodechar{‚ô≠}{\ensuremath{\mathnormal\flat}}
\newunicodechar{Œµ}{\ensuremath{\mathnormal\epsilon}}
\newunicodechar{‚ÇÄ}{\ensuremath{\mathnormal{_0}}}
\newunicodechar{‚ä•}{\ensuremath{\mathnormal\bot}}
\newunicodechar{‚ä§}{\ensuremath{\mathnormal\top}}
\newunicodechar{Œ±}{\ensuremath{\mathnormal\alpha}}
\newunicodechar{Œ≤}{\ensuremath{\mathnormal\beta}}
\newunicodechar{Œ∑}{\ensuremath{\mathnormal\eta}}
\newunicodechar{‚Åª}{\ensuremath{\mathnormal{^-}}}
\newunicodechar{¬π}{\ensuremath{\mathnormal{^1}}}
\newunicodechar{‚Ñï}{\ensuremath{\mathbb{N}}}
\newunicodechar{œâ}{\ensuremath{\mathnormal\omega}}
\newunicodechar{‚àò}{\ensuremath{\mathnormal\circ}}
\newunicodechar{‚óÉ}{\ensuremath{\mathnormal\triangleleft}}
\newunicodechar{‚äó}{\ensuremath{\mathnormal\otimes}}
\newunicodechar{‚ñ°}{\ensuremath{\mathnormal\Box}}
\newunicodechar{‚à•}{\ensuremath{\mathnormal\Vert}}
\newunicodechar{‚áÜ}{\ensuremath{\mathnormal\leftrightarrows}}
\newunicodechar{ùì§}{\ensuremath{\mathnormal\mathcal{U}}}
\newunicodechar{ùî≤}{\ensuremath{\mathnormal\mathfrak{u}}}
\newunicodechar{‚ôØ}{\ensuremath{\mathnormal\sharp}}
\newunicodechar{œÉ}{\ensuremath{\mathnormal\sigma}}
\newunicodechar{Œ†}{\ensuremath{\mathnormal\Pi}}
\newunicodechar{ùï™}{\ensuremath{\mathnormal y}}
\newunicodechar{‚âÉ}{\ensuremath{\mathnormal\simeq}}
\newunicodechar{Œº}{\ensuremath{\mathnormal\mu}}
\newunicodechar{œÅ}{\ensuremath{\mathnormal\rho}}
\newunicodechar{‚áà}{\ensuremath{\mathnormal\upuparrows}}
\newunicodechar{œÄ}{\ensuremath{\mathnormal\pi}}
\newunicodechar{Œ≥}{\ensuremath{\mathnormal\gamma}}
\newunicodechar{Œ¥}{\ensuremath{\mathnormal\delta}}
\newunicodechar{œú}{\ensuremath{\mathnormal\digamma}}
\newunicodechar{ùîΩ}{\ensuremath{\mathnormal\mathbb{F}}}
\newunicodechar{‚Ñô}{\ensuremath{\mathnormal\mathbb{P}}}
\newunicodechar{‚Üî}{\ensuremath{\mathnormal\leftrightarrow}}
\newunicodechar{‚â∫}{\ensuremath{\mathnormal\prec}}
\newunicodechar{‚Çò}{\ensuremath{\mathnormal{_m}}}
\newunicodechar{‚Çô}{\ensuremath{\mathnormal{_m}}}
\newunicodechar{ùì•}{\ensuremath{\mathnormal\mathcal{V}}}
\newunicodechar{ùî≥}{\ensuremath{\mathnormal\mathfrak{v}}}
\newunicodechar{‚ÇÅ}{\ensuremath{\mathnormal{_1}}}
\newunicodechar{‚Åº}{\ensuremath{\mathnormal{^=}}}


\usepackage[backend=biber, backref=true, maxbibnames = 10, style = alphabetic]{biblatex}
\usepackage[bookmarks=true, colorlinks=true, linkcolor=blue!50!black,
citecolor=orange!50!black, urlcolor=orange!50!black, pdfencoding=unicode]{hyperref}
\usepackage[capitalize]{cleveref}

\usepackage{tikz}

\usepackage{amssymb}
\usepackage{newpxtext}
\usepackage[varg,bigdelims]{newpxmath}
\usepackage{mathrsfs}
\usepackage{dutchcal}
\usepackage{fontawesome}
\usepackage{ebproof}
\usepackage{stmaryrd}
\usepackage{mathpartir}
\usepackage{quiver}


% cleveref %
  \newcommand{\creflastconjunction}{, and\nobreakspace} % serial comma
  \crefformat{enumi}{\##2#1#3}
  \crefalias{chapter}{section}


% biblatex %
  \addbibresource{Library20211226.bib} 

% hyperref %
  \hypersetup{final}

% enumitem %
  \setlist{nosep}
  \setlistdepth{6}



% tikz %



  \usetikzlibrary{ 
  	cd,
  	math,
  	decorations.markings,
		decorations.pathreplacing,
  	positioning,
  	arrows.meta,
  	shapes,
		shadows,
		shadings,
  	calc,
  	fit,
  	quotes,
  	intersections,
    circuits,
    circuits.ee.IEC
  }
  
  \tikzset{
biml/.tip={Glyph[glyph math command=triangleleft, glyph length=.95ex]},
bimr/.tip={Glyph[glyph math command=triangleright, glyph length=.95ex]},
}

\tikzset{
	tick/.style={postaction={
  	decorate,
    decoration={markings, mark=at position 0.5 with
    	{\draw[-] (0,.4ex) -- (0,-.4ex);}}}
  }
} 
\tikzset{
	slash/.style={postaction={
  	decorate,
    decoration={markings, mark=at position 0.5 with
    	{\draw[-] (.3ex,.3ex) -- (-.3ex,-.3ex);}}}
  }
} 

\newcommand{\upp}{\begin{tikzcd}[row sep=6pt]~\\~\ar[u, bend left=50pt, looseness=1.3, start anchor=east, end anchor=east]\end{tikzcd}}

\newcommand{\bito}[1][]{
	\begin{tikzcd}[ampersand replacement=\&, cramped]\ar[r, biml-bimr, "#1"]\&~\end{tikzcd}  
}
\newcommand{\bifrom}[1][]{
	\begin{tikzcd}[ampersand replacement=\&, cramped]\ar[r, bimr-biml, "{#1}"]\&~\end{tikzcd}  
}
\newcommand{\bifromlong}[2][]{
	\begin{tikzcd}[ampersand replacement=\&, column sep=#2, cramped]\ar[r, bimr-biml, "#1"]\&~\end{tikzcd}  
}

% Adjunctions
\newcommand{\adj}[5][30pt]{%[size] Cat L, Left, Right, Cat R.
\begin{tikzcd}[ampersand replacement=\&, column sep=#1]
  #2\ar[r, shift left=7pt, "#3"]
  \ar[r, phantom, "\scriptstyle\Rightarrow"]\&
  #5\ar[l, shift left=7pt, "#4"]
\end{tikzcd}
}

\newcommand{\adjr}[5][30pt]{%[size] Cat R, Right, Left, Cat L.
\begin{tikzcd}[ampersand replacement=\&, column sep=#1]
  #2\ar[r, shift left=7pt, "#3"]\&
  #5\ar[l, shift left=7pt, "#4"]
  \ar[l, phantom, "\scriptstyle\Leftarrow"]
\end{tikzcd}
}

\newcommand{\xtickar}[1]{\begin{tikzcd}[baseline=-0.5ex,cramped,sep=small,ampersand 
replacement=\&]{}\ar[r,tick, "{#1}"]\&{}\end{tikzcd}}
\newcommand{\xslashar}[1]{\begin{tikzcd}[baseline=-0.5ex,cramped,sep=small,ampersand 
replacement=\&]{}\ar[r,tick, "{#1}"]\&{}\end{tikzcd}}



  
  % amsthm %
\theoremstyle{definition}
\newtheorem{definitionx}{Definition}[chapter]
\newtheorem{examplex}[definitionx]{Example}
\newtheorem{remarkx}[definitionx]{Remark}
\newtheorem{notation}[definitionx]{Notation}


\theoremstyle{plain}

\newtheorem{theorem}[definitionx]{Theorem}
\newtheorem{proposition}[definitionx]{Proposition}
\newtheorem{corollary}[definitionx]{Corollary}
\newtheorem{lemma}[definitionx]{Lemma}
\newtheorem{warning}[definitionx]{Warning}
\newtheorem*{theorem*}{Theorem}
\newtheorem*{proposition*}{Proposition}
\newtheorem*{corollary*}{Corollary}
\newtheorem*{lemma*}{Lemma}
\newtheorem*{warning*}{Warning}
%\theoremstyle{definition}
%\newtheorem{definition}[theorem]{Definition}
%\newtheorem{construction}[theorem]{Construction}

\newenvironment{example}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{$\lozenge$}\examplex}
  {\popQED\endexamplex}
  
 \newenvironment{remark}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{$\lozenge$}\remarkx}
  {\popQED\endremarkx}
  
  \newenvironment{definition}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{$\lozenge$}\definitionx}
  {\popQED\enddefinitionx} 

    
%-------- Single symbols --------%
	
\DeclareSymbolFont{stmry}{U}{stmry}{m}{n}
\DeclareMathSymbol\fatsemi\mathop{stmry}{"23}

\DeclareFontFamily{U}{mathx}{\hyphenchar\font45}
\DeclareFontShape{U}{mathx}{m}{n}{
      <5> <6> <7> <8> <9> <10>
      <10.95> <12> <14.4> <17.28> <20.74> <24.88>
      mathx10
      }{}
\DeclareSymbolFont{mathx}{U}{mathx}{m}{n}
\DeclareFontSubstitution{U}{mathx}{m}{n}
\DeclareMathAccent{\widecheck}{0}{mathx}{"71}


%-------- Renewed commands --------%

\renewcommand{\ss}{\subseteq}

%-------- Other Macros --------%


\DeclarePairedDelimiter{\present}{\langle}{\rangle}
\DeclarePairedDelimiter{\copair}{[}{]}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\corners}{\ulcorner}{\urcorner}
\DeclarePairedDelimiter{\ihom}{[}{]}

\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Mor}{Mor}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\cod}{cod}
\DeclareMathOperator{\idy}{idy}
\DeclareMathOperator{\comp}{com}
\DeclareMathOperator*{\colim}{colim}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\ob}{Ob}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\el}{El}




\newcommand{\const}[1]{\texttt{#1}}%a constant, or named element of a set
\newcommand{\Set}[1]{\mathsf{#1}}%a named set
\newcommand{\ord}[1]{\mathsf{#1}}%an ordinal
\newcommand{\cat}[1]{\mathcal{#1}}%a generic category
\newcommand{\Cat}[1]{\mathbf{#1}}%a named category
\newcommand{\fun}[1]{\mathrm{#1}}%a function
\newcommand{\Fun}[1]{\mathit{#1}}%a named functor




\newcommand{\id}{\mathrm{id}}
\newcommand{\then}{\mathbin{\fatsemi}}

\newcommand{\cocolon}{:\!}


\newcommand{\iso}{\cong}
\newcommand{\too}{\longrightarrow}
\newcommand{\tto}{\rightrightarrows}
\newcommand{\To}[2][]{\xrightarrow[#1]{#2}}
\renewcommand{\Mapsto}[1]{\xmapsto{#1}}
\newcommand{\Tto}[3][13pt]{\begin{tikzcd}[sep=#1, cramped, ampersand replacement=\&, text height=1ex, text depth=.3ex]\ar[r, shift left=2pt, "#2"]\ar[r, shift right=2pt, "#3"']\&{}\end{tikzcd}}
\newcommand{\Too}[1]{\xrightarrow{\;\;#1\;\;}}
\newcommand{\from}{\leftarrow}
\newcommand{\ffrom}{\leftleftarrows}
\newcommand{\From}[1]{\xleftarrow{#1}}
\newcommand{\Fromm}[1]{\xleftarrow{\;\;#1\;\;}}
\newcommand{\surj}{\twoheadrightarrow}
\newcommand{\inj}{\rightarrowtail}
\newcommand{\wavyto}{\rightsquigarrow}
\newcommand{\lollipop}{\multimap}
\newcommand{\imp}{\Rightarrow}
\renewcommand{\iff}{\Leftrightarrow}
\newcommand{\down}{\mathbin{\downarrow}}
\newcommand{\fromto}{\leftrightarrows}
\newcommand{\tickar}{\xtickar{}}
\newcommand{\slashar}{\xslashar{}}



\newcommand{\inv}{^{-1}}
\newcommand{\op}{^\tn{op}}

\newcommand{\tn}[1]{\textnormal{#1}}
\newcommand{\ol}[1]{\overline{#1}}
\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\wt}[1]{\widetilde{#1}}
\newcommand{\wh}[1]{\widehat{#1}}
\newcommand{\wc}[1]{\widecheck{#1}}
\newcommand{\ubar}[1]{\underaccent{\bar}{#1}}



\newcommand{\bb}{\mathbb{B}}
\newcommand{\cc}{\mathbb{C}}
\newcommand{\nn}{\mathbb{N}}
\newcommand{\pp}{\mathbb{P}}
\newcommand{\qq}{\mathbb{Q}}
\newcommand{\zz}{\mathbb{Z}}
\newcommand{\rr}{\mathbb{R}}


\newcommand{\finset}{\Cat{Fin}}
\newcommand{\smset}{\Cat{Set}}
\newcommand{\smcat}{\Cat{Cat}}
\newcommand{\catsharp}{\Cat{Cat}^{\sharp}}
\newcommand{\ppolyfun}{\mathbb{P}\Cat{olyFun}}
\newcommand{\ccatsharp}{\mathbb{C}\Cat{at}^{\sharp}}
\newcommand{\ccatsharpdisc}{\mathbb{C}\Cat{at}^{\sharp}_{\tn{disc}}}
\newcommand{\ccatsharplin}{\mathbb{C}\Cat{at}^{\sharp}_{\tn{lin}}}
\newcommand{\ccatsharpdisccon}{\mathbb{C}\Cat{at}^{\sharp}_{\tn{disc,con}}}
\newcommand{\sspan}{\mathbb{S}\Cat{pan}}
\newcommand{\en}{\Cat{End}}

\newcommand{\List}{\Fun{List}}
\newcommand{\set}{\tn{-}\Cat{Set}}




\newcommand{\yon}{\mathcal{y}}
\newcommand{\poly}{\Cat{Poly}}
\newcommand{\polycart}{\poly^{\Cat{Cart}}}
\newcommand{\ppoly}{\mathbb{P}\Cat{oly}}
\newcommand{\0}{\textsf{0}}
\newcommand{\1}{\tn{\textsf{1}}}
\newcommand{\U}{\tn{\textsf{U}}}
\newcommand{\tri}{\mathbin{\triangleleft}}
\newcommand{\triright}{\mathbin{\triangleright}}
\newcommand{\tripow}[1]{^{\tri #1}}
\newcommand{\indep}{\Fun{Indep}}
\newcommand{\duoid}{\Fun{Duoid}}
\newcommand{\jump}{\pi}
\newcommand{\jumpmap}{\ol{\jump}}
\newcommand{\founds}{\Yleft}


% lenses
\newcommand{\biglens}[2]{
     \begin{bmatrix}{\vphantom{f_f^f}#2} \\ {\vphantom{f_f^f}#1} \end{bmatrix}
}
\newcommand{\littlelens}[2]{
     \begin{bsmallmatrix}{\vphantom{f}#2} \\ {\vphantom{f}#1} \end{bsmallmatrix}
}
\newcommand{\lens}[2]{
  \relax\if@display
     \biglens{#1}{#2}
  \else
     \littlelens{#1}{#2}
  \fi
}



\newcommand{\qand}{\quad\text{and}\quad}
\newcommand{\qqand}{\qquad\text{and}\qquad}


\newcommand{\coto}{\nrightarrow}
\newcommand{\cofun}{{\raisebox{2pt}{\resizebox{2.5pt}{2.5pt}{$\setminus$}}}}

\newcommand{\coalg}{\tn{-}\Cat{Coalg}}

\newcommand{\bic}[2]{{}_{#1}\Cat{Comod}_{#2}}

% ---- Changeable document parameters ---- %

\linespread{1.1}
\allowdisplaybreaks
\setsecnumdepth{subsection}
\settocdepth{subsection}
\setlength{\parindent}{15pt}
\setcounter{tocdepth}{1}
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Polynomial Universes and Dependent Types},
  pdfauthor={C.B. Aberl√©; David I. Spivak},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Polynomial Universes and Dependent Types}
\author{C.B. Aberl√© \and David I. Spivak}
\date{}

\begin{document}
\makeatletter
\@ifclassloaded{memoir}{\ifartopt\else\frontmatter\fi}{\frontmatter}
\makeatother
\maketitle

\makeatletter
\@ifclassloaded{memoir}{\ifartopt\else\mainmatter\fi}{\mainmatter}
\makeatother
\begin{abstract}

Awodey, later with Newstead, showed how polynomial pseudomonads $(u,\1,\Sigma)$ with extra structure (termed "natural models" by Awodey) hold within them the categorical semantics for dependent type theory. Their work presented these ideas clearly but ultimately led them outside of the category of polynomial functors in order to explain all of the structure possessed by such models of type theory.

This paper builds off that work---explicating the categorical semantics of dependent type theory by axiomatizing them \emph{entirely} in the language of polynomial functors. In order to handle the higher-categorical coherences required for such an explanation, we work with polynomial functors internally in the language of Homotopy Type Theory, which allows for higher-dimensional structures such as pseudomonads, etc. to be expressed purely in terms of the structure of a suitably-chosen $\infty$-category of polynomial functors. The move from set theory to Homotopy Type Theory thus has a twofold effect of enabling a simpler exposition of natural models, which is at the same time amenable to formalization in a proof assistant, such as Agda.

Moreover, the choice to remain firmly within the setting of polynomial functors reveals many additional structures of natural models that were otherwise left implicit or not considered by Awodey \& Newstead. Chief among these, we highlight the fact that every polynomial pseudomonad $(u,\1,\Sigma)$ as above that is also equipped with structure to interpret dependent product types gives rise to a self-distributive law $u\tri u\to u\tri u$, which witnesses the usual distributive law of dependent products over dependent sums.

\end{abstract}

\chapter{Introduction}\label{introduction}

The central idea of dependent type theory (c.f.
\cite{martin-lof1975intuitionistic}) is that \emph{order of events} is
fundamental to the mathematical story arc: when playing out any specific
example story within that arc, the beginning of the story affects not
only the later events, but even the very terms with which the later
events will be described. For example, in the story arc of conditional
probability, one may say ``now if the set \(P\) that we are asked to
condition on happens to have measure zero, we must stop; but assuming
that's not the case then the result will be a new probability
measure.'\,' Here the story teller is saying that no terms will describe
what happens if \(P\) has measure zero, whereas otherwise the terms of
standard probability will apply.

Dependent types form a logical system with syntax, rules of computation,
and robust categorical semantics. In
\cite{awodey2014natural,awodey2018polynomial}, Awodey and later Newstead
show that there is a strong connection between dependent type theory and
polynomial functors, via their concept of \emph{natural models}, which
cleanly solve the problem of \emph{strictififying} certain identities
that typically hold only up to isomorphism in arbitrary categories, but
must hold \emph{strictly} in order for these to soundly model dependent
type theory. The solution to this problem offered by Awodey and Newstead
makes use of the type-theoretic concept of a \emph{universe}. Such
universes then turn out to naturally be regarded as polynomial functors
on a suitably-chosen category of presheaves, satisfying a certain
\emph{representability} condition.

Although the elementary structure of natural models is thus
straightforwardly described by considering them as objects in a category
of polynomial functors, Awodey and Newstead were ultimately led outside
of this category in order to fully explicate those parts of natural
models that require identities to hold only \emph{up to isomorphism},
rather than strictly. There is thus an evident tension between
\emph{strict} and \emph{weak} identities that has not yet been fully
resolved in the story of natural models. In the present work, we build
on Awodey and Newstead's work to fully resolve this impasse by showing
how type universes can be fully axiomatized in terms of polynomial
functors, by working with polynomial functors internally in the language
of \emph{Homotopy Type Theory} (HoTT) \cite{Voevodsky:2013a}. We thus
come full circle from Awodey's original motivation to develop natural
models \emph{of} Homotopy Type Theory, to describing natural models
\emph{in} Homotopy Type Theory.

The ability for us to tell the story of natural models as set entirely
in the category of polynomial functors has a great simplifying effect
upon the resultant theory, and reveals many additional structures, both
of polynomial universes, and of the category of polynomial functors as a
whole. As an illustration of this, we show how every polynomial universe
\(u\), regarded as a polynomial pseudomonad with additional structure,
gives rise to self-distributive law \(u\tri u\to u\tri u\), which in
particular witnesses the usual distributive law of dependent products
over dependent sums. In fact, just as polynomial universes closed under
unit and dependent pair types can be characterized as Cartesian monads
in the category \(\poly\) of polynomial endofunctors, so too can
polynomial universes closed under unit, dependent pair, and dependent
product types be characterized as Cartesian monads in \(\poly\) that
additionally carry a Cartesian distributive law of this monad over
itself (for a suitable notion of \emph{Cartesian distributive law,}
defined in Section 5.3). This characterization constitutes the main
theorem of this paper.

Moreover, the move from set theory to HoTT as a setting in which to tell
this story enables new tools to be applied for its telling. In
particular, the account of polynomial universes we develop is
well-suited to formalization in a proof assistant, and we present such a
formalization in Agda. This paper is thus itself a literate Agda
document in which all results have been fully formalized and checked for
validity.

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{\{{-}\# OPTIONS {-}{-}without{-}K {-}{-}rewriting \#{-}\}}
\KeywordTok{module}\NormalTok{ poly{-}universes }\KeywordTok{where}
\end{Highlighting}
\end{Shaded}

The structure of this paper is as follows:

\begin{itemize}
\tightlist
\item
  In Section 2, we give an introductory presentation of dependent type
  theory and natural models, followed by a recap the basics of HoTT that
  will be used throughout the rest of the paper.
\item
  In Section 3, we outline the basic theory of polynomial functors in
  HoTT, culminating in a demonstration of how to model dependent pair
  types using polynomial functors. In order to show that these
  polynomial functors are in fact monads, however, we will need some
  additional technology, to which we devote the following section.
\item
  In Section 4, we introduce the key concept of a \emph{polynomial
  universe} as a polynomial functor satisfying a certain
  \emph{univalence} condition, that allows us to straightforwardly
  derive the monad laws for polynomial universes equipped with the
  structure to interpret dependent pair types.
\item
  In Section 5, building on the ideas of the previous sections, we show
  how to model dependent function types with polynomial functors, and
  demonstrate that any polynomial universe equipped with this structure
  -- along with the aforementioned structure for interpreting dependent
  pair types -- gives rise to a self-distributive law of the
  corresponding monad.
\item
  In Section 6, we conclude the paper by sketching how this theory may
  be further developed to handle identity types, inductive types, and
  other key concepts from dependent type theory.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{open} \KeywordTok{import}\NormalTok{ Agda}\OtherTok{.}\NormalTok{Primitive}
\KeywordTok{open} \KeywordTok{import}\NormalTok{ Agda}\OtherTok{.}\NormalTok{Builtin}\OtherTok{.}\NormalTok{Sigma}
\KeywordTok{open} \KeywordTok{import}\NormalTok{ Agda}\OtherTok{.}\NormalTok{Builtin}\OtherTok{.}\NormalTok{Unit}
\end{Highlighting}
\end{Shaded}

\chapter{Background on Type Theory, Natural Models \&
HoTT}\label{background-on-type-theory-natural-models-hott}

We begin with a recap of natural models, dependent type theory, and
HoTT, taking this also as an opportunity to introduce the basics of our
Agda formalization.

\section{Dependent Types and their Categorical
Semantics}\label{dependent-types-and-their-categorical-semantics}

The question ``what is a type'' is as deep as it is philosophically
fraught. For present purposes, however, we need not concern ourselves so
much directly with what (dependent) type \emph{are}, as with what they
can \emph{do}, and how best to mathematically model this behavior.
Suffice it to say, then, that a type specifies rules for both
constructing and using the \emph{inhabitants} of that type in arbitrary
contexts of usage. Following standard conventions, we use the notation
\texttt{a\ :\ A} to mean that \texttt{a} is an inhabitant of type
\texttt{A}.

In Agda, one example of such a type is the \emph{unit type} \texttt{‚ä§},
which is defined to have a single inhabitant \texttt{tt\ :\ ‚ä§}, such
that for any other inhabitant \texttt{x\ :\ ‚ä§} we must have
\texttt{x\ =\ tt}.

Another type (or rather, family of types) of particular importance is
the \emph{universe} of types \texttt{Type}, whose inhabitants themsleves
represent types.\footnote{For consistency with the usage of the term
  ``set'' in HoTT (whereby sets are types satisfying a certain
  \emph{truncation} condition, to be explained shortly,) we relabel
  Agda's universes of types as \texttt{Type}, rather than the default
  \texttt{Set}. We also note in passing that, due to size issues, the
  universe \texttt{Type} is not in fact one type, but rather a whole
  family of types, stratified by a hierarchy of \emph{levels.} However,
  this structure of levels is not of much concern to us in this paper,
  so we shall do our best to ignore it.} So e.g.~to say that \texttt{‚ä§},
as defined above, is a type, we may simply write \texttt{‚ä§\ :\ Type}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Type }\OtherTok{:} \OtherTok{(}\NormalTok{‚Ñì }\OtherTok{:}\NormalTok{ Level}\OtherTok{)} \OtherTok{‚Üí} \DataTypeTok{Set} \OtherTok{(}\NormalTok{lsuc ‚Ñì}\OtherTok{)}
\NormalTok{Type ‚Ñì }\OtherTok{=} \DataTypeTok{Set}\NormalTok{ ‚Ñì}
\end{Highlighting}
\end{Shaded}

Given a type \texttt{A}, one may in turn consider families of types
\texttt{B\ x} indexed by, or \emph{dependent} upon aribtrary inhabitants
\texttt{x\ :\ A}. In agda, we represent such a type family \texttt{B} as
a function \texttt{A\ ‚Üí\ Type}.

Given a type \texttt{A\ :\ Type} and a family of types
\texttt{B\ :\ A\ ‚Üí\ Type} as above, two key examples of types we may
construct are:

\begin{itemize}
\tightlist
\item
  The \emph{dependent function type} \texttt{(x\ :\ A)\ ‚Üí\ B\ x}, whose
  inhabitants are functions \texttt{Œª\ x\ ‚Üí\ f\ x} such that, for all
  \texttt{a\ :\ A}, we have \texttt{f\ a\ :\ B\ a}.
\item
  The \emph{dependent pair type} \texttt{Œ£\ A\ B}, whose inhabitants are
  of the form \texttt{(a\ ,\ b)} for \texttt{a\ :\ A} and
  \texttt{b\ :\ B\ a}, such that there are functions
  \texttt{fst\ :\ Œ£\ A\ B\ ‚Üí\ A} and
  \texttt{snd\ :\ (p\ :\ Œ£\ A\ B)\ ‚Üí\ B\ (fst\ p)}.
\end{itemize}

Note that in the case where \texttt{B} does not depend upon
\texttt{x\ :\ A} (i.e.~the variable \texttt{x} does not appear in the
expression for \texttt{B}), these correspond to the more familiar
function type \texttt{A\ ‚Üí\ B} and pair type \texttt{A\ √ó\ B},
respectively. E.g. we can define the Cartesian product of two types
\texttt{A} and \texttt{B} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{√ó}\OtherTok{\_} \OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{)} \OtherTok{(}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Type }\OtherTok{(}\NormalTok{‚Ñì ‚äî Œ∫}\OtherTok{)}
\NormalTok{A √ó B }\OtherTok{=}\NormalTok{ Œ£ A }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

In more traditional type-theoretic notation, one might see the rules for
these types written as follows: \[ 
\inferrule{~}{\Gamma \vdash \top : \mathsf{Type}} \qquad \inferrule{~}{\Gamma \vdash \mathsf{tt} : \top} \qquad \inferrule{\Gamma \vdash x : \top}{\Gamma \vdash x = tt}
\] \[
\inferrule{\Gamma \vdash A : \mathsf{Type}\\ \Gamma, x : A \vdash B[x] : \mathsf{Type}}{\Gamma \vdash \Pi x : A . B[x] : \mathsf{Type}} \qquad \inferrule{\Gamma \vdash A : \mathsf{Type}\\ \Gamma, x : A \vdash B[x] : \mathsf{Type}}{\Gamma \vdash \Sigma x : A . B[x] : \mathsf{Type}}
\] \[
\inferrule{\Gamma, x : A \vdash f[x] : B[x]}{\Gamma \vdash \lambda x . f[x] : \Pi x : A . B[x]} \qquad \inferrule{\Gamma \vdash a : A\\ \Gamma \vdash b : B[a]}{\Gamma \vdash (a , b) : \Sigma x : A . B[x]}
\] \[
\inferrule{\Gamma \vdash f : \Pi x : A . B[x]\\ \Gamma \vdash a : A}{\Gamma \vdash f a : B[a]} \qquad \inferrule{\Gamma \vdash p : \Sigma x : A . B[x]}{\Gamma \vdash \pi_1(p) : A} \quad \inferrule{\Gamma \vdash p : \Sigma x : A . B[x]}{\Gamma \vdash \pi_2(p) : B[\pi_1(p)]}
\] \[
(\lambda x . f[x]) a = f[a] \qquad \pi_1(a , b) = a \quad \pi_2(a , b) = b
\] \[
f = \lambda x . fx \qquad p = (\pi_1(p) , \pi_2(p))
\]

The constructors \(\lambda\) and \((- , -)\) are called the
\emph{introduction} forms of \(\Pi x : A . B[x]\) and
\(\Sigma x : A . B[x]\), while \(f a\) and \(\pi_1(p), ~ \pi_2(p)\) are
called the \emph{elimination} forms of these types, respectively. One
may wonder why all typing judgments in the above rules have been
decorated with annotations of the form \(\Gamma \vdash\), for some
\(\Gamma\). In these cases, \(\Gamma\) is the \emph{context} of the
corresponding judgment, used to keep track of the types of variables
that may appear in that judgment.

Although contexts may seem rather trivial from a syntactic perspective,
they are key to understanding the categorical semantics of dependent
type theory. In particular, when modelling a dependent type theory as a
category, it is the \emph{contexts} which form the objects of this
category, with morphisms between contexts being \emph{substitutions} of
terms in the domain context for the variables of the codomain context. A
type \(A\) dependent upon variables in a context \(\Gamma\) is then
interpreted as a morphism (i.e.~substitution)
\(\Gamma, x : A \to \Gamma\), whose domain represents the context
\(\Gamma\) extended with a variable of type \(A\). We then interpret a
term \(a\) of type \(A\) in context \(\Gamma\) as a \emph{section} of
the display map representing \(A\), i.e.~\[
\begin{tikzcd}
    \Gamma & {\Gamma, x : A} \\
    & \Gamma
    \arrow["a", from=1-1, to=1-2]
    \arrow[Rightarrow, no head, from=1-1, to=2-2]
    \arrow["A", from=1-2, to=2-2]
\end{tikzcd}
\] Hence for each context \(\Gamma\), there is a category
\(\mathbf{Ty}[\Gamma]\), which is the full subcategory of the slice
category \(\mathcal{C}/\Gamma\) consisting of all display maps, wherein
objects correspond to types in context \(\Gamma\), and morphisms
correspond to terms.

In typical categorical semantics, given a substitution
\(f : \Gamma \to \Delta\), and a type \(A : \Delta, x : A \to \Delta\),
we then interpret the action of \(f\) on \(A\) as a pullback: \[
\begin{tikzcd}
    {\Gamma, x : A[f]} & {\Delta, x : A} \\
    \Gamma & \Delta
    \arrow[from=1-1, to=1-2]
    \arrow["{A[f]}"', from=1-1, to=2-1]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
    \arrow["A", from=1-2, to=2-2]
    \arrow["f"', from=2-1, to=2-2]
\end{tikzcd}
\] In particular, then, any display map \(A : \Gamma, x : A \to \Gamma\)
induces a functor \(\mathbf{Ty}[\Gamma] \to \mathbf{Ty}[\Gamma, x : A]\)
by substitution along \(A\). The left and right adjoints to this functor
(if they exist) then correspond to dependent pair and dependent function
types, respectively.

So far, we have told a pleasingly straightforward story of how to
interpret the syntax of dependent type theory categorically.
Unfortunately, this story is a fantasy, and the interpretation of
type-theoretic syntax into categorical semantics sketched above is
unsound, as it stands. The problem in essentials is that, in the syntax
of type theory, substitution is strictly associative -- i.e.~given
substitutions \(f : \Gamma \to \Delta\) and \(g : \Delta \to \Theta\)
and a type \texttt{A}, we have \(A[g][f] = A[g[f]]\); however, in the
above categorical semantics, such iterated substitution is interpreted
via successively taking pullbacks, which is in general only associative
up to isomorphism. It seems, then, that something more is needed to
account for this kind of \emph{strictness} in the semantics of dependent
type theory. It is precisely this problem which natural models exist to
solve.

\section{Natural Models}\label{natural-models}

The key insight of Awodey \cite{awodey2014natural} in formulating the
notion of a natural model is that the problem of strictness in the
semantics of type theory has, in a sense, already been solved by the
notion of \emph{type universes}, such as \texttt{Type} as introduced
above. Given a universe of types \(\mathcal{U}\), rather than
representing dependent types as display maps, and substitution as
pullback, we can simply represent a family of types \(B[x]\) dependent
upon a type \(A\) as a function \(A \to \mathcal{U}\), with substitution
then given by precomposition, which is automatically strictly
associative.

To interpret the syntax of dependent type theory in a category
\(\mathcal{C}\) of contexts and substitutions, it therefore suffices to
\emph{embed} \(\mathcal{C}\) into a category whose type-theoretic
internal language posesses such a universe whose types correspond to
those of \(\mathcal{C}\). For this purpose, we work in the category of
\emph{prehseaves} \(\mathbf{Set}^{\mathcal{C}^{op}}\), with the
embedding
\(\mathcal{C} \hookrightarrow \mathbf{Set}^{\mathcal{C}^{op}}\) being
nothing other than the Yoneda embedding.

The universe \(\mathcal{U}\) is then given by an object of
\(\mathbf{Set}^{\mathcal{C}^{op}}\), i.e.~an assignment, to each context
\(\Gamma\), of a set \(\mathsf{Ty}[\Gamma]\) of types in context
\(\Gamma\), with functions
\(\mathsf{Ty}[\Delta] \to \mathsf{Ty}[\Gamma]\) for each substitution
\(f : \Gamma \to \Delta\) that compose associatively, together with a
\(\mathcal{U}\)-indexed family of objects
\(u \in \mathbf{Set}^{\mathcal{C}^{op}}/\mathcal{U}\), i.e.~a natural
transformation \(u : \mathcal{U}_\bullet \Rightarrow \mathcal{U}\),
where for each context \(\Gamma\) and type
\(A \in \mathsf{Ty}[\Gamma]\), the fibre of \(u_\Gamma\) over \(A\) is
the set \(\mathsf{Tm}[\Gamma,A]\) of inhabitants of \(A\) in context
\(\Gamma\).

The condition that all types in \(\mathcal{U}\) ``belong to
\(\mathcal{C}\)'', in an appropriate sense, can then be expressed by
requiring \(u\) to be \emph{representable}, i.e.~for any representable
\(\gamma \in \mathbf{Set}^{\mathcal{C}^{op}}\) with a natural
transformation \(\alpha : \gamma \Rightarrow \mathcal{U}\), the pullback
\[
\begin{tikzcd}
    {\mathcal{\gamma} \times_{\alpha, u} \mathcal{U}_\bullet} & {\mathcal{U}_\bullet} \\
    \gamma & {\mathcal{U}}
    \arrow[Rightarrow, from=1-1, to=1-2]
    \arrow["{u[\alpha]}"', Rightarrow, from=1-1, to=2-1]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
    \arrow["u", Rightarrow, from=1-2, to=2-2]
    \arrow["\alpha"', Rightarrow, from=2-1, to=2-2]
\end{tikzcd}
\] of \(u\) along \(\alpha\) is representable.

The question, then, is how to express that \(\mathcal{C}\) has dependent
pair types, dependent function types, etc., in terms of the structure of
\(u\). A further insight of Awodey, toward answering this question, is
that \(u\) gives rise to a functor (indeed, a \emph{polynomial functor})
\(\overline{u} : \mathbf{Set}^{\mathcal{C}^{op}} \to \mathbf{Set}^{\mathcal{C}^{op}}\),
defined as follows \[
\overline{u}(P)(\Gamma) = \sum_{A : \mathsf{Ty}[\Gamma]} P(\Gamma)^{\mathsf{Tm}[\Gamma, A]}
\] and much of the type-theoretic structure of \(u\) can be accounted
for in terms of this functor. For instance (for reasons to be explained
shortly), dependent pair types are given by a natural transformation
\(\sigma : \overline{u} \circ \overline{u} \Rightarrow \overline{u}\),
that is \emph{Cartesian} in that, for every
\(\alpha : P \Rightarrow Q\), the following naturality square is a
pullback \[
\begin{tikzcd}
    {\overline{u}(\overline{u}(P))} & {\overline{u}(\overline{u}(Q))} \\
    {\overline{u}(P)} & {\overline{u}(Q)}
    \arrow["{\overline{u}(\overline{u}(\alpha))}", Rightarrow, from=1-1, to=1-2]
    \arrow["{\sigma_P}"', Rightarrow, from=1-1, to=2-1]
    \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
    \arrow["{\sigma_Q}", Rightarrow, from=1-2, to=2-2]
    \arrow["{\overline{u}(\alpha)}"', Rightarrow, from=2-1, to=2-2]
\end{tikzcd}
\]

A question that arises, then, is what structure such a natural
transformation interpreting dependent pair types must possess. It is
natural to think that \(\sigma\), along with a suitably-chosen natural
transformation \(Id \Rightarrow \overline{u}\), ought to give
\(\overline{u}\) the structure of a monad. However, this turns out to be
too strong a requirement, as it amounts to asking that
\(\Sigma x : A . (\Sigma y : B[x] . C[x,y]) = \Sigma (x,y) : (\Sigma x : A . B[x]) . C[x,y]\),
when in general this identity only holds up to isomorphism. Hence we
seem to have crossed over from Scylla of our semantics for dependent
type theory not being strict enough to interpret those identities we
expect to hold strictly, to the Charybdis of them now being too strict
to interpret the identities we expect to hold only up to isomorphism. It
was for this reason that Awodey \& Newstead were forced to ultimately go
beyond Polynomial functors in their accounts of natural models.

However, another possibility exists to solve this dilemma -- to use the
language of HoTT itself to reason about such equality-up-to-isomorphism
in natural models. For this purpose, rather than taking natural models
to be certain (representable) morphisms in
\(\mathbf{Set}^{\mathcal{C}^{op}}\), we can instead expand the
mathematical universe in which these models live to
\(\mathbf{\infty Grpd}^{\mathcal{C}^{op}}\), which, as an
\(\infty\)-topos, has HoTT as its internal language. Taking advantage of
this fact, we can use HoTT itself as a language for studying the
semantics of type theory, by postulating an abstract type
\(\mathcal{U}\) together with a type family
\(u : \mathcal{U} \to \mathsf{Type}\), corresponding to a representable
natural transformation
\(u : \mathcal{U}_\bullet \Rightarrow \mathcal{U}\) as above.

What remains, then, is to show how the various type-theoretic properties
of such natural models can be expressed in terms of polynomial functors
in the language of HoTT, and the complex identities to which these give
rise. For this purpose, we begin with a recap of the basics of HoTT,
before launching into a development of the theory of polynomial functors
within HoTT, with an eye toward the latter's use in the study of natural
models.

\section{Homotopy Type Theory}\label{homotopy-type-theory}

\subsection{The Identity Type}\label{the-identity-type}

Given elements \texttt{a,b\ :\ A} for some type \texttt{A}, the identity
type \texttt{a\ ‚â°\ b} is inductively generated from the single
constructor \texttt{refl\ :\ \{x\ :\ A\}\ ‚Üí\ x\ ‚â°\ x}, witnessing
reflexivity of equality.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{open} \KeywordTok{import}\NormalTok{ Agda}\OtherTok{.}\NormalTok{Builtin}\OtherTok{.}\NormalTok{Equality}
\KeywordTok{open} \KeywordTok{import}\NormalTok{ Agda}\OtherTok{.}\NormalTok{Builtin}\OtherTok{.}\NormalTok{Equality}\OtherTok{.}\NormalTok{Rewrite}
\end{Highlighting}
\end{Shaded}

The core insight of Homotopy Type Theory \cite{Voevodsky:2013a} is that
the presence of (intensional) identity types in a system of dependent
type theory endows each type with the structure of an
\(\infty\)-groupoid, and endows each function between types with the
structure of a functor between \(\infty\)-groupoids, etc. This allows a
wealth of higher-categorical properties and structures to be defined and
studied \emph{internally} in the language of dependent type theory.

Since an invocation of reflexivity typically occurs at the end of an
equality proof, we introduce the notation \texttt{‚ñ°} as a shorthand for
\texttt{refl} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{‚ñ° }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ a ‚â° a}
\NormalTok{a ‚ñ° }\OtherTok{=}\NormalTok{ refl}
\end{Highlighting}
\end{Shaded}

The inductive generation of \texttt{a\ ‚â°\ b} from \texttt{refl} then
gives rise to the operation of \emph{transport} that allows an
inhabitant of the type \texttt{B\ a} to be converted to an inhabitant of
\texttt{B\ b} for any type family \texttt{B\ :\ (x\ :\ A)\ ‚Üí\ Type}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transp }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{(}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{)} \OtherTok{\{}\NormalTok{a a\textquotesingle{} }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} 
         \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° a\textquotesingle{}}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B a }\OtherTok{‚Üí}\NormalTok{ B a\textquotesingle{}}
\NormalTok{transp B refl b }\OtherTok{=}\NormalTok{ b}
\end{Highlighting}
\end{Shaded}

Transitivity of equality then follows in the usual way.\footnote{We also
  take advantage of Agda's support for mixfix notation to present
  transitivity in such a way as to streamline both the reading and
  writing of equality proofs:}:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{‚Ä¢}\OtherTok{\_} \OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b c }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
      \OtherTok{‚Üí} \OtherTok{(}\NormalTok{a ‚â° b}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{b ‚â° c}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{a ‚â° c}\OtherTok{)}
\NormalTok{e ‚Ä¢ refl }\OtherTok{=}\NormalTok{ e}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{‚â°‚å©}\OtherTok{\_}\NormalTok{‚å™}\OtherTok{\_} \OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{\{}\NormalTok{b c }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} 
          \OtherTok{‚Üí}\NormalTok{ a ‚â° b }\OtherTok{‚Üí}\NormalTok{ b ‚â° c }\OtherTok{‚Üí}\NormalTok{ a ‚â° c}
\NormalTok{a ‚â°‚å© e ‚å™ refl }\OtherTok{=}\NormalTok{ e}

\NormalTok{comprewrite }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b c }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
              \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e1 }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \OtherTok{(}\NormalTok{e2 }\OtherTok{:}\NormalTok{ b ‚â° c}\OtherTok{)}
              \OtherTok{‚Üí} \OtherTok{(}\NormalTok{a ‚â°‚å© e1 ‚å™ e2}\OtherTok{)}\NormalTok{ ‚â° }\OtherTok{(}\NormalTok{e1 ‚Ä¢ e2}\OtherTok{)}
\NormalTok{comprewrite refl refl }\OtherTok{=}\NormalTok{ refl}

\PreprocessorTok{\{{-}\# REWRITE comprewrite \#{-}\}}
\end{Highlighting}
\end{Shaded}

Symmetry of equality follows similarly:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sym }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a a\textquotesingle{} }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ a ‚â° a\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ a\textquotesingle{} ‚â° a}
\NormalTok{sym refl }\OtherTok{=}\NormalTok{ refl}
\end{Highlighting}
\end{Shaded}

As mentioned above, each function \texttt{f\ :\ A\ ‚Üí\ B} in HoTT is
canonically endowed with the structure of a functor between
\(\infty\)-groupoids, where the action of such a function \texttt{f} on
paths (i.e.~elements of the identity type) is as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ap }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{a a\textquotesingle{} }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
     \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ a ‚â° a\textquotesingle{} }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{f a}\OtherTok{)}\NormalTok{ ‚â° }\OtherTok{(}\NormalTok{f a\textquotesingle{}}\OtherTok{)}
\NormalTok{ap f refl }\OtherTok{=}\NormalTok{ refl}
\end{Highlighting}
\end{Shaded}

By the same token, given a proof \texttt{f\ ‚â°\ g} for two functions
\texttt{f,g\ :\ (x\ :\ A)\ ‚Üí\ B\ x}, it follows that for any
\texttt{a\ :\ A} we have \texttt{f\ a\ ‚â°\ g\ a}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{coAp }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{f g }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x}\OtherTok{\}}
       \OtherTok{‚Üí}\NormalTok{ f ‚â° g }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f x ‚â° g x}
\NormalTok{coAp refl x }\OtherTok{=}\NormalTok{ refl}
\end{Highlighting}
\end{Shaded}

We additionally have the following ``dependent'' form of \texttt{ap} as
above, allowing us to apply a dependent function to both sides of an
identity, in a suitable manner:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{apd }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì0}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type ‚Ñì1}\OtherTok{\}} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{\}}
      \OtherTok{‚Üí} \OtherTok{(}\NormalTok{C }\OtherTok{:}\NormalTok{ B }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{)} \OtherTok{\{}\NormalTok{a a\textquotesingle{} }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
      \OtherTok{‚Üí} \OtherTok{(}\NormalTok{g }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ C }\OtherTok{(}\NormalTok{f x}\OtherTok{))} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° a\textquotesingle{}}\OtherTok{)} 
      \OtherTok{‚Üí}\NormalTok{ transp C }\OtherTok{(}\NormalTok{ap f e}\OtherTok{)} \OtherTok{(}\NormalTok{g a}\OtherTok{)}\NormalTok{ ‚â° g a\textquotesingle{}}
\NormalTok{apd B f refl }\OtherTok{=}\NormalTok{ refl}
\end{Highlighting}
\end{Shaded}

To show that two pairs \texttt{(a\ ,\ b)} and
\texttt{(a\textquotesingle{}\ ,\ b\textquotesingle{})} are equal, it
suffices to show that there is an identification
\texttt{e\ :\ a\ ‚â°\ a\textquotesingle{}} together with
\texttt{e\textquotesingle{}\ :\ transp\ B\ e\ b\ ‚â°\ b\textquotesingle{}}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ PairEq }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} 
              \OtherTok{\{}\NormalTok{a a\textquotesingle{} }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} \OtherTok{\{}\NormalTok{b }\OtherTok{:}\NormalTok{ B a}\OtherTok{\}} \OtherTok{\{}\NormalTok{b\textquotesingle{} }\OtherTok{:}\NormalTok{ B a\textquotesingle{}}\OtherTok{\}} \KeywordTok{where}

\NormalTok{    pairEq }\OtherTok{:} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° a\textquotesingle{}}\OtherTok{)} \OtherTok{(}\NormalTok{e\textquotesingle{} }\OtherTok{:}\NormalTok{ transp B e b ‚â° b\textquotesingle{}}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{a , b}\OtherTok{)}\NormalTok{ ‚â° }\OtherTok{(}\NormalTok{a\textquotesingle{} , b\textquotesingle{}}\OtherTok{)}
\NormalTok{    pairEq refl refl }\OtherTok{=}\NormalTok{ refl}
\end{Highlighting}
\end{Shaded}

We then have the following laws governing equality proofs for pairs.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    pairEqŒ≤1 }\OtherTok{:} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° a\textquotesingle{}}\OtherTok{)} \OtherTok{(}\NormalTok{e\textquotesingle{} }\OtherTok{:}\NormalTok{ transp B e b ‚â° b\textquotesingle{}}\OtherTok{)} 
               \OtherTok{‚Üí}\NormalTok{ ap fst }\OtherTok{(}\NormalTok{pairEq e e\textquotesingle{}}\OtherTok{)}\NormalTok{ ‚â° e}
\NormalTok{    pairEqŒ≤1 refl refl }\OtherTok{=}\NormalTok{ refl}

\NormalTok{    pairEqŒ∑ }\OtherTok{:} \OtherTok{(}\NormalTok{e }\OtherTok{:} \OtherTok{(}\NormalTok{a , b}\OtherTok{)}\NormalTok{ ‚â° }\OtherTok{(}\NormalTok{a\textquotesingle{} , b\textquotesingle{}}\OtherTok{))} 
              \OtherTok{‚Üí}\NormalTok{ pairEq }\OtherTok{(}\NormalTok{ap fst e}\OtherTok{)} \OtherTok{(}\NormalTok{apd B snd e}\OtherTok{)}\NormalTok{ ‚â° e}
\NormalTok{    pairEqŒ∑ refl }\OtherTok{=}\NormalTok{ refl}

\KeywordTok{open}\NormalTok{ PairEq }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

\subsection{Equivalences}\label{equivalences}

A pivotal notion, both for HoTT in general, and for the content of this
paper, is that of a function \texttt{f\ :\ A\ ‚Üí\ B} being an
\emph{equivalence} of types. The reader familiar with HoTT will know
that there are several definitions -- all equivalent -- of this concept
appearing in the HoTT literature. For present purposes, we make use of
the \emph{bi-invertible maps} notion of equivalence. Hence we say that a
function \texttt{f\ :\ A\ ‚Üí\ B} is an equivalence if it has both a left
inverse and a right inverse:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{isEquiv }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Type }\OtherTok{(}\NormalTok{‚Ñì ‚äî Œ∫}\OtherTok{)}
\NormalTok{isEquiv }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ A}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ B}\OtherTok{\}}\NormalTok{ f }\OtherTok{=} 
      \OtherTok{(}\NormalTok{Œ£ }\OtherTok{(}\NormalTok{B }\OtherTok{‚Üí}\NormalTok{ A}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ g }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f a}\OtherTok{)}\NormalTok{ ‚â° a}\OtherTok{))} 
\NormalTok{    √ó }\OtherTok{(}\NormalTok{Œ£ }\OtherTok{(}\NormalTok{B }\OtherTok{‚Üí}\NormalTok{ A}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ h }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{b }\OtherTok{:}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f }\OtherTok{(}\NormalTok{h b}\OtherTok{)}\NormalTok{ ‚â° b}\OtherTok{))}
\end{Highlighting}
\end{Shaded}

Straightforwardly, the identity function at each type is an equivalence,
and equivalences are closed under composition:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idIsEquiv }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ A}\OtherTok{\}} \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ x}\OtherTok{)}
\NormalTok{idIsEquiv }\OtherTok{=} \OtherTok{((Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ x}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))}\NormalTok{ , }\OtherTok{((Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ x}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))}

\NormalTok{compIsEquiv }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì0}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type ‚Ñì1}\OtherTok{\}} \OtherTok{\{}\NormalTok{C }\OtherTok{:}\NormalTok{ Type ‚Ñì2}\OtherTok{\}}
              \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{g }\OtherTok{:}\NormalTok{ B }\OtherTok{‚Üí}\NormalTok{ C}\OtherTok{\}} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ isEquiv g }\OtherTok{‚Üí}\NormalTok{ isEquiv f}
              \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f a}\OtherTok{))}
\NormalTok{compIsEquiv }\OtherTok{\{}\NormalTok{g }\OtherTok{=}\NormalTok{ g}\OtherTok{\}} \OtherTok{\{}\NormalTok{f }\OtherTok{=}\NormalTok{ f}\OtherTok{\}} 
            \OtherTok{((}\NormalTok{g\textquotesingle{} , lg}\OtherTok{)}\NormalTok{ , }\OtherTok{(}\NormalTok{g\textquotesingle{}\textquotesingle{} , rg}\OtherTok{))} 
            \OtherTok{((}\NormalTok{f\textquotesingle{} , lf}\OtherTok{)}\NormalTok{ , }\OtherTok{(}\NormalTok{f\textquotesingle{}\textquotesingle{} , rf}\OtherTok{))} \OtherTok{=}
      \OtherTok{(} \OtherTok{(Œª}\NormalTok{ c }\OtherTok{‚Üí}\NormalTok{ f\textquotesingle{} }\OtherTok{(}\NormalTok{g\textquotesingle{} c}\OtherTok{))}   
\NormalTok{      , }\OtherTok{Œª}\NormalTok{ a }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{f\textquotesingle{} }\OtherTok{(}\NormalTok{g\textquotesingle{} }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f a}\OtherTok{))))}\NormalTok{   ‚â°‚å© ap f\textquotesingle{} }\OtherTok{(}\NormalTok{lg }\OtherTok{(}\NormalTok{f a}\OtherTok{))}\NormalTok{ ‚å™ }
              \OtherTok{(}\NormalTok{f\textquotesingle{} }\OtherTok{(}\NormalTok{f a}\OtherTok{)}\NormalTok{             ‚â°‚å© lf a ‚å™ }
              \OtherTok{(}\NormalTok{a                    ‚ñ°}\OtherTok{)))} 
\NormalTok{    , }\OtherTok{((Œª}\NormalTok{ c }\OtherTok{‚Üí}\NormalTok{ f\textquotesingle{}\textquotesingle{} }\OtherTok{(}\NormalTok{g\textquotesingle{}\textquotesingle{} c}\OtherTok{))} 
\NormalTok{      , }\OtherTok{Œª}\NormalTok{ c }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{f\textquotesingle{}\textquotesingle{} }\OtherTok{(}\NormalTok{g\textquotesingle{}\textquotesingle{} c}\OtherTok{))))}\NormalTok{ ‚â°‚å© ap g  }\OtherTok{(}\NormalTok{rf }\OtherTok{(}\NormalTok{g\textquotesingle{}\textquotesingle{} c}\OtherTok{))}\NormalTok{ ‚å™ }
              \OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{g\textquotesingle{}\textquotesingle{} c}\OtherTok{)}\NormalTok{            ‚â°‚å© rg c ‚å™}
              \OtherTok{(}\NormalTok{c                    ‚ñ°}\OtherTok{)))}
\end{Highlighting}
\end{Shaded}

A closely-related notion to equivalence is that of a function \texttt{f}
being an \emph{isomorphism}, i.e.~having a single two-sided inverse:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Iso }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Type }\OtherTok{(}\NormalTok{‚Ñì ‚äî Œ∫}\OtherTok{)}
\NormalTok{Iso }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ A}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ B}\OtherTok{\}}\NormalTok{ f }\OtherTok{=} 
    \OtherTok{(}\NormalTok{Œ£ }\OtherTok{(}\NormalTok{B }\OtherTok{‚Üí}\NormalTok{ A}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ g }\OtherTok{‚Üí} \OtherTok{((}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f a}\OtherTok{)}\NormalTok{ ‚â° a}\OtherTok{)} 
\NormalTok{                    √ó }\OtherTok{((}\NormalTok{b }\OtherTok{:}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f }\OtherTok{(}\NormalTok{g b}\OtherTok{)}\NormalTok{ ‚â° b}\OtherTok{)))}
\end{Highlighting}
\end{Shaded}

One might be inclined to wonder, then, why we bother to define
equivalence via the seemingly more complicated notion of having both a
left and a right inverse when the familiar notion of isomorphism can
just as well be defined, as above. The full reasons for this are beyond
the scope of this paper, though see \cite{Voevodsky:2013a} for further
discussion. Suffice it to say that, for subtle reasons due to the
higher-categorical structure of types in HoTT, the plain notion of
isomorphism given above is not a \emph{good} notion of equivalence,
whereas that of bi-invertible maps is. In particular, the type
\texttt{Iso\ f} is not necessarily a proposition for arbitrary
\texttt{f}, whereas \texttt{isEquiv\ f} is.

We may nonetheless move more-or-less freely back and forth between the
notions of equivalence and isomorphism given above, thanks to the
following functions, which allow us to convert isomorphisms to
equivalences and vice versa:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ Iso‚ÜîEquiv }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{\}} \KeywordTok{where}

\NormalTok{    Iso‚ÜíisEquiv }\OtherTok{:}\NormalTok{ Iso f }\OtherTok{‚Üí}\NormalTok{ isEquiv f}
\NormalTok{    Iso‚ÜíisEquiv }\OtherTok{(}\NormalTok{g , l , r}\OtherTok{)} \OtherTok{=} \OtherTok{((}\NormalTok{g , l}\OtherTok{)}\NormalTok{ , }\OtherTok{(}\NormalTok{g , r}\OtherTok{))}

\NormalTok{    isEquiv‚ÜíIso }\OtherTok{:}\NormalTok{ isEquiv f }\OtherTok{‚Üí}\NormalTok{ Iso f}
\NormalTok{    isEquiv‚ÜíIso }\OtherTok{((}\NormalTok{g , l}\OtherTok{)}\NormalTok{ , }\OtherTok{(}\NormalTok{h , r}\OtherTok{))} \OtherTok{=} 
\NormalTok{        h , }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{f x}\OtherTok{))}\NormalTok{        ‚â°‚å© sym }\OtherTok{(}\NormalTok{l }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ ‚å™ }
                   \OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ ‚â°‚å© ap g }\OtherTok{(}\NormalTok{r }\OtherTok{(}\NormalTok{f x}\OtherTok{))}\NormalTok{ ‚å™}
                   \OtherTok{((}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{))}\NormalTok{       ‚â°‚å© l x ‚å™ }
                   \OtherTok{(}\NormalTok{x ‚ñ°}\OtherTok{))))}\NormalTok{ , r}

\KeywordTok{open}\NormalTok{ Iso‚ÜîEquiv }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

And by the above translation between equivalences and isomorphisms, each
equivalence has a corresponding inverse map in the opposite direction,
which is itself an equivalence:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ InvEquiv }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{\}} \KeywordTok{where}

\NormalTok{    inv }\OtherTok{:}\NormalTok{ isEquiv f }\OtherTok{‚Üí}\NormalTok{ B }\OtherTok{‚Üí}\NormalTok{ A}
\NormalTok{    inv }\OtherTok{(\_}\NormalTok{ , }\OtherTok{(}\NormalTok{h , }\OtherTok{\_))} \OtherTok{=}\NormalTok{ h}

\NormalTok{    isoInv }\OtherTok{:} \OtherTok{(}\NormalTok{isof }\OtherTok{:}\NormalTok{ Iso f}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Iso }\OtherTok{(}\NormalTok{fst isof}\OtherTok{)}
\NormalTok{    isoInv }\OtherTok{(}\NormalTok{g , l , r}\OtherTok{)} \OtherTok{=} \OtherTok{(}\NormalTok{f , r , l}\OtherTok{)}

\NormalTok{    invIsEquiv }\OtherTok{:} \OtherTok{(}\NormalTok{ef }\OtherTok{:}\NormalTok{ isEquiv f}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{(}\NormalTok{inv ef}\OtherTok{)}
\NormalTok{    invIsEquiv ef }\OtherTok{=}\NormalTok{ Iso‚ÜíisEquiv }\OtherTok{(}\NormalTok{isoInv }\OtherTok{(}\NormalTok{isEquiv‚ÜíIso ef}\OtherTok{))}
    
\KeywordTok{open}\NormalTok{ InvEquiv }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

We note that, for each type family \texttt{B\ :\ A\ ‚Üí\ Type}, the map
\texttt{B\ a\ ‚Üí\ B\ a\textquotesingle{}} induced by transport along
\texttt{e\ :\ a\ ‚â°\ a\textquotesingle{}} for any
\texttt{a,\ a\textquotesingle{}\ :\ A} is an equivalence with inverse
given by transport along \texttt{sym\ e}, as follows:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ TranspEquiv }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} 
                   \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \KeywordTok{where}

\NormalTok{    syml }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ B a}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ transp B }\OtherTok{(}\NormalTok{sym e}\OtherTok{)} \OtherTok{(}\NormalTok{transp B e x}\OtherTok{)}\NormalTok{ ‚â° x}
\NormalTok{    syml x }\KeywordTok{rewrite}\NormalTok{ e }\OtherTok{=}\NormalTok{ refl}

\NormalTok{    symr }\OtherTok{:} \OtherTok{(}\NormalTok{y }\OtherTok{:}\NormalTok{ B b}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ transp B e }\OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{sym e}\OtherTok{)}\NormalTok{ y}\OtherTok{)}\NormalTok{ ‚â° y}
\NormalTok{    symr y }\KeywordTok{rewrite}\NormalTok{ e }\OtherTok{=}\NormalTok{ refl}

\NormalTok{    transpIsEquiv }\OtherTok{:}\NormalTok{ isEquiv }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ B a}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ B b}\OtherTok{\}} \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ transp B e x}\OtherTok{)}
\NormalTok{    transpIsEquiv }\OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }\OtherTok{((Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ transp B }\OtherTok{(}\NormalTok{sym e}\OtherTok{)}\NormalTok{ x}\OtherTok{)}\NormalTok{ , }\OtherTok{(}\NormalTok{syml , symr}\OtherTok{))}

\KeywordTok{open}\NormalTok{ TranspEquiv }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

\subsection{Truncation, Bracket Types \&
Factorization}\label{truncation-bracket-types-factorization}

We say that a type \texttt{A} is:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \emph{contractible} (aka (-2)-truncated) if \texttt{A} is uniquely
  inhabited
\item
  a (mere) \emph{proposition} (aka (-1)-truncated) if any two elements
  of \texttt{A} are identical
\item
  a \emph{set} (aka 0-truncated) if for any \texttt{a,b\ :\ A}, the type
  \texttt{a\ ‚â°\ b} is a proposition.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{isContr }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Type ‚Ñì }\OtherTok{‚Üí}\NormalTok{ Type ‚Ñì}
\NormalTok{isContr A }\OtherTok{=}\NormalTok{ Œ£ A }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{b }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ a ‚â° b}\OtherTok{)}

\NormalTok{isProp }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Type ‚Ñì }\OtherTok{‚Üí}\NormalTok{ Type ‚Ñì}
\NormalTok{isProp A }\OtherTok{=} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ a ‚â° b}

\NormalTok{isSet }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Type ‚Ñì }\OtherTok{‚Üí}\NormalTok{ Type ‚Ñì}
\NormalTok{isSet A }\OtherTok{=} \OtherTok{(}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isProp }\OtherTok{(}\NormalTok{a ‚â° b}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

We additionally postulate the existence of a \emph{propositional
truncation,} or \emph{bracket type} operation, that takes a type
\texttt{A} to the least proposition (wrt entailment) entailed by
inhabitation of \texttt{A}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{postulate}
\NormalTok{    ‚à•}\OtherTok{\_}\NormalTok{‚à• }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{(}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Type lzero}
\NormalTok{    in‚à•{-}‚à• }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ ‚à• A ‚à•}
\NormalTok{    ‚à•{-}‚à•IsProp }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ isProp }\OtherTok{(}\NormalTok{‚à• A ‚à•}\OtherTok{)}
\NormalTok{    ‚à•{-}‚à•‚â°Contr }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ ‚à• A ‚à•}\OtherTok{\}} \OtherTok{\{}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{\}} 
               \OtherTok{‚Üí}\NormalTok{ ‚à•{-}‚à•IsProp ‚â° e}
\NormalTok{    ‚à•{-}‚à•Rec }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}}
            \OtherTok{‚Üí}\NormalTok{ isProp B }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ ‚à• A ‚à• }\OtherTok{‚Üí}\NormalTok{ B}
\end{Highlighting}
\end{Shaded}

When the type \texttt{‚à•\ A\ ‚à•} is inhabited, we say that \texttt{A} is
\emph{merely} inhabited.

From this operation on types, we straightforwardly obtain the higher
analogue of the usual epi-mono factorization system on functions between
sets, as follows:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ Epi{-}Mono }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \KeywordTok{where}
\end{Highlighting}
\end{Shaded}

We say that a function \texttt{f\ :\ A\ ‚Üí\ B} is \emph{injective}
(i.e.~a monomorphism), if for all \texttt{a\ ,\ b\ :\ A} the map
\texttt{ap\ f\ :\ a\ ‚â°\ b\ ‚Üí\ f\ a\ ‚â°\ f\ b} is an equivalence

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    isMono }\OtherTok{:}\NormalTok{ Type }\OtherTok{(}\NormalTok{‚Ñì ‚äî Œ∫}\OtherTok{)}
\NormalTok{    isMono }\OtherTok{=} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{(}\NormalTok{ap }\OtherTok{\{}\NormalTok{a }\OtherTok{=}\NormalTok{ a}\OtherTok{\}} \OtherTok{\{}\NormalTok{a\textquotesingle{} }\OtherTok{=}\NormalTok{ b}\OtherTok{\}}\NormalTok{ f}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

Given an element \texttt{b\ :\ B}, the \emph{fibre} of \texttt{f} at
\texttt{b} is the type of elements of \texttt{a} equipped with a proof
of \texttt{f\ a\ ‚â°\ b}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    Fibre }\OtherTok{:}\NormalTok{ B }\OtherTok{‚Üí}\NormalTok{ Type }\OtherTok{(}\NormalTok{‚Ñì ‚äî Œ∫}\OtherTok{)}
\NormalTok{    Fibre b }\OtherTok{=}\NormalTok{ Œ£ A }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ f a ‚â° b}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

We then say that \texttt{f} is \emph{surjective} (i.e.~an epimorphism),
if all of its fibres are merely inhabited.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    isEpi }\OtherTok{:}\NormalTok{ Type Œ∫}
\NormalTok{    isEpi }\OtherTok{=} \OtherTok{(}\NormalTok{b }\OtherTok{:}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ ‚à• Fibre b ‚à•}

\KeywordTok{open}\NormalTok{ Epi{-}Mono }\KeywordTok{public}

\KeywordTok{module}\NormalTok{ EMFactor }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \KeywordTok{where}
\end{Highlighting}
\end{Shaded}

Given a function \texttt{f}, its \emph{image} is the type of elements of
\texttt{B} whose fibres are merely inhabited.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    Im }\OtherTok{:}\NormalTok{ Type Œ∫}
\NormalTok{    Im }\OtherTok{=}\NormalTok{ Œ£ B }\OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ ‚à• Fibre f b ‚à•}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

Every function \texttt{f} can then be factored into a (-1)-connected map
onto its image followed by a (-1)-truncated map onto its codomain:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    factor1 }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Im}
\NormalTok{    factor1 a }\OtherTok{=} \OtherTok{(}\NormalTok{f a}\OtherTok{)}\NormalTok{ , in‚à•{-}‚à• }\OtherTok{(}\NormalTok{a , refl}\OtherTok{)}

\NormalTok{    factor2 }\OtherTok{:}\NormalTok{ Im }\OtherTok{‚Üí}\NormalTok{ B}
\NormalTok{    factor2 }\OtherTok{(}\NormalTok{b , }\OtherTok{\_)} \OtherTok{=}\NormalTok{ b}

\NormalTok{    factor‚â° }\OtherTok{:} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ factor2 }\OtherTok{(}\NormalTok{factor1 a}\OtherTok{)}\NormalTok{ ‚â° f a}
\NormalTok{    factor‚â° a }\OtherTok{=}\NormalTok{ refl}

\NormalTok{    factor1IsEpi }\OtherTok{:}\NormalTok{ isEpi factor1}
\NormalTok{    factor1IsEpi }\OtherTok{(}\NormalTok{b , x}\OtherTok{)} \OtherTok{=} 
\NormalTok{        ‚à•{-}‚à•Rec ‚à•{-}‚à•IsProp }
              \OtherTok{(Œª} \OtherTok{\{(}\NormalTok{a , refl}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ in‚à•{-}‚à• }\OtherTok{(}\NormalTok{a , pairEq refl ‚à•{-}‚à•IsProp}\OtherTok{)\})} 
\NormalTok{              x}

\NormalTok{    factor2IsMono }\OtherTok{:}\NormalTok{ isMono factor2}
\NormalTok{    factor2IsMono }\OtherTok{\{}\NormalTok{a }\OtherTok{=} \OtherTok{(}\NormalTok{a , Œ±}\OtherTok{)\}} \OtherTok{\{}\NormalTok{b }\OtherTok{=} \OtherTok{(}\NormalTok{b , Œ≤}\OtherTok{)\}} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ e }\OtherTok{‚Üí}\NormalTok{ pairEq e ‚à•{-}‚à•IsProp}\OtherTok{)} 
\NormalTok{                    , }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ e }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{pairEq }\OtherTok{(}\NormalTok{ap factor2 e}\OtherTok{)}\NormalTok{ ‚à•{-}‚à•IsProp}\OtherTok{)} 
\NormalTok{                               ‚â°‚å© }\OtherTok{(}\NormalTok{ap }\OtherTok{(}\NormalTok{pairEq }\OtherTok{(}\NormalTok{ap factor2 e}\OtherTok{))}\NormalTok{ ‚à•{-}‚à•‚â°Contr}\OtherTok{)}\NormalTok{ ‚å™ }
                               \OtherTok{(} \OtherTok{\_} 
\NormalTok{                               ‚â°‚å© pairEqŒ∑ e ‚å™ }
                               \OtherTok{(}\NormalTok{e ‚ñ°}\OtherTok{)))}
\NormalTok{                      , }\OtherTok{Œª}\NormalTok{ e }\OtherTok{‚Üí}\NormalTok{ pairEqŒ≤1 e ‚à•{-}‚à•IsProp}\OtherTok{))}

\KeywordTok{open}\NormalTok{ EMFactor }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

Some additional facts about the identity type, that will be used in
formalizing the results of this paper, are given in Appendix A.

\chapter{Polynomials in HoTT}\label{polynomials-in-hott}

\section{Basics}\label{basics}

\textbf{Remark:} for the sake of concision, since essentially all of the
categorical structures treated in this paper will be
infinite-dimensional, we shall generally omit the prefix ``\(\infty\)-''
from our descriptions these structures. Hence hereafter ``category''
generally means \(\infty\)-category, ``functor'' means
\(\infty\)-functor, etc.

Let \(\mathbf{Type}\) be the category of types and functions between
them. Given a type \texttt{A}, let \(y^A\) denote the corresponding
representable functor \(\mathbf{Type} \to \mathbf{Type}\).

A \emph{polynomial functor} is a coproduct of representable functors
\(\mathbf{Type} \to \mathbf{Type}\), i.e.~an endofunctor on
\(\mathbf{Type}\) of the form \[
\sum_{a : A} y^{B(a)}
\] for some type \texttt{A} and family of types
\texttt{B\ :\ A\ ‚Üí\ Type}. The data of a polynomial functor is thus
uniquely determined by the choice of \texttt{A} and \texttt{B}. Hence we
may represent such functors in Agda simply as pairs (A , B) of this
form:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Poly }\OtherTok{:} \OtherTok{(}\NormalTok{‚Ñì Œ∫ }\OtherTok{:}\NormalTok{ Level}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Type }\OtherTok{((}\NormalTok{lsuc ‚Ñì}\OtherTok{)}\NormalTok{ ‚äî }\OtherTok{(}\NormalTok{lsuc Œ∫}\OtherTok{))}
\NormalTok{Poly ‚Ñì Œ∫ }\OtherTok{=}\NormalTok{ Œ£ }\OtherTok{(}\NormalTok{Type ‚Ñì}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

A basic example of such a polynomial functor is the identity functor
\texttt{ùï™} consisting of a single term of unit arity -- hence
represented by the pair \texttt{(‚ä§\ ,\ Œª\ \_\ ‚Üí\ ‚ä§)}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ùï™ }\OtherTok{:}\NormalTok{ Poly lzero lzero}
\NormalTok{ùï™ }\OtherTok{=} \OtherTok{(}\NormalTok{‚ä§ , }\OtherTok{Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ ‚ä§}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

The observant reader may note the striking similarity of the above-given
formula for a polynomial functor and the endofunctor on
\(\mathbf{Set}^{\mathcal{C}^{op}}\) defined in the previous section on
natural models. Indeed, this is no accident, given a type \texttt{ùì§} and
a function \texttt{u\ :\ ùì§\ ‚Üí\ Type} corresponding to a natural model as
described previously, we obtain the corresponding polynomial
\texttt{ùî≤\ :\ Poly} as the pair \texttt{(ùì§\ ,\ u)}. Hence we can study
the structure of \texttt{ùì§} and \texttt{u} in terms of \texttt{ùî≤}, and
this, as we shall see, allows for some significant simplifications in
the theory of natural models.

Given polynomial functors \(p = \sum_{a : A} y^{B(a)}\) and
\(q = \sum_{c : C} y^{D(c)}\), a natural transformation
\(p \Rightarrow q\) is equivalently given by the data of a
\emph{forward} map \texttt{f\ :\ A\ ‚Üí\ B} and a \emph{backward} map
\texttt{g\ :\ (a\ :\ A)\ ‚Üí\ D\ (f\ a)\ ‚Üí\ B\ a}, as can be seen from the
following argument via Yoneda: \[
\begin{array}{rl}
& \int_{y \in \mathbf{Type}} \left( \sum_{a : A} y^{B(a)}  \right) \to \sum_{c : C} y^{D(c)}\\
\simeq & \prod_{a : A} \int_{y \in \mathbf{Type}} y^{B(a)} \to \sum_{c : C} y^{D(c)}\\
\simeq & \prod_{a : A} \sum_{c : C} B(a)^{D(c)}\\
\simeq & \sum_{f : A \to C} \prod_{a : A} B(a)^{D(f(c))}
\end{array}
\] We use the notation \(p \leftrightarrows q\) to denote the type of
natural transformations from \(p\) to \(q\) (aka \emph{lenses} from
\(p\) to \(q\)), which may be written in Agda as follows:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{‚áÜ}\OtherTok{\_} \OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì0 Œ∫0 }\OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì1 Œ∫1 }\OtherTok{‚Üí}\NormalTok{ Type }\OtherTok{(}\NormalTok{‚Ñì0 ‚äî ‚Ñì1 ‚äî Œ∫0 ‚äî Œ∫1}\OtherTok{)}
\OtherTok{(}\NormalTok{A , B}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{C , D}\OtherTok{)} \OtherTok{=}\NormalTok{ Œ£ }\OtherTok{(}\NormalTok{A }\OtherTok{‚Üí}\NormalTok{ C}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ f }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ D }\OtherTok{(}\NormalTok{f a}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B a}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

By application of function extensionality, we derive the following type
for proofs of equality between lenses:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{EqLens }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}}
         \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)}
         \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f g }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Type }\OtherTok{(}\NormalTok{‚Ñì0 ‚äî ‚Ñì1 ‚äî Œ∫0 ‚äî Œ∫1}\OtherTok{)}
\NormalTok{EqLens }\OtherTok{\{}\NormalTok{p }\OtherTok{=} \OtherTok{(}\NormalTok{A , B}\OtherTok{)\}} \OtherTok{(}\NormalTok{C , D}\OtherTok{)} \OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{=}
\NormalTok{  Œ£ }\OtherTok{((}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f a ‚â° g a}\OtherTok{)}
    \OtherTok{(Œª}\NormalTok{ e }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{(}\NormalTok{d }\OtherTok{:}\NormalTok{ D }\OtherTok{(}\NormalTok{f a}\OtherTok{))} 
           \OtherTok{‚Üí}\NormalTok{ f‚ôØ a d ‚â° g‚ôØ a }\OtherTok{(}\NormalTok{transp D }\OtherTok{(}\NormalTok{e a}\OtherTok{)}\NormalTok{ d}\OtherTok{))}
\end{Highlighting}
\end{Shaded}

For each polynomial \(p\), the correspnding identity lens is given by
the following data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{id }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ p ‚áÜ p}
\NormalTok{id p }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ a}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª}\NormalTok{ a b }\OtherTok{‚Üí}\NormalTok{ b }\OtherTok{)}
\end{Highlighting}
\end{Shaded}

And given lenses \(p \leftrightarrows q\) and \(q \leftrightarrows r\),
their composition may be computed as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{comp }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 Œ∫0 Œ∫1 Œ∫2}\OtherTok{\}}
       \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{\{}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)}
       \OtherTok{‚Üí}\NormalTok{ p ‚áÜ q }\OtherTok{‚Üí}\NormalTok{ q ‚áÜ r }\OtherTok{‚Üí}\NormalTok{ p ‚áÜ r}
\NormalTok{comp r }\OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{=} 
     \OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f a}\OtherTok{))}\NormalTok{ , }\OtherTok{Œª}\NormalTok{ a z }\OtherTok{‚Üí}\NormalTok{ f‚ôØ a }\OtherTok{(}\NormalTok{g‚ôØ }\OtherTok{(}\NormalTok{f a}\OtherTok{)}\NormalTok{ z}\OtherTok{)} \OtherTok{)}
\end{Highlighting}
\end{Shaded}

Hence we have a category \(\mathbf{Poly}\) of polynomial functors and
lenses between them. Our goal, then, is to show how the type-theoretic
structure of a natural model naturally arises from the structure of this
category. In fact, \(\mathbf{Poly}\) is replete with categorical
structures of all kinds, of which we now mention but a few:

\section{\texorpdfstring{The Vertical-Cartesian Factorization System on
\(\mathbf{Poly}\)}{The Vertical-Cartesian Factorization System on \textbackslash mathbf\{Poly\}}}\label{the-vertical-cartesian-factorization-system-on-mathbfpoly}

We say that a lens \texttt{(f\ ,\ f‚ôØ)\ :\ (A\ ,\ B)\ ‚áÜ\ (C\ ,\ D)} is
\emph{vertical} if \texttt{f\ :\ A\ ‚Üí\ C} is an equivalence, and
Cartesian if for every \texttt{a\ :\ A}, the map
\texttt{f‚ôØ\ a\ :\ D{[}f\ a{]}\ ‚Üí\ B\ a} is an
equivalence.\footnote{For a proof that this notion of Cartesian morphism between polynomials is equivalent to the one given previously in Section 2.2, see Chapter 5.5 of \cite{spivak2022poly}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ Vert{-}Cart }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} 
                 \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \KeywordTok{where}

\NormalTok{    isVertical }\OtherTok{:} \DataTypeTok{Set} \OtherTok{(}\NormalTok{‚Ñì0 ‚äî ‚Ñì1}\OtherTok{)}
\NormalTok{    isVertical }\OtherTok{=}\NormalTok{ isEquiv }\OtherTok{(}\NormalTok{fst f}\OtherTok{)}

\NormalTok{    isCartesian }\OtherTok{:} \DataTypeTok{Set} \OtherTok{(}\NormalTok{‚Ñì0 ‚äî Œ∫0 ‚äî Œ∫1}\OtherTok{)}
\NormalTok{    isCartesian }\OtherTok{=} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ fst p}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{(}\NormalTok{snd f a}\OtherTok{)}

\KeywordTok{open}\NormalTok{ Vert{-}Cart }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

Every lens \texttt{(A\ ,\ B)\ ‚áÜ\ (C\ ,\ D)} can then be factored as a
vertical lens followed by a Cartesian lens:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ VertCartFactor }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} 
                      \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \KeywordTok{where}

\NormalTok{    vcIm }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫1}
\NormalTok{    vcIm }\OtherTok{=} \OtherTok{(}\NormalTok{fst p , }\OtherTok{Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ snd q }\OtherTok{(}\NormalTok{fst f x}\OtherTok{))}

\NormalTok{    vertfactor }\OtherTok{:}\NormalTok{ p ‚áÜ vcIm}
\NormalTok{    vertfactor }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ x}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a x }\OtherTok{‚Üí}\NormalTok{ snd f a x}\OtherTok{)} \OtherTok{)}

\NormalTok{    vertfactorIsVert }\OtherTok{:}\NormalTok{ isVertical vcIm vertfactor}
\NormalTok{    vertfactorIsVert }\OtherTok{=}\NormalTok{ idIsEquiv}

\NormalTok{    cartfactor }\OtherTok{:}\NormalTok{ vcIm ‚áÜ q}
\NormalTok{    cartfactor }\OtherTok{=} \OtherTok{(}\NormalTok{ fst f , }\OtherTok{(Œª}\NormalTok{ a x }\OtherTok{‚Üí}\NormalTok{ x}\OtherTok{)} \OtherTok{)}

\NormalTok{    cartfactorIsCart }\OtherTok{:}\NormalTok{ isCartesian q cartfactor}
\NormalTok{    cartfactorIsCart x }\OtherTok{=}\NormalTok{ idIsEquiv}

\NormalTok{    vertcartfactor‚â° }\OtherTok{:}\NormalTok{ EqLens q f }\OtherTok{(}\NormalTok{comp q vertfactor cartfactor}\OtherTok{)}
\NormalTok{    vertcartfactor‚â° }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a b }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} \OtherTok{)}

\KeywordTok{open}\NormalTok{ VertCartFactor }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

Of these two classes of morphisms in \(\mathbf{Poly}\), it is
\emph{Cartesian} lenses that shall be of principal interest to us. If we
view a polynomial \texttt{p\ =\ (A\ ,\ B)} as an \texttt{A}-indexed
family of types, given by \texttt{B}, then given a lens
\texttt{(f\ ,\ f‚ôØ)\ :\ p\ ‚áÜ\ ùî≤}, we can think of the map
\texttt{f‚ôØ\ a\ :\ u\ (f\ a)\ ‚Üí\ B\ a}, as an \emph{elimination form} for
the type \texttt{u\ (f\ a)}, i.e.~a way of \emph{using} elements of the
type \texttt{u\ (f\ a)}. If we then ask that \texttt{(f\ ,\ f‚ôØ)}
isCartesian, this implies that the type \texttt{u\ (f\ a)} is completely
characterized (up to equivalence) by this elimination form, and in this
sense, \texttt{ùî≤} \emph{contains} the type \texttt{B\ a}, for all
\texttt{a\ :\ A}.\footnote{Those familiar with type theory may recognize
  this practice of defining types in terms of their elimination forms as
  characteristic of so-called \emph{negative} types (in opposition to
  \emph{positive} types, which are characterized by their introduction
  forms). Indeed, there are good reasons for this, having to do with the
  fact that negative types are equivalently those whose universal
  property is given by a \emph{representable} functor, rather than a
  \emph{co-representable} functor, which reflects the fact that natural
  models are defined in terms of \emph{presheaves} on a category of
  contexts, rather than \emph{co-presheaves.}}

We can therefore use Cartesian lenses to detect which types are
contained in a natural model \texttt{ùî≤}.

A further fact about Cartesian lenses is that they are closed under
identity and composition, as a direct consequence of the closure of
equivalences under identity and composition:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idCart }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)}
         \OtherTok{‚Üí}\NormalTok{ isCartesian p }\OtherTok{(}\NormalTok{id p}\OtherTok{)}
\NormalTok{idCart p a }\OtherTok{=}\NormalTok{ idIsEquiv}

\NormalTok{compCartesian }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 Œ∫0 Œ∫1 Œ∫2}\OtherTok{\}}
                \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{\{}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)}
                \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}} \OtherTok{\{}\NormalTok{g }\OtherTok{:}\NormalTok{ q ‚áÜ r}\OtherTok{\}}
                \OtherTok{‚Üí}\NormalTok{ isCartesian q f }\OtherTok{‚Üí}\NormalTok{ isCartesian r g }
                \OtherTok{‚Üí}\NormalTok{ isCartesian r }\OtherTok{(}\NormalTok{comp r f g}\OtherTok{)}
\NormalTok{compCartesian r }\OtherTok{\{}\NormalTok{f }\OtherTok{=} \OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)\}} \OtherTok{\{}\NormalTok{g }\OtherTok{=} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)\}}\NormalTok{ cf cg a }\OtherTok{=} 
\NormalTok{    compIsEquiv }\OtherTok{(}\NormalTok{cf a}\OtherTok{)} \OtherTok{(}\NormalTok{cg }\OtherTok{(}\NormalTok{f a}\OtherTok{))}
\end{Highlighting}
\end{Shaded}

Hence there is a category \(\mathbf{Poly^{Cart}}\) defined as the wide
subcategory of \(\mathbf{Poly}\) whose morphisms are precisely Cartesian
lenses. As we shall see, much of the categorical structure of natural
models qua polynomial functors can be derived from the subtle interplay
between \(\mathbf{Poly^{Cart}}\) and \(\mathbf{Poly}\).

\subsection{\texorpdfstring{Epi-Mono Factorization on
\(\mathbf{Poly^{Cart}}\)}{Epi-Mono Factorization on \textbackslash mathbf\{Poly\^{}\{Cart\}\}}}\label{epi-mono-factorization-on-mathbfpolycart}

In fact, \(\mathbf{Poly^{Cart}}\) itself inherits a factorization system
from the epi-mono factorization on types considered previously.

Define a lens \texttt{(f\ ,\ f‚ôØ)\ :\ p\ ‚áÜ\ q} to be a \emph{vertical
embedding} if \texttt{f} is a monomorphism, and a \emph{vertical
surjection} if \texttt{f} is an epimorphism.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ VertEpi{-}Mono }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} 
                    \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \KeywordTok{where}

\NormalTok{    isVerticalEmbedding }\OtherTok{:} \DataTypeTok{Set} \OtherTok{(}\NormalTok{‚Ñì0 ‚äî ‚Ñì1}\OtherTok{)}
\NormalTok{    isVerticalEmbedding }\OtherTok{=}\NormalTok{ isMono }\OtherTok{(}\NormalTok{fst f}\OtherTok{)}

\NormalTok{    isVerticalSurjection }\OtherTok{:} \DataTypeTok{Set}\NormalTok{ ‚Ñì1}
\NormalTok{    isVerticalSurjection }\OtherTok{=}\NormalTok{ isEpi }\OtherTok{(}\NormalTok{fst f}\OtherTok{)}

\KeywordTok{open}\NormalTok{ VertEpi{-}Mono }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

Then every Cartesian lens can be factored into a vertical surjection
followed by a vertical embedding, both of which are Cartesian.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ CartEMFactorization }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} 
           \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \OtherTok{(}\NormalTok{cf }\OtherTok{:}\NormalTok{ isCartesian q f}\OtherTok{)} \KeywordTok{where}

\NormalTok{    cartIm }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}
\NormalTok{    cartIm }\OtherTok{=} \OtherTok{(}\NormalTok{Im }\OtherTok{(}\NormalTok{fst f}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª} \OtherTok{(}\NormalTok{x , }\OtherTok{\_)} \OtherTok{‚Üí}\NormalTok{ snd q x}\OtherTok{)}

\NormalTok{    factorcart1 }\OtherTok{:}\NormalTok{ p ‚áÜ cartIm}
\NormalTok{    factorcart1 }\OtherTok{=} \OtherTok{(}\NormalTok{ factor1 }\OtherTok{(}\NormalTok{fst f}\OtherTok{)}\NormalTok{ , snd f }\OtherTok{)}

\NormalTok{    factorcart1IsCart }\OtherTok{:}\NormalTok{ isCartesian cartIm factorcart1}
\NormalTok{    factorcart1IsCart }\OtherTok{=}\NormalTok{ cf}

\NormalTok{    factorcart1IsEpi }\OtherTok{:}\NormalTok{ isVerticalSurjection cartIm factorcart1}
\NormalTok{    factorcart1IsEpi }\OtherTok{=}\NormalTok{ factor1IsEpi }\OtherTok{(}\NormalTok{fst f}\OtherTok{)}

\NormalTok{    factorcart2 }\OtherTok{:}\NormalTok{ cartIm ‚áÜ q}
\NormalTok{    factorcart2 }\OtherTok{=} \OtherTok{(}\NormalTok{ factor2 }\OtherTok{(}\NormalTok{fst f}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª} \OtherTok{\_}\NormalTok{ y }\OtherTok{‚Üí}\NormalTok{ y}\OtherTok{)} \OtherTok{)}

\NormalTok{    factorcart2IsCart }\OtherTok{:}\NormalTok{ isCartesian q factorcart2}
\NormalTok{    factorcart2IsCart }\OtherTok{\_} \OtherTok{=}\NormalTok{ idIsEquiv}

\NormalTok{    factorcart2IsMono }\OtherTok{:}\NormalTok{ isVerticalEmbedding q factorcart2}
\NormalTok{    factorcart2IsMono }\OtherTok{=}\NormalTok{ factor2IsMono }\OtherTok{(}\NormalTok{fst f}\OtherTok{)}

\NormalTok{    factorcart‚â° }\OtherTok{:}\NormalTok{ EqLens q f }\OtherTok{(}\NormalTok{comp q factorcart1 factorcart2}\OtherTok{)}
\NormalTok{    factorcart‚â° }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{  refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ x y }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} \OtherTok{)}

\KeywordTok{open}\NormalTok{ CartEMFactorization }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

We note in passing that the vertical embeddings are indeed the
monomorphisms in \(\mathbf{Poly}^{\mathbf{Cart}}\), i.e.~if
\texttt{f\ :\ q\ ‚áÜ\ r} is a both Cartesian and a vertical embedding,
then for any Cartesian \texttt{g\ h\ :\ p\ ‚áÜ\ q} such that
\texttt{f\ ‚àò\ g\ ‚â°\ f\ ‚àò\ h}, we have \texttt{g\ =\ h}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{VertEmbedding‚ÜíPolyCartMono }\OtherTok{:} 
    \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 Œ∫0 Œ∫1 Œ∫2}\OtherTok{\}} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}}
    \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ q ‚áÜ r}\OtherTok{\}}
    \OtherTok{‚Üí}\NormalTok{ isCartesian r f }\OtherTok{‚Üí}\NormalTok{ isVerticalEmbedding r f}
    \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{g h }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ isCartesian q g }\OtherTok{‚Üí}\NormalTok{ isCartesian q h}
    \OtherTok{‚Üí}\NormalTok{ EqLens r }\OtherTok{(}\NormalTok{comp r g f}\OtherTok{)} \OtherTok{(}\NormalTok{comp r h f}\OtherTok{)}
    \OtherTok{‚Üí}\NormalTok{ EqLens q g h}
\NormalTok{VertEmbedding‚ÜíPolyCartMono }\OtherTok{\{}\NormalTok{p }\OtherTok{=}\NormalTok{ p}\OtherTok{\}} \OtherTok{\{}\NormalTok{q }\OtherTok{=}\NormalTok{ q}\OtherTok{\}}\NormalTok{ r }\OtherTok{\{}\NormalTok{f }\OtherTok{=} \OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)\}}\NormalTok{ cf vef }
                           \OtherTok{\{}\NormalTok{g }\OtherTok{=} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)\}} \OtherTok{\{}\NormalTok{h }\OtherTok{=} \OtherTok{(}\NormalTok{h , h‚ôØ}\OtherTok{)\}}\NormalTok{ cg ch }\OtherTok{(}\NormalTok{e , e‚ôØ}\OtherTok{)} \OtherTok{=} 
    \OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ inv vef }\OtherTok{(}\NormalTok{e a}\OtherTok{))} 
\NormalTok{    , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{g‚ôØ a d}\OtherTok{)} 
\NormalTok{                   ‚â°‚å© ap }\OtherTok{(}\NormalTok{g‚ôØ a}\OtherTok{)} \OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{cf }\OtherTok{(}\NormalTok{g a}\OtherTok{)))}\NormalTok{ d}\OtherTok{))}\NormalTok{ ‚å™ }
               \OtherTok{(} \OtherTok{\_}\NormalTok{ ‚â°‚å© }\OtherTok{(}\NormalTok{e‚ôØ a }\OtherTok{(}\NormalTok{inv }\OtherTok{(}\NormalTok{cf }\OtherTok{(}\NormalTok{g a}\OtherTok{))}\NormalTok{ d}\OtherTok{))}\NormalTok{ ‚å™ }
               \OtherTok{(} \OtherTok{\_}\NormalTok{ ‚â°‚å© }\OtherTok{(}\NormalTok{ap }\OtherTok{(}\NormalTok{h‚ôØ a}\OtherTok{)} 
                           \OtherTok{(} \OtherTok{\_}\NormalTok{ ‚â°‚å© }\OtherTok{(}\NormalTok{ap }\OtherTok{(}\NormalTok{f‚ôØ }\OtherTok{(}\NormalTok{h a}\OtherTok{))} 
                                       \OtherTok{(}\NormalTok{transpPre vef }
                                         \OtherTok{(Œª}\NormalTok{ x y }\OtherTok{‚Üí}\NormalTok{ inv }\OtherTok{(}\NormalTok{cf x}\OtherTok{)}\NormalTok{ y}\OtherTok{)} 
                                         \OtherTok{(}\NormalTok{e a}\OtherTok{)))}\NormalTok{ ‚å™ }
                           \OtherTok{(} \OtherTok{\_}\NormalTok{ ‚â°‚å© snd }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{cf }\OtherTok{(}\NormalTok{h a}\OtherTok{)))} \OtherTok{\_}\NormalTok{ ‚å™ }
                           \OtherTok{(} \OtherTok{\_}\NormalTok{ ‚ñ°}\OtherTok{))))}\NormalTok{ ‚å™}
               \OtherTok{((}\NormalTok{h‚ôØ a }\OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd q}\OtherTok{)} \OtherTok{(}\NormalTok{inv vef }\OtherTok{(}\NormalTok{e a}\OtherTok{))}\NormalTok{ d}\OtherTok{))}\NormalTok{ ‚ñ°}\OtherTok{))))} \OtherTok{)}
\end{Highlighting}
\end{Shaded}

\section{Composition of Polynomial
Functors}\label{composition-of-polynomial-functors}

As endofunctors on \(\mathbf{Type}\), polynomial functors may
straightforwardly be composed. To show that the resulting composite is
itself (equivalent to) a polynomial functor, we can reason via the
following chain of equivalences: given polynomials \texttt{(A\ ,\ B)}
and \texttt{(C\ ,\ D)}, their composite, evaluated at a type \texttt{y}
is \[
\begin{array}{rl}
& \sum_{a : A} \prod_{b : B(a)} \sum_{c : C} y^{D(c)}\\
\simeq & \sum_{a : A} \sum_{f : B(a) \to C} \prod_{b : B(a)} y^{D(f(b))}\\
\simeq & \sum_{(a , f) : \sum_{a : A} C^{B(a)}} y^{\sum_{b : B(a)} D(f(b))}
\end{array}
\] This then defines a monoidal product \(‚óÉ\) on \(\mathbf{Poly}\) with
monoidal unit given by the identity functor \texttt{ùï™}:

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{‚óÉ}\OtherTok{\_} \OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì0 Œ∫0 }\OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì1 Œ∫1 }
      \OtherTok{‚Üí}\NormalTok{ Poly }\OtherTok{(}\NormalTok{‚Ñì0 ‚äî Œ∫0 ‚äî ‚Ñì1}\OtherTok{)} \OtherTok{(}\NormalTok{Œ∫0 ‚äî Œ∫1}\OtherTok{)}
\OtherTok{(}\NormalTok{A , B}\OtherTok{)}\NormalTok{ ‚óÉ }\OtherTok{(}\NormalTok{C , D}\OtherTok{)} \OtherTok{=} 
    \OtherTok{(}\NormalTok{ Œ£ A }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ B a }\OtherTok{‚Üí}\NormalTok{ C}\OtherTok{)} 
\NormalTok{    , }\OtherTok{Œª} \OtherTok{(}\NormalTok{a , f}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Œ£ }\OtherTok{(}\NormalTok{B a}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ D }\OtherTok{(}\NormalTok{f b}\OtherTok{))} \OtherTok{)}

\OtherTok{\_}\NormalTok{‚óÉ‚óÉ[}\OtherTok{\_}\NormalTok{]}\OtherTok{\_} \OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 Œ∫0 Œ∫1 Œ∫2 Œ∫3}\OtherTok{\}}
        \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{\{}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ p ‚áÜ q}
        \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ r ‚áÜ s }
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{)}
\OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)}\NormalTok{ ‚óÉ‚óÉ[ s ] }\OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{=}
    \OtherTok{((Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f a , }\OtherTok{Œª}\NormalTok{ b\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{f‚ôØ a b\textquotesingle{}}\OtherTok{))))}
\NormalTok{    , }\OtherTok{Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{(}\NormalTok{b\textquotesingle{} , d\textquotesingle{}}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{((}\NormalTok{f‚ôØ a b\textquotesingle{}}\OtherTok{)}\NormalTok{ , g‚ôØ }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{f‚ôØ a b\textquotesingle{}}\OtherTok{))}\NormalTok{ d\textquotesingle{}}\OtherTok{))}
\end{Highlighting}
\end{Shaded}

where \texttt{‚óÉLens} is the action of \texttt{‚óÉ} on lenses.

By construction, the existence of a Cartesian lens
\texttt{(œÉ\ ,\ œÉ‚ôØ)\ :\ ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤} effectively shows that \texttt{ùî≤}
is closed under \texttt{Œ£}-types, since:

\begin{itemize}
\tightlist
\item
  \texttt{œÉ} maps a pair (A , B) consisting of \texttt{A\ :\ ùì§} and
  \texttt{B\ :\ (u\ A)\ ‚Üí\ ùì§} to a term \texttt{œÉ(A,B)} representing the
  \texttt{Œ£} type. This corresponds to the type formation rule
  \[ \inferrule{\Gamma \vdash A : \mathsf{Type}\\ \Gamma, x : A \vdash B[x] ~ \mathsf{Type}}{\Gamma \vdash \Sigma x : A . B[x] ~ \mathsf{Type}} \]
\item
  For all \texttt{(A\ ,\ B)} as above, \texttt{œÉ‚ôØ\ (A\ ,\ B)} takes a
  term of type \texttt{œÉ\ (A\ ,\ B)} and yields a term
  \texttt{fst\ (œÉ‚ôØ\ (A\ ,\ B))\ :\ A} along with a term
  \texttt{snd\ (œÉ‚ôØ\ (A\ ,\ B))\ :\ B\ (fst\ (œÉ‚ôØ\ (A\ ,\ B)))},
  corresponding to the elimination rules \[
  \inferrule{\Gamma \vdash p : \Sigma x : A . B[x]}{\Gamma \vdash \pi_1(p) : A} \quad \inferrule{\Gamma \vdash p : \Sigma x : A . B[x]}{\Gamma \vdash \pi_2(p) : B[\pi_1(p)]} \]
\item
  The fact that \texttt{œÉ‚ôØ\ (A\ ,\ B)} has is an equivalence implies it
  has an inverse
  \texttt{œÉ‚ôØ‚Åª¬π\ (A\ ,\ B)\ :\ Œ£\ (u\ A)\ (Œª\ x\ ‚Üí\ u\ (B\ x))\ ‚Üí\ u\ (œÉ\ (A\ ,\ B))},
  which takes a pair of terms to a term of the corresponding pair type,
  and thus corresponds to the introduction rule
  \[ \inferrule{\Gamma \vdash a : A\\ \Gamma \vdash b : B[a]}{\Gamma \vdash (a , b) : \Sigma x : A . B[x]} \]
\item
  The fact that \(œÉ‚ôØ‚Åª¬π (A , B)\) is both a left and a right inverse to
  \(œÉ‚ôØ\) then implies the usual \(Œ≤\) and \(Œ∑\) laws for dependent pair
  types
  \[ \pi_1(a , b) = a \quad \pi_2(a , b) = b \quad p = (\pi_1(p) , \pi_2(p)) \]
\end{itemize}

Similarly, the existence of a Cartesian lens \((Œ∑ , Œ∑‚ôØ) : ùï™ ‚áÜ ùî≤\)
implies that \(ùî≤\) contains (a type equivalent to) the unit type, in
that:

\begin{itemize}
\tightlist
\item
  There is an element \texttt{Œ∑\ tt\ :\ ùì§} which represents the unit
  type. This corresponds to the type formation rule
  \[ \inferrule{~}{\Gamma \vdash \top : \mathsf{Type}}\]
\item
  The ``elimination rule'' \texttt{Œ∑‚ôØ\ tt\ :\ u(Œ∑\ tt)\ ‚Üí\ ‚ä§}, applied
  to an element \texttt{x\ :\ u(Œ∑\ tt)} is trivial, in that it simply
  discards \texttt{x}. This corresponds to the fact that, in the
  ordinary type-theoretic presentation, \(\top\) does not have an
  elimination rule.
\item
  However, since this trivial elimination rule has an inverse
  \texttt{Œ∑‚ôØ‚Åª¬π\ tt\ :\ ‚ä§\ ‚Üí\ u\ (Œ∑\ tt)}, it follows that there is a
  (unique) element \texttt{Œ∑‚ôØ‚Åª¬π\ tt\ tt\ :\ u\ (Œ∑\ tt)}, which
  corresponds to the introduction rule for \(\top\):
  \[\inferrule{~}{\Gamma \vdash \mathsf{tt} : \top}\]
\item
  Moreover, the uniqueness of this element corresponds to the
  \(\eta\)-law for \(\top\):
  \[\frac{\Gamma \vdash x : \top}{\Gamma \vdash x = \mathsf{tt}}\]
\end{itemize}

But then, what sorts of laws can we expect Cartesian lenses as above to
obey, and is the existence of such a lens all that is needed to ensure
that the natural model \(ùî≤\) has dependent pair types in the original
sense of Awodey \& Newstead's definition in terms of Cartesian
(pseudo)monads \cite{awodey2014natural,awodey2018polynomial}, or is some
further data required? And what about \texttt{Œ†} types, or other type
formers? To answer these questions, we will need to study the structure
of \texttt{‚óÉ}, along with some closely related functors, in a bit more
detail. In particular, we shall see that the structure of \texttt{‚óÉ} as
a monoidal product on \(\mathbf{Poly}\) reflects many of the basic
identities one expects to hold of \texttt{Œ£} types.

For instance, the associativity of \texttt{‚óÉ} corresponds to the
associativity of \texttt{Œ£}-types.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ ‚óÉAssoc }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 Œ∫0 Œ∫1 Œ∫2}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} 
              \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \KeywordTok{where}

\NormalTok{    ‚óÉassoc }\OtherTok{:} \OtherTok{((}\NormalTok{p ‚óÉ q}\OtherTok{)}\NormalTok{ ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{p ‚óÉ }\OtherTok{(}\NormalTok{q ‚óÉ r}\OtherTok{))}
\NormalTok{    ‚óÉassoc }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª} \OtherTok{((}\NormalTok{a , Œ≥}\OtherTok{)}\NormalTok{ , Œ¥}\OtherTok{)} 
                  \OtherTok{‚Üí} \OtherTok{(}\NormalTok{a , }\OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{Œ≥ b , }\OtherTok{Œª}\NormalTok{ d }\OtherTok{‚Üí}\NormalTok{ Œ¥ }\OtherTok{(}\NormalTok{b , d}\OtherTok{)))))} 
\NormalTok{             , }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{(}\NormalTok{b , }\OtherTok{(}\NormalTok{d , x}\OtherTok{))} \OtherTok{‚Üí} \OtherTok{((}\NormalTok{b , d}\OtherTok{)}\NormalTok{ , x}\OtherTok{))} \OtherTok{)}
    
\NormalTok{    ‚óÉassoc‚Åª¬π }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚óÉ }\OtherTok{(}\NormalTok{q ‚óÉ r}\OtherTok{))}\NormalTok{ ‚áÜ }\OtherTok{((}\NormalTok{p ‚óÉ q}\OtherTok{)}\NormalTok{ ‚óÉ r}\OtherTok{)}
\NormalTok{    ‚óÉassoc‚Åª¬π }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(} \OtherTok{(}\NormalTok{a , }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ fst }\OtherTok{(}\NormalTok{Œ≥ x}\OtherTok{)))} 
\NormalTok{                              , }\OtherTok{(Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ snd }\OtherTok{(}\NormalTok{Œ≥ x}\OtherTok{)}\NormalTok{ y}\OtherTok{)} \OtherTok{))}
\NormalTok{               , }\OtherTok{Œª} \OtherTok{\_} \OtherTok{((}\NormalTok{x , y}\OtherTok{)}\NormalTok{ , z}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{x , }\OtherTok{(}\NormalTok{y , z}\OtherTok{))} \OtherTok{)}

\KeywordTok{open}\NormalTok{ ‚óÉAssoc }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

while the left and right unitors of \texttt{‚óÉ} correspond to the fact
that \texttt{‚ä§} is both a left and a right unit for \texttt{Œ£}-types.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ ‚óÉLRUnit }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \KeywordTok{where}

\NormalTok{    ‚óÉunitl }\OtherTok{:} \OtherTok{(}\NormalTok{ùï™ ‚óÉ p}\OtherTok{)}\NormalTok{ ‚áÜ p}
\NormalTok{    ‚óÉunitl }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª} \OtherTok{(\_}\NormalTok{ , a}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ a tt}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª} \OtherTok{(\_}\NormalTok{ , a}\OtherTok{)}\NormalTok{ x }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{tt , x}\OtherTok{)} \OtherTok{)}

\NormalTok{    ‚óÉunitl‚Åª¬π }\OtherTok{:}\NormalTok{ p ‚áÜ }\OtherTok{(}\NormalTok{ùï™ ‚óÉ p}\OtherTok{)}
\NormalTok{    ‚óÉunitl‚Åª¬π }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{tt , }\OtherTok{Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ a}\OtherTok{))}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{(\_}\NormalTok{ , b}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ b }\OtherTok{)} \OtherTok{)}

\NormalTok{    ‚óÉunitr }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚óÉ ùï™}\OtherTok{)}\NormalTok{ ‚áÜ p}
\NormalTok{    ‚óÉunitr }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ a}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)}\NormalTok{ b }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{b , tt}\OtherTok{))} \OtherTok{)}

\NormalTok{    ‚óÉunitr‚Åª¬π }\OtherTok{:}\NormalTok{ p ‚áÜ }\OtherTok{(}\NormalTok{p ‚óÉ ùï™}\OtherTok{)}
\NormalTok{    ‚óÉunitr‚Åª¬π }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ a , }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ tt}\OtherTok{))}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{(}\NormalTok{b , }\OtherTok{\_)} \OtherTok{‚Üí}\NormalTok{ b}\OtherTok{)} \OtherTok{)}

\KeywordTok{open}\NormalTok{ ‚óÉLRUnit }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

n fact, \texttt{‚óÉ} restricts to a monoidal product on
\(\mathbf{Poly^{Cart}}\), since the functorial action of \texttt{‚óÉ} on
lenses preserves Cartesian lenses,

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{‚óÉ‚óÉCart }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 Œ∫0 Œ∫1 Œ∫2 Œ∫3}\OtherTok{\}}
         \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}}
         \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)} \OtherTok{\{}\NormalTok{g }\OtherTok{:}\NormalTok{ r ‚áÜ s}\OtherTok{\}}
         \OtherTok{‚Üí}\NormalTok{ isCartesian q f }\OtherTok{‚Üí}\NormalTok{ isCartesian s g}
         \OtherTok{‚Üí}\NormalTok{ isCartesian }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{)} \OtherTok{(}\NormalTok{f ‚óÉ‚óÉ[ s ] g}\OtherTok{)}
\NormalTok{‚óÉ‚óÉCart q }\OtherTok{\{}\NormalTok{f }\OtherTok{=} \OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)\}}\NormalTok{ s }\OtherTok{\{}\NormalTok{g }\OtherTok{=} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)\}}\NormalTok{ cf cg }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{=} 
\NormalTok{    pairEquiv }\OtherTok{(}\NormalTok{f‚ôØ a}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ g‚ôØ }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{f‚ôØ a x}\OtherTok{)))} 
              \OtherTok{(}\NormalTok{cf a}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ cg }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{f‚ôØ a x}\OtherTok{)))}
\end{Highlighting}
\end{Shaded}

and all of the above-defined structure morphisms for \texttt{‚óÉ} are
Cartesian.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ ‚óÉAssocCart }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 Œ∫0 Œ∫1 Œ∫2}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} 
                  \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \KeywordTok{where}

\NormalTok{    ‚óÉassocCart }\OtherTok{:}\NormalTok{ isCartesian }\OtherTok{(}\NormalTok{p ‚óÉ }\OtherTok{(}\NormalTok{q ‚óÉ r}\OtherTok{))} \OtherTok{(}\NormalTok{‚óÉassoc p q r}\OtherTok{)}
\NormalTok{    ‚óÉassocCart }\OtherTok{\_} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }
            \OtherTok{(}\NormalTok{ snd }\OtherTok{(}\NormalTok{‚óÉassoc‚Åª¬π p q r}\OtherTok{)} \OtherTok{\_} 
\NormalTok{            , }\OtherTok{(} \OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} \OtherTok{)} \OtherTok{)}
    
\NormalTok{    ‚óÉassoc‚Åª¬πCart }\OtherTok{:}\NormalTok{ isCartesian }\OtherTok{((}\NormalTok{p ‚óÉ q}\OtherTok{)}\NormalTok{ ‚óÉ r}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉassoc‚Åª¬π p q r}\OtherTok{)}
\NormalTok{    ‚óÉassoc‚Åª¬πCart }\OtherTok{\_} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }
            \OtherTok{(}\NormalTok{ snd }\OtherTok{(}\NormalTok{‚óÉassoc p q r}\OtherTok{)} \OtherTok{\_} 
\NormalTok{            , }\OtherTok{(} \OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} \OtherTok{)} \OtherTok{)}

\KeywordTok{open}\NormalTok{ ‚óÉAssocCart }\KeywordTok{public}

\KeywordTok{module}\NormalTok{ ‚óÉLRUnitCart }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \KeywordTok{where}

\NormalTok{    ‚óÉunitlCart }\OtherTok{:}\NormalTok{ isCartesian p }\OtherTok{(}\NormalTok{‚óÉunitl p}\OtherTok{)}
\NormalTok{    ‚óÉunitlCart }\OtherTok{\_} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }
            \OtherTok{(}\NormalTok{ snd }\OtherTok{(}\NormalTok{‚óÉunitl‚Åª¬π p}\OtherTok{)} \OtherTok{\_} 
\NormalTok{            , }\OtherTok{((Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} \OtherTok{)}

\NormalTok{    ‚óÉunitl‚Åª¬πCart }\OtherTok{:}\NormalTok{ isCartesian }\OtherTok{(}\NormalTok{ùï™ ‚óÉ p}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉunitl‚Åª¬π p}\OtherTok{)}
\NormalTok{    ‚óÉunitl‚Åª¬πCart }\OtherTok{\_} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }
            \OtherTok{(}\NormalTok{ snd }\OtherTok{(}\NormalTok{‚óÉunitl p}\OtherTok{)} \OtherTok{\_} 
\NormalTok{            , }\OtherTok{((Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} \OtherTok{)}

\NormalTok{    ‚óÉunitrCart }\OtherTok{:}\NormalTok{ isCartesian p }\OtherTok{(}\NormalTok{‚óÉunitr p}\OtherTok{)}
\NormalTok{    ‚óÉunitrCart }\OtherTok{\_} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }
            \OtherTok{(}\NormalTok{ snd }\OtherTok{(}\NormalTok{‚óÉunitr‚Åª¬π p}\OtherTok{)} \OtherTok{\_} 
\NormalTok{            , }\OtherTok{((Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} \OtherTok{)}

\NormalTok{    ‚óÉunitr‚Åª¬πCart }\OtherTok{:}\NormalTok{ isCartesian }\OtherTok{(}\NormalTok{p ‚óÉ ùï™}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉunitr‚Åª¬π p}\OtherTok{)}
\NormalTok{    ‚óÉunitr‚Åª¬πCart }\OtherTok{\_} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }
            \OtherTok{(}\NormalTok{ snd }\OtherTok{(}\NormalTok{‚óÉunitr p}\OtherTok{)} \OtherTok{\_} 
\NormalTok{            , }\OtherTok{((Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} \OtherTok{)}

\KeywordTok{open}\NormalTok{ ‚óÉLRUnitCart }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

We should expect, then, for these equivalences to be somehow reflected
in the structure of a Cartesian lenses \texttt{Œ∑\ :\ ùï™\ ‚áÜ\ ùî≤} and
\texttt{Œº\ :\ ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤}. This would be the case, e.g., if the
following diagrams in \(\mathbf{Poly^{Cart}}\) were to commute \[
\begin{tikzcd}
    {y \triangleleft \mathfrak{u}} & {\mathfrak{u} \triangleleft \mathfrak{u} } & {\mathfrak{u} \triangleleft y} \\
    & {\mathfrak{u}}
    \arrow["{\eta \triangleleft \mathfrak{u}}", from=1-1, to=1-2]
    \arrow["{\mathsf{\triangleleft unitl}}"{description}, from=1-1, to=2-2]
    \arrow["\mu", from=1-2, to=2-2]
    \arrow["{\mathfrak{u} \triangleleft \eta}"', from=1-3, to=1-2]
    \arrow["{\mathsf{\triangleleft unitr}}"{description}, from=1-3, to=2-2]
\end{tikzcd} \qquad \begin{tikzcd}
    {(\mathfrak{u} \triangleleft \mathfrak{u}) \triangleleft \mathfrak{u}} & {\mathfrak{u} \triangleleft (\mathfrak{u} \triangleleft \mathfrak{u})} & {\mathfrak{u} \triangleleft \mathfrak{u}} \\
    {\mathfrak{u} \triangleleft \mathfrak{u}} && {\mathfrak{u}}
    \arrow["{\mathsf{\triangleleft assoc}}", from=1-1, to=1-2]
    \arrow["{\mu \triangleleft \mathfrak{u}}"', from=1-1, to=2-1]
    \arrow["{\mathfrak{u} \triangleleft \mu}", from=1-2, to=1-3]
    \arrow["\mu", from=1-3, to=2-3]
    \arrow["\mu"', from=2-1, to=2-3]
\end{tikzcd}
\]

One may recognize these as the usual diagrams for a monoid in a monoidal
category, hence (since \texttt{‚óÉ} corresponds to composition of
polynomial endofunctors) for a \emph{monad} as typically defined.
However, because of the higher-categorical structure of types in HoTT,
we should not only ask for these diagrams to commute, but for the cells
exhibiting that these diagrams commute to themselves be subject to
higher coherences, and so on, giving \texttt{ùî≤} not the structure of a
(Cartesian) monad, but rather of a (Cartesian) \emph{\(\infty\)-monad}.

Yet demonstrating that \(ùî≤\) is an \(\infty\)-monad involves specifying
a potentially infinite amount of coherence data. Have we therefore
traded both the Scylla of equality-up-to-isomorphism and the Charybdis
of strictness for an even worse fate of higher coherence hell? The
answer to this question, surprisingly, is negative, as there is a way to
implicitly derive all of this data from a single axiom, which
corresponds to the characteristic axiom of HoTT itself: univalence. To
show this, we now introduce the central concept of this paper -- that of
a \emph{polynomial universe}.

\chapter{Polynomial Universes}\label{polynomial-universes}

\section{Univalence}\label{univalence}

For any polynomial \texttt{ùî≤\ =\ (ùì§\ ,\ El)}, we say that \texttt{ùî≤} is
\emph{univalent} if \texttt{ùî≤} is a \emph{subterminal object} in
\(\mathbf{Poly^{Cart}}\), i.e.~for any other polynomial \texttt{p}, the
type of Cartesian lenses \texttt{p\ ‚áÜ\ ùî≤} is a proposition, i.e.~any two
Cartesian lenses with codomain \texttt{ùî≤} are equal.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{isUnivalent }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì Œ∫ }\OtherTok{‚Üí}\NormalTok{ Setœâ}
\NormalTok{isUnivalent u }\OtherTok{=} 
    \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì\textquotesingle{} Œ∫\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì\textquotesingle{} Œ∫\textquotesingle{}}\OtherTok{\}}
      \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{f g }\OtherTok{:}\NormalTok{ p ‚áÜ u}\OtherTok{\}}
      \OtherTok{‚Üí}\NormalTok{ isCartesian u f}
      \OtherTok{‚Üí}\NormalTok{ isCartesian u g}
      \OtherTok{‚Üí}\NormalTok{ EqLens u f g}
    
\end{Highlighting}
\end{Shaded}

We call this property of polynomials univalence in analogy with the
usual univalence axiom of HoTT. Indeed, the univalence axiom can be
equivalently stated as the fact that the polynomial functor
\texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)} is itself univalent.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{postulate}
\NormalTok{    ua }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ isUnivalent }\OtherTok{(}\NormalTok{Type ‚Ñì , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

We shall refer to univalent polynomial functors as \emph{polynomial
universes.} f we think of a polynomial \texttt{p} as representing a
family of types, then what this tells us is that if \texttt{ùî≤} is a
polynomial universe, there is essentially at most one way for \texttt{ùî≤}
to contain the types represented by \texttt{p}, where Containment is
here understood as existence of a Cartesian lens \texttt{p\ ‚áÜ\ ùî≤}. In
this case, we say that \texttt{ùî≤} \emph{classifies} the types
represented by \texttt{p}.

As a direct consequence of this fact, it follows that every diagram
consisting of parallel Cartesian lenses into a polynomial universe
automatically commutes, and moreover, every higher diagram that can be
formed between the cells exhibiting such commutation must also commute,
etc.

Hence the fact that \texttt{ùî≤} must satisfy the laws of a monad if there
are Cartesian lenses \texttt{Œ∑\ :\ ùï™\ ‚áÜ\ ùî≤} and
\texttt{Œº\ :\ ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤} follows immediately from the above theorem
and the closure of Cartesian lenses under composition:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ UnivMonad }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{ùî≤ }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \OtherTok{(}\NormalTok{univ }\OtherTok{:}\NormalTok{ isUnivalent ùî≤}\OtherTok{)}
                 \OtherTok{(}\NormalTok{Œ∑ }\OtherTok{:}\NormalTok{ ùï™ ‚áÜ ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{Œº }\OtherTok{:} \OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)}\NormalTok{ ‚áÜ ùî≤}\OtherTok{)}
                 \OtherTok{(}\NormalTok{cŒ∑ }\OtherTok{:}\NormalTok{ isCartesian ùî≤ Œ∑}\OtherTok{)} \OtherTok{(}\NormalTok{cŒº }\OtherTok{:}\NormalTok{ isCartesian ùî≤ Œº}\OtherTok{)} \KeywordTok{where}

\NormalTok{    univ‚óÉunitl }\OtherTok{:}\NormalTok{ EqLens ùî≤ }\OtherTok{(}\NormalTok{‚óÉunitl ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{Œ∑ ‚óÉ‚óÉ[ ùî≤ ] }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{))}\NormalTok{ Œº}\OtherTok{)}
\NormalTok{    univ‚óÉunitl }\OtherTok{=}\NormalTok{ univ }\OtherTok{(}\NormalTok{‚óÉunitlCart ùî≤}\OtherTok{)} 
                      \OtherTok{(}\NormalTok{compCartesian ùî≤ }\OtherTok{(}\NormalTok{‚óÉ‚óÉCart ùî≤ ùî≤ cŒ∑ }\OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{))}\NormalTok{ cŒº}\OtherTok{)}

\NormalTok{    univ‚óÉunitr }\OtherTok{:}\NormalTok{ EqLens ùî≤ }\OtherTok{(}\NormalTok{‚óÉunitr ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{((}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ ‚óÉ‚óÉ[ ùî≤ ] Œ∑}\OtherTok{)}\NormalTok{ Œº}\OtherTok{)}
\NormalTok{    univ‚óÉunitr }\OtherTok{=}\NormalTok{ univ }\OtherTok{(}\NormalTok{‚óÉunitrCart ùî≤}\OtherTok{)} 
                      \OtherTok{(}\NormalTok{compCartesian ùî≤ }\OtherTok{(}\NormalTok{‚óÉ‚óÉCart ùî≤ ùî≤ }\OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{)}\NormalTok{ cŒ∑}\OtherTok{)}\NormalTok{ cŒº}\OtherTok{)}


\NormalTok{    univ‚óÉassoc }\OtherTok{:}\NormalTok{ EqLens ùî≤ }\OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{Œº ‚óÉ‚óÉ[ ùî≤ ] }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{))}\NormalTok{ Œº}\OtherTok{)}
                          \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{‚óÉassoc ùî≤ ùî≤ ùî≤}\OtherTok{)}
                                  \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{((}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ ‚óÉ‚óÉ[ ùî≤ ] Œº}\OtherTok{)}\NormalTok{ Œº}\OtherTok{))}
\NormalTok{    univ‚óÉassoc }\OtherTok{=}\NormalTok{ univ }\OtherTok{(}\NormalTok{compCartesian ùî≤ }\OtherTok{(}\NormalTok{‚óÉ‚óÉCart ùî≤ ùî≤ cŒº }\OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{))}\NormalTok{ cŒº}\OtherTok{)}
                      \OtherTok{(}\NormalTok{compCartesian ùî≤ }\OtherTok{(}\NormalTok{‚óÉassocCart ùî≤ ùî≤ ùî≤}\OtherTok{)}
                                       \OtherTok{(}\NormalTok{compCartesian ùî≤ }
                                         \OtherTok{(}\NormalTok{‚óÉ‚óÉCart ùî≤ ùî≤ }\OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{)}\NormalTok{ cŒº}\OtherTok{)}\NormalTok{ cŒº}\OtherTok{))}

\KeywordTok{open}\NormalTok{ UnivMonad }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

And more generally, all the higher coherences of an \(\infty\)-monad
would follow -- if we bothered to write them out -- from the
contractibility of the types of Cartesian lenses \texttt{p\ ‚áÜ\ ùî≤} that
can be formed using \texttt{Œº} and \texttt{Œ∑}.

\subsection{Examples of Polynomial
Universes}\label{examples-of-polynomial-universes}

We have so far seen that polynomial universes are quite special objects
in the theory of polynomial functors in HoTT, but what good would such
special objects do us if they turned out to be exceedingly rare or
difficult to construct?

In fact, polynomial universes are surprisingly plentiful in univalent
type theory. We have already seen how the univalence axiom implies that
\texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)} is a polynomial universe. From this
single example, a plethora of others can be seen to follow, many of
which encompass familiar constructs from programming and mathematics.

In a sense, the polynomial \texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)} is
\emph{universal} among polynomials in \(\mathbf{Poly}^{\mathbf{Cart}}\)
in that, for any polynomial \texttt{p}, there is a (necessarily unique,
by univalence) Cartesian morphism \texttt{p\ ‚áÜ\ (Type\ ,\ Œª\ X\ ‚Üí\ X)}.
Or rather, there would be, were it not for the size issues preventing
\texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)} from being a single object. Instead, it
can more accurately be said that the family of polynomials
\texttt{(Type\ ‚Ñì\ ,\ Œª\ X\ ‚Üí\ X)} for all \texttt{‚Ñì\ :\ Level} is
universal among polynomials in \(\mathbf{Poly}^{\mathbf{Cart}}\) -- this
can be shown straightforwardly as follows:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ PolyCartUniv }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \KeywordTok{where}

\NormalTok{    classifier }\OtherTok{:}\NormalTok{ p ‚áÜ }\OtherTok{(}\NormalTok{Type Œ∫ , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)}
\NormalTok{    classifier }\OtherTok{=} \OtherTok{(}\NormalTok{snd p , }\OtherTok{Œª} \OtherTok{\_}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ b}\OtherTok{)}

\NormalTok{    classifierCart }\OtherTok{:}\NormalTok{ isCartesian }\OtherTok{(}\NormalTok{Type Œ∫ , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)}\NormalTok{ classifier}
\NormalTok{    classifierCart }\OtherTok{\_} \OtherTok{=}\NormalTok{ idIsEquiv}
\end{Highlighting}
\end{Shaded}

In other words, every polynomial functor \texttt{p} is classified by
some polynomial universe. Moreover, if the classifying morphism
\texttt{p\ ‚áÜ\ (Type\ Œ∫\ ,\ Œª\ X\ ‚Üí\ X)} is a Vertical embedding (i.e.~a
monomorphism in \(\mathbf{Poly}^{\mathbf{Cart}}\)), then \texttt{p}
itself is also a polynomial universe -- for any pair of Cartesian
morphisms \texttt{f\ g\ :\ q\ ‚áÜ\ p}, since
\texttt{(Type\ Œ∫\ ,\ Œª\ X\ ‚Üí\ X)} is univalent, we have
\texttt{classifier\ ‚àò\ f\ ‚â°\ classifier\ ‚àò\ g}, but then since
\texttt{classifier} is assumed to be a monomorphism, this implies that
\texttt{f\ ‚â°\ g}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    polyCartUniv }\OtherTok{:}\NormalTok{ isVerticalEmbedding }\OtherTok{(}\NormalTok{Type Œ∫ , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)}\NormalTok{ classifier }
                   \OtherTok{‚Üí}\NormalTok{ isUnivalent p}
\NormalTok{    polyCartUniv veclassifier cf cg }\OtherTok{=} 
\NormalTok{        VertEmbedding‚ÜíPolyCartMono}
            \OtherTok{(}\NormalTok{Type Œ∫ , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)}\NormalTok{ classifierCart veclassifier cf cg }
            \OtherTok{(}\NormalTok{ua }\OtherTok{(}\NormalTok{compCartesian }\OtherTok{\_}\NormalTok{ cf classifierCart}\OtherTok{)} 
                \OtherTok{(}\NormalTok{compCartesian }\OtherTok{\_}\NormalTok{ cg classifierCart}\OtherTok{))}

\KeywordTok{open}\NormalTok{ PolyCartUniv }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

It follows that, for any type family \texttt{P\ :\ Type\ ‚Üí\ Type}, we
can create a polynomial \emph{sub-universe} of
\texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)} by restricting to those types \texttt{X}
for which there \emph{merely} exists an inhabitant of \texttt{P\ X}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ SubUniv }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{P }\OtherTok{:}\NormalTok{ Type ‚Ñì }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{)} \KeywordTok{where}

\NormalTok{    subUniv }\OtherTok{:}\NormalTok{ Poly }\OtherTok{(}\NormalTok{lsuc ‚Ñì}\OtherTok{)}\NormalTok{ ‚Ñì}
\NormalTok{    subUniv }\OtherTok{=} \OtherTok{(}\NormalTok{Œ£ }\OtherTok{(}\NormalTok{Type ‚Ñì}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ ‚à• P X ‚à•}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª} \OtherTok{(}\NormalTok{X , }\OtherTok{\_)} \OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)}

\NormalTok{    subUnivClassifierVertEmb }\OtherTok{:}
\NormalTok{        isVerticalEmbedding }\OtherTok{(}\NormalTok{Type ‚Ñì , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)} \OtherTok{(}\NormalTok{classifier subUniv}\OtherTok{)}
\NormalTok{    subUnivClassifierVertEmb }\OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }
            \OtherTok{(} \OtherTok{(Œª}\NormalTok{ e }\OtherTok{‚Üí}\NormalTok{ pairEq e ‚à•{-}‚à•IsProp}\OtherTok{)} 
\NormalTok{            , }\OtherTok{(} \OtherTok{(} \OtherTok{Œª}\NormalTok{ e }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{pairEq }\OtherTok{(}\NormalTok{ap }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{classifier subUniv}\OtherTok{))}\NormalTok{ e}\OtherTok{)} 
\NormalTok{                                ‚à•{-}‚à•IsProp}\OtherTok{)} 
\NormalTok{                       ‚â°‚å© ap }\OtherTok{(Œª}\NormalTok{ e\textquotesingle{} }\OtherTok{‚Üí} 
\NormalTok{                                 pairEq }\OtherTok{(}\NormalTok{ap }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{classifier subUniv}\OtherTok{))} 
\NormalTok{                                            e}\OtherTok{)}\NormalTok{ e\textquotesingle{}}\OtherTok{)} 
\NormalTok{                              ‚à•{-}‚à•‚â°Contr ‚å™ }\OtherTok{(} \OtherTok{\_} 
\NormalTok{                       ‚â°‚å© }\OtherTok{(}\NormalTok{pairEqŒ∑ e}\OtherTok{)}\NormalTok{ ‚å™ }
                       \OtherTok{(}\NormalTok{e ‚ñ°}\OtherTok{)))} 
\NormalTok{                , }\OtherTok{(Œª}\NormalTok{ e }\OtherTok{‚Üí}\NormalTok{ pairEqŒ≤1 e ‚à•{-}‚à•IsProp}\OtherTok{)} \OtherTok{)} \OtherTok{)}
    
\NormalTok{    subUnivIsUniv }\OtherTok{:}\NormalTok{ isUnivalent subUniv}
\NormalTok{    subUnivIsUniv }\OtherTok{=}\NormalTok{ polyCartUniv subUniv subUnivClassifierVertEmb}

\KeywordTok{open}\NormalTok{ SubUniv }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

As a first example of a polynomial universe other than
\texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)}, then, we may consider the polynomial
universe of \emph{propositions} \texttt{‚Ñô}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ PropUniv }\KeywordTok{where}

\NormalTok{    ‚Ñô }\OtherTok{:}\NormalTok{ Poly }\OtherTok{(}\NormalTok{lsuc lzero}\OtherTok{)}\NormalTok{ lzero}
\NormalTok{    ‚Ñô }\OtherTok{=}\NormalTok{ subUniv isProp}
\end{Highlighting}
\end{Shaded}

If we write out explicitly the polynomial endofunctor defined by
\texttt{‚Ñô} we see that it has the following form: \[
y \mapsto \sum_{\phi : \mathbf{Prop}} y^\phi
\] This endofunctor (in fact it is a monad) is well-known in type theory
by another name -- the \emph{partiality} monad. Specifically, this is
the monad \texttt{M} whose kleisli morphisms \texttt{A\ ‚Üí\ M\ B}
correspond to \emph{partial functions} from \texttt{A} to \texttt{B},
that associate to each element \texttt{a\ :\ A}, a proposition
\texttt{def\ f\ a} indicating whether or not the value of \texttt{f} is
defined at \texttt{a}, and a function \texttt{val\ :\ def\ f\ a\ ‚Üí\ B}
that takes a proof that \texttt{f} is defined at \texttt{a} to its value
at \texttt{a}.

If we return to the original example of the polynomial universe
\texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)} we see that the associated polynomial
endofunctor (which, by the above argument, is also a monad) has a
similar form. \[
y \mapsto \sum_{X : \mathbf{Type}} y^X
\] In this case, we can think of this as a ``proof relevant'' partiality
monad \texttt{M}, such that a function \texttt{f\ :\ A\ ‚Üí\ M\ B}
associates to each element \texttt{a\ :\ A} a \emph{type}
\texttt{Def\ f\ a} of proofs that \texttt{f} is defined at \texttt{a},
and a function \texttt{val\ :\ Def\ f\ a\ ‚Üí\ B}.\footnote{the conception
  of the monad determined by \texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)} as a ``proof
  relevant'' partiality monad was communicated to the first author
  during private conversations with Jonathan Sterling.}

More generally, we can say that, for any polynomial universe closed
under dependent pair types, the associated monad will be a kind of
(potentially proof-relevant) partiality monad, where the structure of
the polynomial universe serves to dictate which types can count as
\emph{evidence} for whether or not a value is defined.

\subsubsection{Rezk Completion}\label{rezk-completion}

In fact, we can show that for \emph{any} polynomial functor, there
exists a corresponding polynomial universe, using a familiar construct
from the theory of categories in HoTT -- the \emph{Rezk Completion.}
\cite{ahrens2015univalent} We will show that this construction allows us
to quotient any polynomial functor to a corresponding univalent
polynomial, i.e.~a polynomial universe.

We obtain the Rezk completion of \texttt{p} as the image factorization
in \(\mathbf{Poly^{Cart}}\) of the classifying morphism of \texttt{p}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ RezkCompletion }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \KeywordTok{where}

\NormalTok{    Rezk }\OtherTok{:}\NormalTok{ Poly }\OtherTok{(}\NormalTok{lsuc Œ∫}\OtherTok{)}\NormalTok{ Œ∫}
\NormalTok{    Rezk }\OtherTok{=}\NormalTok{ cartIm }\OtherTok{(}\NormalTok{Type Œ∫ , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)} 
            \OtherTok{(}\NormalTok{classifier p}\OtherTok{)} \OtherTok{(}\NormalTok{classifierCart p}\OtherTok{)}

\NormalTok{    ‚ÜíRezk }\OtherTok{:}\NormalTok{ p ‚áÜ Rezk}
\NormalTok{    ‚ÜíRezk }\OtherTok{=}\NormalTok{ factorcart1 }\OtherTok{(}\NormalTok{Type Œ∫ , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)} 
                \OtherTok{(}\NormalTok{classifier p}\OtherTok{)} \OtherTok{(}\NormalTok{classifierCart p}\OtherTok{)}

\NormalTok{    Rezk‚Üí }\OtherTok{:}\NormalTok{ Rezk ‚áÜ }\OtherTok{(}\NormalTok{Type Œ∫ , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)}
\NormalTok{    Rezk‚Üí }\OtherTok{=}\NormalTok{ factorcart2 }\OtherTok{(}\NormalTok{Type Œ∫ , }\OtherTok{Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ X}\OtherTok{)} 
                \OtherTok{(}\NormalTok{classifier p}\OtherTok{)} \OtherTok{(}\NormalTok{classifierCart p}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

The polynomial \texttt{Rezk} defined above can be seen to have the same
form as a subuniverse of \texttt{(Type\ ,\ Œª\ X\ ‚Üí\ X)}; hence it is a
polynomial universe, as desired.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    RezkUniv }\OtherTok{:}\NormalTok{ isUnivalent Rezk}
\NormalTok{    RezkUniv }\OtherTok{=}\NormalTok{ subUnivIsUniv }\OtherTok{(Œª}\NormalTok{ X }\OtherTok{‚Üí}\NormalTok{ Œ£ }\OtherTok{(}\NormalTok{fst p}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{snd p a}\OtherTok{)}\NormalTok{ ‚â° X}\OtherTok{))}

\KeywordTok{open}\NormalTok{ RezkCompletion }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

As an example of how the Rezk completion allows us to ``upgrade'' a
polynomial functor (a polynomial monad, even) into a polynomial
universe, consider the following definition of the finite ordinals as a
family of types indexed by the type \texttt{Nat} of natural numbers:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ FinUniv }\KeywordTok{where}
    \KeywordTok{open} \KeywordTok{import}\NormalTok{ Agda}\OtherTok{.}\NormalTok{Builtin}\OtherTok{.}\NormalTok{Nat}
\end{Highlighting}
\end{Shaded}

We first define the standard ordering on natural numbers:

\begin{Shaded}
\begin{Highlighting}[]
    \KeywordTok{data} \OtherTok{\_}\NormalTok{‚â∫}\OtherTok{\_} \OtherTok{:}\NormalTok{ Nat }\OtherTok{‚Üí}\NormalTok{ Nat }\OtherTok{‚Üí}\NormalTok{ Type lzero }\KeywordTok{where}
\NormalTok{        zero\textless{} }\OtherTok{:} \OtherTok{\{}\NormalTok{n }\OtherTok{:}\NormalTok{ Nat}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ zero ‚â∫ suc n}
\NormalTok{        succ\textless{} }\OtherTok{:} \OtherTok{\{}\NormalTok{n m }\OtherTok{:}\NormalTok{ Nat}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ n ‚â∫ m }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{suc n}\OtherTok{)}\NormalTok{ ‚â∫ }\OtherTok{(}\NormalTok{suc m}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

We then define the \texttt{n}th finite ordinal as the subtype of
\texttt{Nat} consisting of all numbers \texttt{m} strictly less than
\texttt{n}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    Fin }\OtherTok{:}\NormalTok{ Nat }\OtherTok{‚Üí}\NormalTok{ Type lzero}
\NormalTok{    Fin n }\OtherTok{=}\NormalTok{ Œ£ Nat }\OtherTok{(Œª}\NormalTok{ m }\OtherTok{‚Üí}\NormalTok{ m ‚â∫ n}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

From these data, we can straightforwardly define a polynomial as follows

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    œâ }\OtherTok{:}\NormalTok{ Poly lzero lzero}
\NormalTok{    œâ }\OtherTok{=} \OtherTok{(}\NormalTok{Nat , Fin}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

If we once again write out the polynomial endofunctor determined by
these data \[
    y \mapsto \sum_{n \in \mathbb{N}} y^{\{m \in \mathbb{N} \mid m < n\}}
\] we see that this functor has a familiar form -- it is the \emph{list
monad} that maps a type \(y\) to the disjoint union of the types of
\(n\)-tuples of elements of \(y\), for all \(n \in \mathbb{N}\).

As defined, \(\omega\) is not a polynomial universe; the type
\texttt{Nat} is a set, and so for any \texttt{n\ :\ Nat}, the type
\texttt{n\ ‚â°\ n} is contractible, i.e.~it has a single inhabitant, while
the type of equivalences \texttt{Fin\ n\ ‚âÉ\ Fin\ n} consists of all
permutations of \texttt{n} elements, so these two types cannot be
equivalent. However, we can now use the Rezk completion to obtain a
polynomial universe from \texttt{œâ}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    ùîΩin }\OtherTok{:}\NormalTok{ Poly }\OtherTok{(}\NormalTok{lsuc lzero}\OtherTok{)}\NormalTok{ lzero}
\NormalTok{    ùîΩin }\OtherTok{=}\NormalTok{ Rezk œâ}
\end{Highlighting}
\end{Shaded}

If we write out an explicit description of \texttt{ùîΩin}, we see that it
is the subuniverse of types \texttt{X} that are merely equivalent to
some \texttt{Fin\ n}. In constructive mathematics, these types (they are
necessarily sets) are known as \emph{Bishop finite sets}. Hence the
polynomial universe obtained by Rezk completion of the list monad is
precisely the subuniverse of types spanned by (Bishop) finite sets.

\chapter{\texorpdfstring{\(\Pi\)-Types \& Distributive
Laws}{\textbackslash Pi-Types \& Distributive Laws}}\label{pi-types-distributive-laws}

We have so far considered how polynomial universes may be equipped with
structure to interpret the unit type and dependent pair types. We have
not yet, however, said much in the way of \emph{dependent function
types.} In order to rectify this omission, it will first be prudent to
consider some additional structure on the category of polynomial
functors -- specifically a new functor
\({\upuparrows}[\_] : \mathsf{Tw}(\mathbf{Poly}) \times \mathbf{Poly} \to \mathbf{Poly}\)
that plays a similar role for \texttt{Œ†} types as the composition
\(\triangleleft : \mathbf{Poly} \times \mathbf{Poly} \to \mathbf{Poly}\)
played for \texttt{Œ£} types, and which in turn bears a close connection
to \emph{distributive laws} in \(\mathbf{Poly}\).

\section{\texorpdfstring{The \(\upuparrows\) and
\({\upuparrows}[\_][\_]\)
Functors}{The \textbackslash upuparrows and \{\textbackslash upuparrows\}{[}\textbackslash\_{]}{[}\textbackslash\_{]} Functors}}\label{the-upuparrows-and-upuparrows__-functors}

The \(\upuparrows\) functor can be loosely defined as the solution to
the following problem: given a polynomial universe \texttt{ùî≤}, find
\texttt{ùî≤\ ‚áà\ ùî≤} such that \texttt{ùî≤} classifies \texttt{ùî≤\ ‚áà\ ùî≤} if and
only if \texttt{ùî≤} has the structure to interpret \texttt{Œ†} types (in
the same way that \texttt{ùî≤} classifies \texttt{ùî≤\ ‚óÉ\ ùî≤} if and only if
\texttt{ùî≤} has the structure to interpret \texttt{Œ£} types).
Generalizing this to arbitrary pairs of polynomials
\(p = (A , B), ~ q = (C , D)\) then yields the following formula for
\(p \upuparrows q\): \[
p \upuparrows q = \sum_{(a , f) : \sum_{a : A} C^{B(a)}} y^{\prod_{b : B(a)} D(f(b))}
\]

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{‚áà}\OtherTok{\_} \OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì0 Œ∫0 }\OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì1 Œ∫1 }
      \OtherTok{‚Üí}\NormalTok{ Poly }\OtherTok{(}\NormalTok{‚Ñì0 ‚äî Œ∫0 ‚äî ‚Ñì1}\OtherTok{)} \OtherTok{(}\NormalTok{Œ∫0 ‚äî Œ∫1}\OtherTok{)}
\OtherTok{(}\NormalTok{A , B}\OtherTok{)}\NormalTok{ ‚áà }\OtherTok{(}\NormalTok{C , D}\OtherTok{)} \OtherTok{=} 
    \OtherTok{(}\NormalTok{ Œ£ A }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ B a }\OtherTok{‚Üí}\NormalTok{ C}\OtherTok{)} 
\NormalTok{    , }\OtherTok{(Œª} \OtherTok{(}\NormalTok{a , f}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{b }\OtherTok{:}\NormalTok{ B a}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ D }\OtherTok{(}\NormalTok{f b}\OtherTok{)))}
\end{Highlighting}
\end{Shaded}

Note that this construction is straightforwardly functorial with respect
to arbitrary lenses in its 2nd argument. Functoriality of the 1st
argument is trickier, however. For reasons that will become apparent
momentarily, we define the functorial action
\(p \upuparrows q \leftrightarrows p' \upuparrows q\) of \(\upuparrows\)
on a lens \(f : p \leftrightarrows p'\) equipped with a left inverse
\(f' : p' \leftrightarrows p\), i.e.~such that
\(f' \circ f = \text{id}_p\).
\footnote{To see why this is the right choice of morphism for which ‚áà is functorial in its first argument, we note that pairs consisting of a morphism and a left inverse for it are equivalently the morphisms between identity morphisms in the \emph{twisted arrow category} of $\poly$, i.e. diagrams of the following form: $$
\begin{array}{ccc}
p & \to & q\\
= & & =\\
p & \leftarrow & q
\end{array}
$$}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{‚áàLens }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 Œ∫0 Œ∫1 Œ∫2 Œ∫3}\OtherTok{\}}
        \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)}
        \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)}
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ r}\OtherTok{)} \OtherTok{(}\NormalTok{f\textquotesingle{} }\OtherTok{:}\NormalTok{ r ‚áÜ p}\OtherTok{)} 
        \OtherTok{‚Üí}\NormalTok{ EqLens p }\OtherTok{(}\NormalTok{id p}\OtherTok{)} \OtherTok{(}\NormalTok{comp p f f\textquotesingle{}}\OtherTok{)}
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{g }\OtherTok{:}\NormalTok{ q ‚áÜ s}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà q}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{r ‚áà s}\OtherTok{)}
\NormalTok{‚áàLens }\OtherTok{\{}\NormalTok{p }\OtherTok{=}\NormalTok{ p}\OtherTok{\}}\NormalTok{ r s }\OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)} \OtherTok{(}\NormalTok{f\textquotesingle{} , f\textquotesingle{}‚ôØ}\OtherTok{)} \OtherTok{(}\NormalTok{e , e‚ôØ}\OtherTok{)} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{=} 
    \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f a , }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{f‚ôØ a x}\OtherTok{)))))}
\NormalTok{    , }\OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)}\NormalTok{ œú x }\OtherTok{‚Üí} 
\NormalTok{         g‚ôØ }\OtherTok{(}\NormalTok{Œ≥ x}\OtherTok{)} 
            \OtherTok{(}\NormalTok{transp }\OtherTok{(Œª}\NormalTok{ y }\OtherTok{‚Üí}\NormalTok{ snd s }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{Œ≥ y}\OtherTok{)))} 
                    \OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{e‚ôØ a x}\OtherTok{))} 
                    \OtherTok{(}\NormalTok{œú }\OtherTok{(}\NormalTok{f\textquotesingle{}‚ôØ }\OtherTok{(}\NormalTok{f a}\OtherTok{)} \OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd p}\OtherTok{)} \OtherTok{(}\NormalTok{e a}\OtherTok{)}\NormalTok{ x}\OtherTok{)))))} \OtherTok{)}
\end{Highlighting}
\end{Shaded}

By construction, the existence of a Cartesian lens
\texttt{(œÄ\ ,\ œÄ‚ôØ)\ :\ ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤} effectively shows that \texttt{ùî≤}
is closed under \texttt{Œ†}-types, since:

\begin{itemize}
\tightlist
\item
  \texttt{œÄ} maps a pair \texttt{(A\ ,\ B)} consisting of
  \texttt{A\ :\ ùì§} and \texttt{B\ :\ u(A)\ ‚Üí\ ùì§} to a term
  \texttt{œÄ(A,B)} representing the corresponding \texttt{Œ†} type. This
  corresponds to the type formation rule
  \[ \inferrule{\Gamma \vdash A : \mathsf{Type}\\ \Gamma, x : A \vdash B[x] ~ \mathsf{Type}}{\Gamma \vdash \Pi x : A . B[x] ~ \mathsf{Type}} \]
\item
  The ``elimination rule'' \texttt{œÄ‚ôØ\ (A\ ,\ B)}, for any pair
  \texttt{(A\ ,\ B)} as above, maps an element \texttt{f\ :\ œÄ(A,B)} to
  a function \texttt{œÄ‚ôØ\ (A\ ,\ B)\ f\ :\ (a\ :\ u(A))\ ‚Üí\ u\ (B\ x)}
  which takes an element \texttt{x} of \texttt{A} and yields an element
  of \texttt{B\ x}. This corresponds to the rule for function
  application: \[
  \inferrule{\Gamma \vdash f : \Pi x : A . B[x]\\ \Gamma \vdash a : A}{\Gamma \vdash f ~ a : B[a]}
  \]
\item
  Since \texttt{œÄ‚ôØ\ (A\ ,\ B)} is an equivalence, it follows that there
  is an inverse
  \texttt{œÄ‚ôØ‚Åª¬π\ (A\ ,\ B)\ :\ ((x\ :\ u(A))\ ‚Üí\ u(B(x))\ ‚Üí\ u(œÄ(A,B))},
  which corresponds to \(\lambda\)-abstraction: \[
  \inferrule{\Gamma, x : A \vdash f[x] : B[x]}{\Gamma \vdash \lambda x . f[x] : \Pi x : A . B[x]}
  \]
\item
  The fact that \texttt{œÄ‚ôØ‚Åª¬π\ (A\ ,\ B)} is both a left and a right
  inverse to \texttt{œÄ‚ôØ} then corresponds to the \(\beta\) and \(\eta\)
  laws for \texttt{Œ†} types. \[
  (\lambda x . f[x]) ~ a = f[a] \qquad f = \lambda x . f ~ x
  \]
\end{itemize}

Although it is clear enough that the \(\upuparrows\) functor serves its
intended purpose of characterizing \texttt{Œ†} types in polynomial
universes, its construction seems somewhat more ad hoc than that of
\(\triangleleft\), which similarly characterized \texttt{Œ£} types in
polynomial universes while arising quite naturally from composition of
polynomial functors. We would like to better understand what additional
properties \(\upuparrows\) must satisfy, and how these in turn are
reflected as properties of polynomial universes with \texttt{Œ†} types.
In fact, we will ultimately show that this construction is intimately
linked with a quite simple structure on polynomial universes \texttt{ùî≤},
namely a \emph{distributive law} of \texttt{ùî≤} (viewed as a monad) over
itself. Before that, however, we note some other key properties of
\(\upuparrows\).

Specifically, let \(\mathbf{Poly}_{R}\) be the category whose objects
are polynomials and whose morphisms are lenses equipped with left
inverses. Straightforwardly, \(\triangleleft\) restricts to a monoidal
product on \(\mathbf{Poly}_R\), since it is functorial in both arguments
and must preserve left/right inverses. Hence \(\upuparrows\) can be
viewed as a functor
\(\mathbf{Poly}_R \times \mathbf{Poly} \to \mathbf{Poly}\). Then
\(\upuparrows\) moreover naturally carries the structure of an
\emph{action} on \(\mathbf{Poly}\) of the monoidal category
\(\mathbf{Poly}_R\) equipped with \(\triangleleft\), in that there are
natural transformations \[
y \upuparrows p \to p \quad \text{and} \quad
(p \triangleleft q) \upuparrows r \to p \upuparrows (q \upuparrows r)
\] which are moreover \emph{Cartesian}:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ Unit‚áà }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \KeywordTok{where}

\NormalTok{    ùï™‚áà }\OtherTok{:} \OtherTok{(}\NormalTok{ùï™ ‚áà p}\OtherTok{)}\NormalTok{ ‚áÜ p}
\NormalTok{    ùï™‚áà }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª} \OtherTok{(\_}\NormalTok{ , a}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ a tt}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª} \OtherTok{(\_}\NormalTok{ , a}\OtherTok{)}\NormalTok{ b tt }\OtherTok{‚Üí}\NormalTok{ b}\OtherTok{)}

\NormalTok{    ùï™‚áàCart }\OtherTok{:}\NormalTok{ isCartesian p ùï™‚áà}
\NormalTok{    ùï™‚áàCart }\OtherTok{(\_}\NormalTok{ , x}\OtherTok{)} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ œú }\OtherTok{‚Üí}\NormalTok{ œú tt}\OtherTok{)} 
\NormalTok{                    , }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} 
\NormalTok{                      , }\OtherTok{Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))}

\KeywordTok{open}\NormalTok{ Unit‚áà }\KeywordTok{public}

\KeywordTok{module}\NormalTok{ ‚óÉ‚áà }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 Œ∫0 Œ∫1 Œ∫2}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} 
          \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \KeywordTok{where}

\NormalTok{    ‚áàCurry }\OtherTok{:} \OtherTok{((}\NormalTok{p ‚óÉ q}\OtherTok{)}\NormalTok{ ‚áà r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{p ‚áà }\OtherTok{(}\NormalTok{q ‚áà r}\OtherTok{))}
\NormalTok{    ‚áàCurry }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª} \OtherTok{((}\NormalTok{a , h}\OtherTok{)}\NormalTok{ , k}\OtherTok{)} 
                  \OtherTok{‚Üí} \OtherTok{(}\NormalTok{a , }\OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí} \OtherTok{(} \OtherTok{(}\NormalTok{h b}\OtherTok{)} 
\NormalTok{                                , }\OtherTok{(Œª}\NormalTok{ d }\OtherTok{‚Üí}\NormalTok{ k }\OtherTok{(}\NormalTok{b , d}\OtherTok{))))))}
\NormalTok{             , }\OtherTok{(Œª} \OtherTok{((}\NormalTok{a , h}\OtherTok{)}\NormalTok{ , k}\OtherTok{)}\NormalTok{ f }\OtherTok{(}\NormalTok{b , d}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f b d}\OtherTok{)} \OtherTok{)}
    
\NormalTok{    ‚áàCurryCart }\OtherTok{:}\NormalTok{ isCartesian }\OtherTok{(}\NormalTok{p ‚áà }\OtherTok{(}\NormalTok{q ‚áà r}\OtherTok{))}\NormalTok{ ‚áàCurry}
\NormalTok{    ‚áàCurryCart }\OtherTok{((}\NormalTok{a , h}\OtherTok{)}\NormalTok{ , k}\OtherTok{)} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ f b d }\OtherTok{‚Üí}\NormalTok{ f }\OtherTok{(}\NormalTok{b , d}\OtherTok{))} 
\NormalTok{                    , }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ f }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}
\NormalTok{                      , }\OtherTok{(Œª}\NormalTok{ f }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} \OtherTok{)} \OtherTok{)}

\KeywordTok{open}\NormalTok{ ‚óÉ‚áà }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

The fact that \texttt{‚áàCurry} is Cartesian corresponds to the usual
currying isomorphism that relating dependent functions types to
dependent pair types: \[
\Pi (x , y) : \Sigma x : A . B[x] . C[x,y] \simeq \Pi x : A . \Pi y : B[x] . C[x,y]
\]

Similarly, \(\upuparrows\) is colax with respect to \(\triangleleft\) in
its second argument, in that there are Cartesian natural transformations
\[
p \upuparrows y \to y \quad \text{and} \quad
p \upuparrows (q \triangleleft r) \to (p \upuparrows q) \triangleleft (p \upuparrows r)
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ ‚áàUnit }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \KeywordTok{where}

\NormalTok{    ‚áàùï™ }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà ùï™}\OtherTok{)}\NormalTok{ ‚áÜ ùï™}
\NormalTok{    ‚áàùï™ }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ tt}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)}\NormalTok{ tt b }\OtherTok{‚Üí}\NormalTok{ tt }\OtherTok{)}

\NormalTok{    ‚áàùï™Cart }\OtherTok{:}\NormalTok{ isCartesian ùï™ ‚áàùï™}
\NormalTok{    ‚áàùï™Cart }\OtherTok{(}\NormalTok{x , Œ≥}\OtherTok{)} \OtherTok{=} 
\NormalTok{        Iso‚ÜíisEquiv }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ tt}\OtherTok{)} 
\NormalTok{                    , }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} 
\NormalTok{                      , }\OtherTok{Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))}

\KeywordTok{open}\NormalTok{ ‚áàUnit }\KeywordTok{public}

\KeywordTok{module}\NormalTok{ ‚áà‚óÉ }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 Œ∫0 Œ∫1 Œ∫2}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} 
          \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \KeywordTok{where}

\NormalTok{    ‚áàDistr }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà }\OtherTok{(}\NormalTok{q ‚óÉ r}\OtherTok{))}\NormalTok{ ‚áÜ }\OtherTok{((}\NormalTok{p ‚áà q}\OtherTok{)}\NormalTok{ ‚óÉ }\OtherTok{(}\NormalTok{p ‚áà r}\OtherTok{))}
\NormalTok{    ‚áàDistr }\OtherTok{=} \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , h}\OtherTok{)} 
                  \OtherTok{‚Üí} \OtherTok{(} \OtherTok{(}\NormalTok{a , }\OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ fst }\OtherTok{(}\NormalTok{h b}\OtherTok{)))} 
\NormalTok{                    , }\OtherTok{Œª}\NormalTok{ f }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{a , }\OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ snd }\OtherTok{(}\NormalTok{h b}\OtherTok{)} \OtherTok{(}\NormalTok{f b}\OtherTok{)))} \OtherTok{))} 
\NormalTok{             , }\OtherTok{(Œª} \OtherTok{(}\NormalTok{a , h}\OtherTok{)} \OtherTok{(}\NormalTok{f , g}\OtherTok{)}\NormalTok{ b }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{f b , g b}\OtherTok{))} \OtherTok{)}
    
\NormalTok{    ‚áàDistrCart }\OtherTok{:}\NormalTok{ isCartesian }\OtherTok{((}\NormalTok{p ‚áà q}\OtherTok{)}\NormalTok{ ‚óÉ }\OtherTok{(}\NormalTok{p ‚áà r}\OtherTok{))}\NormalTok{ ‚áàDistr}
\NormalTok{    ‚áàDistrCart }\OtherTok{(}\NormalTok{a , h}\OtherTok{)} \OtherTok{=}
\NormalTok{        Iso‚ÜíisEquiv }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ f }\OtherTok{‚Üí} \OtherTok{(} \OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ fst }\OtherTok{(}\NormalTok{f b}\OtherTok{))} 
\NormalTok{                             , }\OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ snd }\OtherTok{(}\NormalTok{f b}\OtherTok{))} \OtherTok{))}
\NormalTok{                    , }\OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{f , g}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} 
\NormalTok{                      , }\OtherTok{(Œª}\NormalTok{ f }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} \OtherTok{)} \OtherTok{)}

\KeywordTok{open}\NormalTok{ ‚áà‚óÉ }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

The fact that \texttt{‚áàDistr} is Cartesian corresponds to the
distributive law of \texttt{Œ†} types over \texttt{Œ£} types, i.e.~\[
\Pi x : A . \Sigma y : B[x] . C[x,y] \simeq \Sigma f : \Pi x : A . B[x] . \Pi x : A . C[x, f(x)]
\] One may wonder, then, whether this distributive law is somehow
related to a distributive law ofg the monad structure on a polynomial
universe ùî≤ given by Œ£ types (as discussed in the previous section) over
itself, i.e.~a morphism
\[ \mathfrak{u} \triangleleft \mathfrak{u} \leftrightarrows \mathfrak{u} \triangleleft \mathfrak{u} \]
subject to certain laws. Indeed, given a Lens
\texttt{œÄ\ :\ (ùî≤\ ‚áà\ ùî≤)\ ‚áÜ\ ùî≤} (intuitively -- corresponding to the
structure of \texttt{Œ†} types in \texttt{ùî≤}), one can define a morphism
of this form as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{distrLaw? }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{u }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{u ‚áà u}\OtherTok{)}\NormalTok{ ‚áÜ u}
            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{u ‚óÉ u}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{u ‚óÉ u}\OtherTok{)}
\NormalTok{distrLaw? u }\OtherTok{(}\NormalTok{œÄ , œÄ‚ôØ}\OtherTok{)} \OtherTok{=} 
    \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , b}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ œÄ }\OtherTok{(}\NormalTok{a , b}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ a}\OtherTok{))} 
\NormalTok{    , }\OtherTok{Œª} \OtherTok{(}\NormalTok{a , b}\OtherTok{)} \OtherTok{(}\NormalTok{f , x}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{x , }\OtherTok{(}\NormalTok{œÄ‚ôØ }\OtherTok{((}\NormalTok{a , b}\OtherTok{))}\NormalTok{ f x}\OtherTok{))} \OtherTok{)}
\end{Highlighting}
\end{Shaded}

The question then becomes whether this morphism has the structure of a
distributive law when \texttt{ùî≤} has the structure of a polynomial
universe with \texttt{Œ£} types, and \texttt{œÄ} is Cartesian
(i.e.~\texttt{ùî≤} also has \texttt{Œ†} types). Answering this question in
the affirmative shall be our task in the remainder of this section.

As a first step in this direction, we make a perhaps unexpected move of
further generalizing the \(\upuparrows\) functor to a functor
\(\mathsf{Tw}(\mathbf{Poly}) \times \mathbf{Poly} \to \mathbf{Poly}\),
where \(\mathsf{Tw}(\mathbf{Poly})\) is the \emph{twisted arrow
category} of \(\mathbf{Poly}\), i.e.~the category whose objects are
lenses and whose morphisms are \emph{twisted} commuting squares of the
form \[
\begin{array}{ccc}
p & \to & p'\\
\downarrow & & \downarrow\\
q & \leftarrow & q'
\end{array}
\]

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{‚áà[}\OtherTok{\_}\NormalTok{][}\OtherTok{\_}\NormalTok{]}\OtherTok{\_} \OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì ‚Ñì\textquotesingle{} ‚Ñì\textquotesingle{}\textquotesingle{} Œ∫ Œ∫\textquotesingle{} Œ∫\textquotesingle{}\textquotesingle{}}\OtherTok{\}}
            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì\textquotesingle{} Œ∫\textquotesingle{}}\OtherTok{)}
            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áÜ q}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì\textquotesingle{}\textquotesingle{} Œ∫\textquotesingle{}\textquotesingle{}}\OtherTok{)}
            \OtherTok{‚Üí}\NormalTok{ Poly }\OtherTok{(}\NormalTok{‚Ñì ‚äî Œ∫ ‚äî ‚Ñì\textquotesingle{}\textquotesingle{}}\OtherTok{)} \OtherTok{(}\NormalTok{Œ∫\textquotesingle{} ‚äî Œ∫\textquotesingle{}\textquotesingle{}}\OtherTok{)}
\OtherTok{(}\NormalTok{A , B}\OtherTok{)}\NormalTok{ ‚áà[ }\OtherTok{(}\NormalTok{C , D}\OtherTok{)}\NormalTok{ ][ }\OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)}\NormalTok{ ] }\OtherTok{(}\NormalTok{E , F}\OtherTok{)} \OtherTok{=}
   \OtherTok{(} \OtherTok{(}\NormalTok{Œ£ A }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ B a }\OtherTok{‚Üí}\NormalTok{ E}\OtherTok{))} 
\NormalTok{   , }\OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œµ}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{d }\OtherTok{:}\NormalTok{ D }\OtherTok{(}\NormalTok{f a}\OtherTok{))} \OtherTok{‚Üí}\NormalTok{ F }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f‚ôØ a d}\OtherTok{))))}

\KeywordTok{module}\NormalTok{ ‚áà[]Functor }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 ‚Ñì4 ‚Ñì5 Œ∫0 Œ∫1 Œ∫2 Œ∫3 Œ∫4 Œ∫5}\OtherTok{\}}
          \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{\{}\NormalTok{p\textquotesingle{} }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{\}}
          \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{\{}\NormalTok{q\textquotesingle{} }\OtherTok{:}\NormalTok{ Poly ‚Ñì4 Œ∫4}\OtherTok{\}}
          \OtherTok{\{}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{\}} \OtherTok{(}\NormalTok{r\textquotesingle{} }\OtherTok{:}\NormalTok{ Poly ‚Ñì5 Œ∫5}\OtherTok{)}
          \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \OtherTok{(}\NormalTok{f\textquotesingle{} }\OtherTok{:}\NormalTok{ p\textquotesingle{} ‚áÜ q\textquotesingle{}}\OtherTok{)}
          \OtherTok{(}\NormalTok{g }\OtherTok{:}\NormalTok{ p ‚áÜ p\textquotesingle{}}\OtherTok{)} \OtherTok{(}\NormalTok{h }\OtherTok{:}\NormalTok{ q\textquotesingle{} ‚áÜ q}\OtherTok{)} \OtherTok{(}\NormalTok{k }\OtherTok{:}\NormalTok{ r ‚áÜ r\textquotesingle{}}\OtherTok{)}
          \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ EqLens q f }\OtherTok{(}\NormalTok{comp q g }\OtherTok{(}\NormalTok{comp q f\textquotesingle{} h}\OtherTok{)))} \KeywordTok{where}

\NormalTok{    ‚áà[]Lens }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{p\textquotesingle{} ‚áà[ q\textquotesingle{} ][ f\textquotesingle{} ] r\textquotesingle{}}\OtherTok{)}
\NormalTok{    ‚áà[]Lens }\OtherTok{=} 
        \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{fst g a , }\OtherTok{Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ fst k }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{snd g a x}\OtherTok{))))} 
\NormalTok{        , }\OtherTok{Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)}\NormalTok{ œú x }\OtherTok{‚Üí}
\NormalTok{            snd k }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{snd f a x}\OtherTok{))} 
               \OtherTok{(}\NormalTok{transp }\OtherTok{(Œª}\NormalTok{ y }\OtherTok{‚Üí}\NormalTok{ snd r\textquotesingle{} }\OtherTok{(}\NormalTok{fst k }\OtherTok{(}\NormalTok{Œ≥ y}\OtherTok{)))} 
                       \OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{snd e a x}\OtherTok{))} 
                       \OtherTok{(}\NormalTok{œú }\OtherTok{(}\NormalTok{snd h }\OtherTok{(}\NormalTok{fst f\textquotesingle{} }\OtherTok{(}\NormalTok{fst g a}\OtherTok{))} 
                              \OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd q}\OtherTok{)} \OtherTok{(}\NormalTok{fst e a}\OtherTok{)}\NormalTok{ x}\OtherTok{))))} \OtherTok{)}
\end{Highlighting}
\end{Shaded}

Straightforwardly, we have that
\texttt{p\ ‚áà\ q\ =\ p\ ‚áà{[}\ p\ {]}{[}\ id\ p\ {]}\ q}. In particular,
we have
\texttt{‚áàLens\ p\ p\textquotesingle{}\ q\ q\textquotesingle{}\ f\ f\textquotesingle{}\ e\ g\ =\ ‚áà{[}{]}Lens\ p\ p\textquotesingle{}\ p\ p\textquotesingle{}\ q\ q\textquotesingle{}\ (id\ p)\ (id\ p\textquotesingle{})\ f\ f\textquotesingle{}\ g\ e},
which serves to motivate the definition of \texttt{‚áàLens} in terms of
morphisms equipped with left inverses.

The functor \texttt{\_‚áà{[}\_{]}{[}\_{]}\_} defined above moreover
preserves Cartesian morphisms in all of its arguments, and so restricts
to a functor
\(\mathsf{Tw}(\mathbf{Poly}^{\mathbf{Cart}}) \times \mathbf{Poly}^\mathbf{Cart} \to \mathbf{Poly}^\mathbf{Cart}\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    ‚áà[]LensCart }\OtherTok{:}\NormalTok{ isCartesian q h }\OtherTok{‚Üí}\NormalTok{ isCartesian r\textquotesingle{} k}
                  \OtherTok{‚Üí}\NormalTok{ isCartesian }\OtherTok{(}\NormalTok{p\textquotesingle{} ‚áà[ q\textquotesingle{} ][ f\textquotesingle{} ] r\textquotesingle{}}\OtherTok{)}\NormalTok{ ‚áà[]Lens}
\NormalTok{    ‚áà[]LensCart ch ck }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{=} 
\NormalTok{        compIsEquiv }
            \OtherTok{(}\NormalTok{PostCompEquiv }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ snd k }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{snd f a x}\OtherTok{)))} 
                           \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ ck }\OtherTok{(}\NormalTok{Œ≥ }\OtherTok{(}\NormalTok{snd f a x}\OtherTok{))))} 
            \OtherTok{(}\NormalTok{compIsEquiv }
                \OtherTok{(}\NormalTok{PostCompEquiv }
                    \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ transp }\OtherTok{(Œª}\NormalTok{ y }\OtherTok{‚Üí}\NormalTok{ snd r\textquotesingle{} }\OtherTok{(}\NormalTok{fst k }\OtherTok{(}\NormalTok{Œ≥ y}\OtherTok{)))} 
                                  \OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{snd e a x}\OtherTok{)))} 
                    \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ transpIsEquiv }\OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{snd e a x}\OtherTok{))))} 
                \OtherTok{(}\NormalTok{compIsEquiv }
                    \OtherTok{(}\NormalTok{PreCompEquiv }\OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd q}\OtherTok{)} \OtherTok{(}\NormalTok{fst e a}\OtherTok{))} 
                                  \OtherTok{(}\NormalTok{transpIsEquiv }\OtherTok{(}\NormalTok{fst e a}\OtherTok{)))} 
                    \OtherTok{(}\NormalTok{PreCompEquiv }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ snd h }\OtherTok{(}\NormalTok{fst f\textquotesingle{} }\OtherTok{(}\NormalTok{fst g a}\OtherTok{))}\NormalTok{ x}\OtherTok{)} 
                                  \OtherTok{(}\NormalTok{ch }\OtherTok{(}\NormalTok{fst f\textquotesingle{} }\OtherTok{(}\NormalTok{fst g a}\OtherTok{))))))}

\KeywordTok{open}\NormalTok{ ‚áà[]Functor }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

Moreover, all the properties of \texttt{\_‚áà\_} noted above generalize to
\texttt{\_‚áà{[}\_{]}{[}\_{]}\_}. For instance, we now have natural
transformations \[
y {\upuparrows}[y][\text{id}_{y}] p \to p \quad \text{and} \quad
(p \triangleleft r) {\upuparrows}[q ‚óÉ s][f \triangleleft g] t \to p {\upuparrows}[q][f] (r {\upuparrows}[s][g] t)
\] as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ùï™‚áà[] }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{ùï™ ‚áà[ ùï™ ][ }\OtherTok{(}\NormalTok{id ùï™}\OtherTok{)}\NormalTok{ ] p}\OtherTok{)}\NormalTok{ ‚áÜ p}
\NormalTok{ùï™‚áà[] p }\OtherTok{=} \OtherTok{((Œª} \OtherTok{(\_}\NormalTok{ , Œ≥}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Œ≥ tt}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª} \OtherTok{(\_}\NormalTok{ , Œ≥}\OtherTok{)}\NormalTok{ œú }\OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ œú}\OtherTok{)}

\NormalTok{‚áà[]Curry }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 ‚Ñì4 Œ∫0 Œ∫1 Œ∫2 Œ∫3 Œ∫4}\OtherTok{\}}
           \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} 
           \OtherTok{‚Üí} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)} \OtherTok{(}\NormalTok{t }\OtherTok{:}\NormalTok{ Poly ‚Ñì4 Œ∫4}\OtherTok{)}
           \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \OtherTok{(}\NormalTok{g }\OtherTok{:}\NormalTok{ r ‚áÜ s}\OtherTok{)}
           \OtherTok{‚Üí} \OtherTok{((}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áà[ q ‚óÉ s ][ f ‚óÉ‚óÉ[ s ] g ] t}\OtherTok{)} 
\NormalTok{             ‚áÜ }\OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] }\OtherTok{(}\NormalTok{r ‚áà[ s ][ g ] t}\OtherTok{))}
\NormalTok{‚áà[]Curry p q r s t f g }\OtherTok{=} 
    \OtherTok{(} \OtherTok{(Œª} \OtherTok{((}\NormalTok{a , h}\OtherTok{)}\NormalTok{ , k}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ a , }\OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{h b}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ d }\OtherTok{‚Üí}\NormalTok{ k }\OtherTok{(}\NormalTok{b , d}\OtherTok{))))} 
\NormalTok{    , }\OtherTok{Œª} \OtherTok{((}\NormalTok{a , h}\OtherTok{)}\NormalTok{ , k}\OtherTok{)}\NormalTok{ œú }\OtherTok{(}\NormalTok{b , d}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ œú b d}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

\noindent And similarly, we have natural transformations \[
p {\upuparrows}[q][f] y \to y \quad \text{and} \quad
p {\upuparrows}[r][g \circ f] (s \triangleleft t) \to (p {\upuparrows}[q][f] s) \triangleleft (q {\upuparrows}[r][g] t)
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{‚áà[]ùï™ }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 Œ∫0 ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} 
       \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] ùï™}\OtherTok{)}\NormalTok{ ‚áÜ ùï™}
\NormalTok{‚áà[]ùï™ p q f }\OtherTok{=} \OtherTok{((Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ tt}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª} \OtherTok{\_} \OtherTok{\_} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ tt}\OtherTok{)}
      

\NormalTok{‚áà[]Distr }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 ‚Ñì4 Œ∫0 Œ∫1 Œ∫2 Œ∫3 Œ∫4}\OtherTok{\}}
           \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)}
           \OtherTok{‚Üí} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)} \OtherTok{(}\NormalTok{t }\OtherTok{:}\NormalTok{ Poly ‚Ñì4 Œ∫4}\OtherTok{)}
           \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \OtherTok{(}\NormalTok{g }\OtherTok{:}\NormalTok{ q ‚áÜ r}\OtherTok{)}
           \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà[ r ][ comp r f g ] }\OtherTok{(}\NormalTok{s ‚óÉ t}\OtherTok{))} 
\NormalTok{             ‚áÜ }\OtherTok{((}\NormalTok{p ‚áà[ q ][ f ] s}\OtherTok{)}\NormalTok{ ‚óÉ }\OtherTok{(}\NormalTok{q ‚áà[ r ][ g ] t}\OtherTok{))}
\NormalTok{‚áà[]Distr p q r s t }\OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{=} 
    \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , h}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(} \OtherTok{(}\NormalTok{a , }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ fst }\OtherTok{(}\NormalTok{h x}\OtherTok{)))} 
\NormalTok{                   , }\OtherTok{(Œª}\NormalTok{ k1 }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{ f a , }\OtherTok{Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ snd }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{f‚ôØ a x}\OtherTok{))} 
                                               \OtherTok{(}\NormalTok{k1 x}\OtherTok{)} \OtherTok{))} \OtherTok{))} 
\NormalTok{    , }\OtherTok{(Œª} \OtherTok{(}\NormalTok{a , h}\OtherTok{)} \OtherTok{(}\NormalTok{k1 , k2}\OtherTok{)}\NormalTok{ d }\OtherTok{‚Üí} \OtherTok{(} \OtherTok{(}\NormalTok{k1 }\OtherTok{(}\NormalTok{g‚ôØ }\OtherTok{(}\NormalTok{f a}\OtherTok{)}\NormalTok{ d}\OtherTok{))}\NormalTok{ , k2 d }\OtherTok{))} \OtherTok{)}
\end{Highlighting}
\end{Shaded}

As we shall now see, these structures on \texttt{\_‚áà{[}\_{]}{[}\_{]}\_}
are intimately connected to a class of morphisms in \(\mathbf{Poly}\),
which we call \emph{distributors}.

\section{Distributors}\label{distributors}

Given polynomials \texttt{p,q,r,s}, a \emph{distributor} of \texttt{p,q}
over \texttt{r,s} is a morphism of the form
\texttt{(p\ ‚óÉ\ r)\ ‚áÜ\ (s\ ‚óÉ\ q)} in \(\mathbf{Poly}\). The name
``distributor'' is here drawn from the fact that, given polynomial
monads \texttt{m,n} with \texttt{Œ∑‚Çò\ :\ ùï™\ ‚áÜ\ m,\ Œ∑‚Çô\ :\ ùï™\ ‚áÜ\ n} and
\texttt{Œº‚Çò\ :\ (m\ ‚óÉ\ m)\ ‚áÜ\ m,\ Œº‚Çô\ :\ (n\ ‚óÉ\ n)\ ‚áÜ\ n}, a
\emph{distributive law} of \texttt{m} over \texttt{n} consists of a
distributor of \texttt{n,n} over \texttt{n,n} (i.e.~a morphism
\texttt{Œ¥\ :\ (n\ ‚óÉ\ m)\ ‚áÜ\ (m\ ‚óÉ\ n)}) such that the following diagrams
commute: \[
\footnotesize \begin{tikzcd} 
    {n \triangleleft (m \triangleleft m)} & {(n \triangleleft m) \triangleleft m} & {(m \triangleleft n) \triangleleft m} & {m \triangleleft (n \triangleleft m)} & {m \triangleleft (m \triangleleft n)} & {(m \triangleleft m) \triangleleft n} \\
    {n \triangleleft m} &&&&& {m \triangleleft n}
    \arrow["\simeq"{description}, draw=none, from=1-1, to=1-2]
    \arrow["{n \triangleleft \mu_m}"{description}, from=1-1, to=2-1]
    \arrow["{\delta \triangleleft m}", from=1-2, to=1-3]
    \arrow["\simeq"{description}, draw=none, from=1-3, to=1-4]
    \arrow["{m \triangleleft \delta}", from=1-4, to=1-5]
    \arrow["\simeq"{description}, draw=none, from=1-5, to=1-6]
    \arrow["{\mu_m \triangleleft n}"{description}, from=1-6, to=2-6]
    \arrow["\delta", from=2-1, to=2-6]
\end{tikzcd}
\] \[
\footnotesize \begin{tikzcd}
    {(n \triangleleft n) \triangleleft m} & {n \triangleleft (n \triangleleft m)} & {n \triangleleft (m \triangleleft n)} & {(n \triangleleft m) \triangleleft n} & {(m \triangleleft n) \triangleleft n} & {m \triangleleft (n \triangleleft n)} \\
    {n \triangleleft m} &&&&& {m \triangleleft n}
    \arrow["\simeq"{description}, draw=none, from=1-1, to=1-2]
    \arrow["{\mu_n \triangleleft n}"{description}, from=1-1, to=2-1]
    \arrow["{n \triangleleft \delta}", from=1-2, to=1-3]
    \arrow["\simeq"{description}, draw=none, from=1-3, to=1-4]
    \arrow["{\delta \triangleleft n}", from=1-4, to=1-5]
    \arrow["\simeq"{description}, draw=none, from=1-5, to=1-6]
    \arrow["{m \triangleleft \mu_n}"{description}, from=1-6, to=2-6]
    \arrow["\delta", from=2-1, to=2-6]
\end{tikzcd}
\] \[
\footnotesize \begin{tikzcd}
    {n \triangleleft y} & n & {y \triangleleft n} \\
    {n \triangleleft m} && {m \triangleleft n}
    \arrow["\simeq"{description}, draw=none, from=1-1, to=1-2]
    \arrow["{n \triangleleft \eta_m}"{description}, from=1-1, to=2-1]
    \arrow["\simeq"{description}, draw=none, from=1-2, to=1-3]
    \arrow["{\eta_m \triangleleft n}"{description}, from=1-3, to=2-3]
    \arrow["\delta", from=2-1, to=2-3]
\end{tikzcd} \qquad \begin{tikzcd}
    {y \triangleleft m} & m & {m \triangleleft y} \\
    {n \triangleleft m} && {m \triangleleft n}
    \arrow["\simeq"{description}, draw=none, from=1-1, to=1-2]
    \arrow["{\eta_n \triangleleft m}"{description}, from=1-1, to=2-1]
    \arrow["\simeq"{description}, draw=none, from=1-2, to=1-3]
    \arrow["{m \triangleleft \eta_n}"{description}, from=1-3, to=2-3]
    \arrow["\delta", from=2-1, to=2-3]
\end{tikzcd}
\]

By inspection, it can be seen that all the composite morphisms required
to commute by the above diagrams are themselves distributors of various
forms. Understanding the closure properties of such distributors that
give rise to these diagrams, then, will be a central aim of this
section.

By function extensionality, we obtain the following type of equality
proofs for distributors:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{EqDistributor }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 Œ∫0 Œ∫1 Œ∫2 Œ∫3}\OtherTok{\}}
                \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)}
                \OtherTok{‚Üí} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)}
                \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{s ‚óÉ q}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{s ‚óÉ q}\OtherTok{)}
                \OtherTok{‚Üí}\NormalTok{ Type }\OtherTok{(}\NormalTok{‚Ñì0 ‚äî ‚Ñì1 ‚äî ‚Ñì2 ‚äî ‚Ñì3 ‚äî Œ∫0 ‚äî Œ∫1 ‚äî Œ∫2 ‚äî Œ∫3}\OtherTok{)}
\NormalTok{EqDistributor p q r s }\OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{=} 
    \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ fst p}\OtherTok{)} \OtherTok{(}\NormalTok{Œ≥ }\OtherTok{:}\NormalTok{ snd p a }\OtherTok{‚Üí}\NormalTok{ fst r}\OtherTok{)} 
    \OtherTok{‚Üí}\NormalTok{ Œ£ }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))}\NormalTok{ ‚â° fst }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)))} 
        \OtherTok{(Œª}\NormalTok{ e1 }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ snd s }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))))}
                \OtherTok{‚Üí}\NormalTok{ Œ£ }\OtherTok{((}\NormalTok{snd }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))}\NormalTok{ x}\OtherTok{)} 
\NormalTok{                    ‚â° }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))} 
                           \OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd s}\OtherTok{)}\NormalTok{ e1 x}\OtherTok{)))} 
                    \OtherTok{(Œª}\NormalTok{ e2 }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{y }\OtherTok{:}\NormalTok{ snd q }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))}\NormalTok{ x}\OtherTok{))} 
                            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f‚ôØ }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{(}\NormalTok{x , y}\OtherTok{))} 
\NormalTok{                              ‚â° }\OtherTok{(}\NormalTok{g‚ôØ }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} 
                                    \OtherTok{(} \OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd s}\OtherTok{)}\NormalTok{ e1 x}\OtherTok{)} 
\NormalTok{                                    , }\OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd q}\OtherTok{)}\NormalTok{ e2 y}\OtherTok{)))))}
\end{Highlighting}
\end{Shaded}

Moreover, for any polynomial \texttt{u} with
\texttt{œÄ\ :\ (u\ ‚áà\ u)\ ‚áÜ\ u}, the morphism \texttt{distrLaw?\ u\ œÄ}
defined above is a distributor of \texttt{u,u} over itself. In fact, we
can straightforwardly generalize the construction of \texttt{distrLaw?}
to a transformation \[
(p ~{\upuparrows}[q][f] r) \leftrightarrows s \implies (p \triangleleft r) \leftrightarrows (s \triangleleft q)
\] as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{‚áà‚ÜíDistributor }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 Œ∫0 Œ∫1 Œ∫2 Œ∫3}\OtherTok{\}}
                \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)}
                \OtherTok{‚Üí} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \OtherTok{\{}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{\}}
                \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}}
                \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] r}\OtherTok{)}\NormalTok{ ‚áÜ s}
                \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{s ‚óÉ q}\OtherTok{)}
\NormalTok{‚áà‚ÜíDistributor q r }\OtherTok{\{}\NormalTok{f }\OtherTok{=} \OtherTok{(}\NormalTok{f , f‚ôØ}\OtherTok{)\}} \OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{=}
    \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , h}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{a , h}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª}\NormalTok{ d\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ f a}\OtherTok{)} 
\NormalTok{    , }\OtherTok{Œª} \OtherTok{(}\NormalTok{a , h}\OtherTok{)} \OtherTok{(}\NormalTok{d\textquotesingle{} , d}\OtherTok{)}
        \OtherTok{‚Üí}\NormalTok{ f‚ôØ a d , g‚ôØ }\OtherTok{(}\NormalTok{a , h}\OtherTok{)}\NormalTok{ d\textquotesingle{} d}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

Hence to show that the above-given diagrams commute for the candidate
distributive law \texttt{distrLaw?\ u\ œÄ} given above, it suffices to
show that the distributors required to commute by these diagrams
themselves arise -- under the above-defined transformation -- from
Cartesian morphisms of the form
\texttt{p\ ‚áà{[}\ q\ {]}{[}\ f\ {]}\ r\ ‚áÜ\ u}, which, if \texttt{u} is a
polynomial universe, are necessarily equal.

First of all, any distributor
\((p \triangleleft r) \leftrightarrows (s \triangleleft q)\) may be
extended along morphisms
\texttt{p\textquotesingle{}\ ‚áÜ\ p,\ q\ ‚áÜ\ q\textquotesingle{},\ r\textquotesingle{}\ ‚áÜ\ r,\ s\ ‚áÜ\ s\textquotesingle{}}
to a distributor
\((p' \triangleleft r') \leftrightarrows (s' \triangleleft q')\) by
forming the composite \[
p' \triangleleft r' \xrightarrow{} p \triangleleft r \xrightarrow{} s \triangleleft q \xrightarrow{} s' \triangleleft q'
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ DistributorLens }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 ‚Ñì4 ‚Ñì5 ‚Ñì6 ‚Ñì7}
\NormalTok{                        Œ∫0 Œ∫1 Œ∫2 Œ∫3 Œ∫4 Œ∫5 Œ∫6 Œ∫7}\OtherTok{\}}
                       \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{\{}\NormalTok{p\textquotesingle{} }\OtherTok{:}\NormalTok{ Poly ‚Ñì4 Œ∫4}\OtherTok{\}}
                       \OtherTok{\{}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{q\textquotesingle{} }\OtherTok{:}\NormalTok{ Poly ‚Ñì5 Œ∫5}\OtherTok{)}
                       \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \OtherTok{\{}\NormalTok{r\textquotesingle{} }\OtherTok{:}\NormalTok{ Poly ‚Ñì6 Œ∫6}\OtherTok{\}}
                       \OtherTok{\{}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{\}} \OtherTok{(}\NormalTok{s\textquotesingle{} }\OtherTok{:}\NormalTok{ Poly ‚Ñì7 Œ∫7}\OtherTok{)}
                       \OtherTok{(}\NormalTok{g }\OtherTok{:}\NormalTok{ p\textquotesingle{} ‚áÜ p}\OtherTok{)} \OtherTok{(}\NormalTok{h }\OtherTok{:}\NormalTok{ q ‚áÜ q\textquotesingle{}}\OtherTok{)} 
                       \OtherTok{(}\NormalTok{k }\OtherTok{:}\NormalTok{ r\textquotesingle{} ‚áÜ r}\OtherTok{)} \OtherTok{(}\NormalTok{l }\OtherTok{:}\NormalTok{ s ‚áÜ s\textquotesingle{}}\OtherTok{)} \KeywordTok{where}

\NormalTok{    distrLens }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{s ‚óÉ q}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p\textquotesingle{} ‚óÉ r\textquotesingle{}}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{s\textquotesingle{} ‚óÉ q\textquotesingle{}}\OtherTok{)}
\NormalTok{    distrLens j }\OtherTok{=} 
\NormalTok{        comp }\OtherTok{(}\NormalTok{s\textquotesingle{} ‚óÉ q\textquotesingle{}}\OtherTok{)} \OtherTok{(}\NormalTok{g ‚óÉ‚óÉ[ r ] k}\OtherTok{)} 
             \OtherTok{(}\NormalTok{comp }\OtherTok{((}\NormalTok{s\textquotesingle{} ‚óÉ q\textquotesingle{}}\OtherTok{))}\NormalTok{ j }
                   \OtherTok{(}\NormalTok{l ‚óÉ‚óÉ[ q\textquotesingle{} ] h}\OtherTok{))}
\end{Highlighting}
\end{Shaded}

The corresponding construction on morphisms out of
\texttt{\_‚áà{[}\_{]}{[}\_{]}\_} is given by forming the composite \[
p' ~ {\upuparrows}[q'][h \circ f \circ g] ~ r' \leftrightarrows p {\upuparrows}[q][f] ~ r \leftrightarrows s \leftrightarrows s'
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    ‚áà‚ÜíDistributorLens }\OtherTok{:} 
        \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] r}\OtherTok{)}\NormalTok{ ‚áÜ s }
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p\textquotesingle{} ‚áà[ q\textquotesingle{} ][ comp q\textquotesingle{} g }\OtherTok{(}\NormalTok{comp q\textquotesingle{} f h}\OtherTok{)}\NormalTok{ ] r\textquotesingle{}}\OtherTok{)}\NormalTok{ ‚áÜ s\textquotesingle{}}
\NormalTok{    ‚áà‚ÜíDistributorLens }\OtherTok{\{}\NormalTok{f }\OtherTok{=}\NormalTok{ f}\OtherTok{\}}\NormalTok{ j }\OtherTok{=} 
\NormalTok{        comp s\textquotesingle{} }\OtherTok{(}\NormalTok{‚áà[]Lens q\textquotesingle{} r }\OtherTok{(}\NormalTok{comp q\textquotesingle{} g }\OtherTok{(}\NormalTok{comp q\textquotesingle{} f h}\OtherTok{))}\NormalTok{ f }
\NormalTok{                         g h k }\OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)))} 
             \OtherTok{(}\NormalTok{comp s\textquotesingle{} j l}\OtherTok{)}

\NormalTok{    ‚áà‚ÜíDistributorLens‚â° }\OtherTok{:} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}} \OtherTok{(}\NormalTok{j }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] r}\OtherTok{)}\NormalTok{ ‚áÜ s}\OtherTok{)}
                         \OtherTok{‚Üí}\NormalTok{ distrLens }\OtherTok{(}\NormalTok{‚áà‚ÜíDistributor q r j}\OtherTok{)} 
\NormalTok{                           ‚â° ‚áà‚ÜíDistributor q\textquotesingle{} r\textquotesingle{} }\OtherTok{(}\NormalTok{‚áà‚ÜíDistributorLens j}\OtherTok{)}
\NormalTok{    ‚áà‚ÜíDistributorLens‚â° j }\OtherTok{=}\NormalTok{ refl}

\KeywordTok{open}\NormalTok{ DistributorLens }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

Similarly, there are two distinct ways of composing distributors:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Given distributors \texttt{p\ ‚óÉ\ s\ ‚áÜ\ t\ ‚óÉ\ q} and
  \texttt{q\ ‚óÉ\ u\ ‚áÜ\ v\ ‚óÉ\ r}, we obtain a distributor
  \texttt{p\ ‚óÉ\ (s\ ‚óÉ\ u)\ ‚áÜ\ (t\ ‚óÉ\ v)\ ‚óÉ\ r} as the composite \[
  p ‚óÉ (s \triangleleft u) \simeq (p \triangleleft s) \triangleleft u \xrightarrow{} (t \triangleleft q) \triangleleft u \simeq t \triangleleft (q \triangleleft u) \xrightarrow{} t \triangleleft (v \triangleleft r) \simeq (t \triangleleft v) \triangleleft r
  \]
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ DistributorComp1 }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 ‚Ñì4 ‚Ñì5 ‚Ñì6 Œ∫0 Œ∫1 Œ∫2 Œ∫3 Œ∫4 Œ∫5 Œ∫6}\OtherTok{\}}
                        \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{\{}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)}
                        \OtherTok{\{}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{\}} \OtherTok{\{}\NormalTok{t }\OtherTok{:}\NormalTok{ Poly ‚Ñì4 Œ∫4}\OtherTok{\}}
                        \OtherTok{(}\NormalTok{u }\OtherTok{:}\NormalTok{ Poly ‚Ñì5 Œ∫5}\OtherTok{)} \OtherTok{\{}\NormalTok{v }\OtherTok{:}\NormalTok{ Poly ‚Ñì6 Œ∫6}\OtherTok{\}} \KeywordTok{where}

\NormalTok{    distrComp1 }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚óÉ s}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{t ‚óÉ q}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{q ‚óÉ u}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{v ‚óÉ r}\OtherTok{)}
                 \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚óÉ }\OtherTok{(}\NormalTok{s ‚óÉ u}\OtherTok{))}\NormalTok{ ‚áÜ }\OtherTok{((}\NormalTok{t ‚óÉ v}\OtherTok{)}\NormalTok{ ‚óÉ r}\OtherTok{)}
\NormalTok{    distrComp1 h k }\OtherTok{=} 
\NormalTok{        comp }\OtherTok{((}\NormalTok{t ‚óÉ v}\OtherTok{)}\NormalTok{ ‚óÉ r}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉassoc‚Åª¬π p s u}\OtherTok{)} 
             \OtherTok{(}\NormalTok{comp }\OtherTok{((}\NormalTok{t ‚óÉ v}\OtherTok{)}\NormalTok{ ‚óÉ r}\OtherTok{)} \OtherTok{(}\NormalTok{h ‚óÉ‚óÉ[ u ] }\OtherTok{(}\NormalTok{id u}\OtherTok{))} 
                   \OtherTok{(}\NormalTok{comp }\OtherTok{((}\NormalTok{t ‚óÉ v}\OtherTok{)}\NormalTok{ ‚óÉ r}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉassoc t q u}\OtherTok{)} 
                         \OtherTok{(}\NormalTok{comp }\OtherTok{((}\NormalTok{t ‚óÉ v}\OtherTok{)}\NormalTok{ ‚óÉ r}\OtherTok{)} \OtherTok{((}\NormalTok{id t}\OtherTok{)}\NormalTok{ ‚óÉ‚óÉ[ }\OtherTok{(}\NormalTok{v ‚óÉ r}\OtherTok{)}\NormalTok{ ] k}\OtherTok{)} 
                               \OtherTok{(}\NormalTok{‚óÉassoc‚Åª¬π t v r}\OtherTok{))))}
\end{Highlighting}
\end{Shaded}

The corresponding construction on morphisms
\texttt{(p\ ‚áà{[}\ q\ {]}{[}\ f\ {]}\ s)\ ‚áÜ\ t} and
\texttt{(q\ ‚áà{[}\ r\ {]}{[}\ g\ {]}\ u)\ ‚áÜ\ v} is to form the following
composite with the colaxator of \texttt{\_‚áà{[}\_{]}{[}\_{]}\_}: \[
p {\upuparrows}[r][g \circ f] (s \triangleleft u) \leftrightarrows (p {\upuparrows}[q][f] s) \triangleleft (q {\upuparrows}[r][g] u) \leftrightarrows t \triangleleft v
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    ‚áà‚ÜíDistributorComp1 }\OtherTok{:} 
        \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}} \OtherTok{\{}\NormalTok{g }\OtherTok{:}\NormalTok{ q ‚áÜ r}\OtherTok{\}} 
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] s}\OtherTok{)}\NormalTok{ ‚áÜ t }
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{q ‚áà[ r ][ g ] u}\OtherTok{)}\NormalTok{ ‚áÜ v}
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà[ r ][ comp r f g ] }\OtherTok{(}\NormalTok{s ‚óÉ u}\OtherTok{))}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{t ‚óÉ v}\OtherTok{)}
\NormalTok{    ‚áà‚ÜíDistributorComp1 }\OtherTok{\{}\NormalTok{f }\OtherTok{=}\NormalTok{ f}\OtherTok{\}} \OtherTok{\{}\NormalTok{g }\OtherTok{=}\NormalTok{ g}\OtherTok{\}}\NormalTok{ h k }\OtherTok{=} 
\NormalTok{        comp }\OtherTok{(}\NormalTok{t ‚óÉ v}\OtherTok{)} \OtherTok{(}\NormalTok{‚áà[]Distr p q r s u f g}\OtherTok{)} 
             \OtherTok{(}\NormalTok{h ‚óÉ‚óÉ[ v ] k}\OtherTok{)}

\NormalTok{    ‚áà‚ÜíDistributorComp1‚â° }\OtherTok{:} 
        \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}} \OtherTok{\{}\NormalTok{g }\OtherTok{:}\NormalTok{ q ‚áÜ r}\OtherTok{\}} 
        \OtherTok{(}\NormalTok{h }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] s}\OtherTok{)}\NormalTok{ ‚áÜ t}\OtherTok{)}
        \OtherTok{(}\NormalTok{k }\OtherTok{:} \OtherTok{(}\NormalTok{q ‚áà[ r ][ g ] u}\OtherTok{)}\NormalTok{ ‚áÜ v}\OtherTok{)}
        \OtherTok{‚Üí}\NormalTok{ distrComp1 }\OtherTok{(}\NormalTok{‚áà‚ÜíDistributor q s h}\OtherTok{)} \OtherTok{(}\NormalTok{‚áà‚ÜíDistributor r u k}\OtherTok{)}
\NormalTok{          ‚â° ‚áà‚ÜíDistributor r }\OtherTok{(}\NormalTok{s ‚óÉ u}\OtherTok{)} \OtherTok{(}\NormalTok{‚áà‚ÜíDistributorComp1 h k}\OtherTok{)}
\NormalTok{    ‚áà‚ÜíDistributorComp1‚â° h k }\OtherTok{=}\NormalTok{ refl}
    
\KeywordTok{open}\NormalTok{ DistributorComp1 }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Given distributors
  \(p \triangleleft u \leftrightarrows v \triangleleft q\) and
  \(r \triangleleft t \leftrightarrows u \triangleleft s\), we obtain a
  distributor
  \((p \triangleleft r) \triangleleft t \leftrightarrows v \triangleleft (q \triangleleft s)\)
  as the composite \[
  (p \triangleleft r) \triangleleft t \simeq p \triangleleft (r \triangleleft t) \leftrightarrows p \triangleleft (u \triangleleft s) \simeq (p \triangleleft u) \triangleleft s \leftrightarrows (v \triangleleft q) \triangleleft s \simeq v \triangleleft (q \triangleleft s)
  \]
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ DistributorComp2 }
           \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 ‚Ñì4 ‚Ñì5 ‚Ñì6 Œ∫0 Œ∫1 Œ∫2 Œ∫3 Œ∫4 Œ∫5 Œ∫6}\OtherTok{\}}
           \OtherTok{\{}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{\}} \OtherTok{\{}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{\}} 
           \OtherTok{\{}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{\}} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)}
           \OtherTok{(}\NormalTok{t }\OtherTok{:}\NormalTok{ Poly ‚Ñì4 Œ∫4}\OtherTok{)} \OtherTok{\{}\NormalTok{u }\OtherTok{:}\NormalTok{ Poly ‚Ñì5 Œ∫5}\OtherTok{\}} 
           \OtherTok{\{}\NormalTok{v }\OtherTok{:}\NormalTok{ Poly ‚Ñì6 Œ∫6}\OtherTok{\}} \KeywordTok{where} 

\NormalTok{    distrComp2 }\OtherTok{:} \OtherTok{(}\NormalTok{r ‚óÉ t}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{u ‚óÉ s}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚óÉ u}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{v ‚óÉ q}\OtherTok{)}
                 \OtherTok{‚Üí} \OtherTok{((}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚óÉ t}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{v ‚óÉ }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{))}
\NormalTok{    distrComp2 h k }\OtherTok{=}
\NormalTok{        comp }\OtherTok{(}\NormalTok{v ‚óÉ }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{))} \OtherTok{(}\NormalTok{‚óÉassoc p r t}\OtherTok{)} 
             \OtherTok{(}\NormalTok{comp }\OtherTok{(}\NormalTok{v ‚óÉ }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{))}  \OtherTok{((}\NormalTok{id p}\OtherTok{)}\NormalTok{ ‚óÉ‚óÉ[ u ‚óÉ s ] h}\OtherTok{)} 
               \OtherTok{(}\NormalTok{comp }\OtherTok{(}\NormalTok{v ‚óÉ }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{))} \OtherTok{(}\NormalTok{‚óÉassoc‚Åª¬π p u s}\OtherTok{)} 
                     \OtherTok{(}\NormalTok{comp }\OtherTok{(}\NormalTok{v ‚óÉ }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{))} \OtherTok{(}\NormalTok{k ‚óÉ‚óÉ[ s ] }\OtherTok{(}\NormalTok{id s}\OtherTok{))} 
                           \OtherTok{(}\NormalTok{‚óÉassoc v q s}\OtherTok{))))}
\end{Highlighting}
\end{Shaded}

The corresponding construction on morphisms
\texttt{(p\ ‚áà{[}\ q\ {]}{[}\ f\ {]}\ u)\ ‚áÜ\ v} and
\texttt{(r\ ‚áà{[}\ s\ {]}{[}\ g\ {]}\ t)\ ‚áÜ\ u} is to form the following
composite with the morphism \texttt{‚áà{[}{]}Curry} defined above: \[
(p \triangleleft r) {\upuparrows}[q \triangleleft s][f \triangleleft g] t \leftrightarrows p {\upuparrows}[q][f] (r {\upuparrows}[s][g] t) \leftrightarrows p {\upuparrows}[q][f] u \leftrightarrows v
\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    ‚áà‚ÜíDistributorComp2 }\OtherTok{:} 
        \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}} \OtherTok{\{}\NormalTok{g }\OtherTok{:}\NormalTok{ r ‚áÜ s}\OtherTok{\}}
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{r ‚áà[ s ][ g ] t}\OtherTok{)}\NormalTok{ ‚áÜ u }
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] u}\OtherTok{)}\NormalTok{ ‚áÜ v}
        \OtherTok{‚Üí} \OtherTok{((}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áà[ }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{)}\NormalTok{ ][ f ‚óÉ‚óÉ[ s ] g ] t}\OtherTok{)}\NormalTok{ ‚áÜ v}
\NormalTok{    ‚áà‚ÜíDistributorComp2 }\OtherTok{\{}\NormalTok{f }\OtherTok{=}\NormalTok{ f}\OtherTok{\}} \OtherTok{\{}\NormalTok{g }\OtherTok{=}\NormalTok{ g}\OtherTok{\}}\NormalTok{ h k }\OtherTok{=}
\NormalTok{        comp v }\OtherTok{(}\NormalTok{‚áà[]Curry p q r s t f g}\OtherTok{)} 
             \OtherTok{(}\NormalTok{comp v }\OtherTok{(}\NormalTok{‚áà[]Lens q u f f }
                              \OtherTok{(}\NormalTok{id p}\OtherTok{)} \OtherTok{(}\NormalTok{id q}\OtherTok{)}\NormalTok{ h }
                              \OtherTok{(} \OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)} 
\NormalTok{                              , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)))} 
\NormalTok{                   k}\OtherTok{)}
    
\NormalTok{    ‚áà‚ÜíDistributorComp2‚â° }\OtherTok{:} 
        \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{\}} \OtherTok{\{}\NormalTok{g }\OtherTok{:}\NormalTok{ r ‚áÜ s}\OtherTok{\}}
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{h }\OtherTok{:} \OtherTok{(}\NormalTok{r ‚áà[ s ][ g ] t}\OtherTok{)}\NormalTok{ ‚áÜ u}\OtherTok{)} 
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{k }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] u}\OtherTok{)}\NormalTok{ ‚áÜ v}\OtherTok{)}
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{distrComp2 }\OtherTok{(}\NormalTok{‚áà‚ÜíDistributor s t h}\OtherTok{)} 
                      \OtherTok{(}\NormalTok{‚áà‚ÜíDistributor q u k}\OtherTok{))} 
\NormalTok{          ‚â° ‚áà‚ÜíDistributor }\OtherTok{(}\NormalTok{q ‚óÉ s}\OtherTok{)}\NormalTok{ t }
                          \OtherTok{(}\NormalTok{‚áà‚ÜíDistributorComp2 h k}\OtherTok{)}
\NormalTok{    ‚áà‚ÜíDistributorComp2‚â° h k }\OtherTok{=}\NormalTok{ refl}

\KeywordTok{open}\NormalTok{ DistributorComp2 }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

Likewise, there are two corresponding notions of ``identity
distributor'' on a polynomial \texttt{p}, the first of which is given by
the following composition of unitors for \texttt{‚óÉ}: \[
p \triangleleft y \simeq p \simeq y \triangleleft p
\] and the second of which is given by the inverse such composition \[
y \triangleleft p \simeq p \simeq p \triangleleft y
\]

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ DistributorId }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \KeywordTok{where}

\NormalTok{    distrId1 }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚óÉ ùï™}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{ùï™ ‚óÉ p}\OtherTok{)}
\NormalTok{    distrId1 }\OtherTok{=}\NormalTok{ comp }\OtherTok{(}\NormalTok{ùï™ ‚óÉ p}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉunitr p}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉunitl‚Åª¬π p}\OtherTok{)}

\NormalTok{    distrId2 }\OtherTok{:} \OtherTok{(}\NormalTok{ùï™ ‚óÉ p}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{p ‚óÉ ùï™}\OtherTok{)}
\NormalTok{    distrId2 }\OtherTok{=}\NormalTok{ comp }\OtherTok{(}\NormalTok{p ‚óÉ ùï™}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉunitl p}\OtherTok{)} \OtherTok{(}\NormalTok{‚óÉunitr‚Åª¬π p}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

The corresponding morphisms
\texttt{p\ ‚áà{[}\ p\ {]}{[}\ id\ p\ {]}\ ùï™\ ‚áÜ\ ùï™} and
\texttt{ùï™\ ‚áà{[}\ ùï™\ {]}{[}\ id\ ùï™\ {]}\ p\ ‚áÜ\ p} are precisely the maps
\texttt{‚áà{[}{]}ùï™} and \texttt{ùï™‚áà{[}{]}} defined above, respectively:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    ‚áà‚ÜíDistributorId1‚â° }\OtherTok{:}\NormalTok{ distrId1 ‚â° ‚áà‚ÜíDistributor p ùï™ }\OtherTok{(}\NormalTok{‚áà[]ùï™ p p }\OtherTok{(}\NormalTok{id p}\OtherTok{))}
\NormalTok{    ‚áà‚ÜíDistributorId1‚â° }\OtherTok{=}\NormalTok{ refl}

\NormalTok{    ‚áà‚ÜíDistributorId2‚â° }\OtherTok{:}\NormalTok{ distrId2 ‚â° ‚áà‚ÜíDistributor ùï™ p }\OtherTok{(}\NormalTok{ùï™‚áà[] p}\OtherTok{)}
\NormalTok{    ‚áà‚ÜíDistributorId2‚â° }\OtherTok{=}\NormalTok{ refl}

\KeywordTok{open}\NormalTok{ DistributorId }\KeywordTok{public}
\end{Highlighting}
\end{Shaded}

It can thus be seen that the above operations defined on distributors
are preicsely those occurring in the diagrams for a distributive law
given above, and moreover, these all have corresponding constructions on
morphisms out of \texttt{\_‚áà{[}\_{]}{[}\_{]}\_}, all of which preserve
Cartesian morphisms. Hence if \texttt{œÄ\ :\ ùî≤\ ‚áà\ ùî≤\ ‚áÜ\ ùî≤} is Cartesian,
all of the morphisms involving \texttt{\_‚áà{[}\_{]}{[}\_{]}\_}
corresponding to those required to commute in order for
\texttt{distrLaw?\ ùî≤\ œÄ} to be a distributive law will be Cartesian, and
so if \texttt{ùî≤} is a polynomial universe, these will all automatically
be equal to one another.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ap‚áà‚ÜíDistributor }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 Œ∫0 Œ∫1 Œ∫2 Œ∫3}\OtherTok{\}}
                  \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)}
                  \OtherTok{‚Üí} \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)}
                  \OtherTok{‚Üí} \OtherTok{(}\NormalTok{h k }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] r}\OtherTok{)}\NormalTok{ ‚áÜ s}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ EqLens s h k }
                  \OtherTok{‚Üí}\NormalTok{ EqDistributor p q r s }\OtherTok{(}\NormalTok{‚áà‚ÜíDistributor q r h}\OtherTok{)}
                                          \OtherTok{(}\NormalTok{‚áà‚ÜíDistributor q r k}\OtherTok{)}
\NormalTok{ap‚áà‚ÜíDistributor p q r s f h k }\OtherTok{(}\NormalTok{e , e‚ôØ}\OtherTok{)}\NormalTok{ a Œ≥ }\OtherTok{=} 
    \OtherTok{(}\NormalTok{ e }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} 
\NormalTok{    , }\OtherTok{Œª}\NormalTok{ x }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{ refl , }\OtherTok{(Œª}\NormalTok{ y }\OtherTok{‚Üí}\NormalTok{ pairEq refl }\OtherTok{(}\NormalTok{coAp }\OtherTok{(}\NormalTok{e‚ôØ }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)}\NormalTok{ x}\OtherTok{)}\NormalTok{ y}\OtherTok{))} \OtherTok{)} \OtherTok{)}

\KeywordTok{module}\NormalTok{ DistrLaw }\OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{(}\NormalTok{ùî≤ }\OtherTok{:}\NormalTok{ Poly ‚Ñì Œ∫}\OtherTok{)} \OtherTok{(}\NormalTok{univ }\OtherTok{:}\NormalTok{ isUnivalent ùî≤}\OtherTok{)}
                \OtherTok{(}\NormalTok{Œ∑ }\OtherTok{:}\NormalTok{ ùï™ ‚áÜ ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{cŒ∑ }\OtherTok{:}\NormalTok{ isCartesian ùî≤ Œ∑}\OtherTok{)}
                \OtherTok{(}\NormalTok{œÉ }\OtherTok{:} \OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)}\NormalTok{ ‚áÜ ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{cœÉ }\OtherTok{:}\NormalTok{ isCartesian ùî≤ œÉ}\OtherTok{)}
                \OtherTok{(}\NormalTok{œÄ }\OtherTok{:} \OtherTok{(}\NormalTok{ùî≤ ‚áà ùî≤}\OtherTok{)}\NormalTok{ ‚áÜ ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{cœÄ }\OtherTok{:}\NormalTok{ isCartesian ùî≤ œÄ}\OtherTok{)} \KeywordTok{where}
    
\NormalTok{    distrLaw1 }\OtherTok{:}\NormalTok{ EqDistributor ùî≤ ùî≤ }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)}\NormalTok{ ùî≤}
                    \OtherTok{(}\NormalTok{distrLens ùî≤ }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)}\NormalTok{ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{))}\NormalTok{ œÉ }
                               \OtherTok{(}\NormalTok{distrComp1 ùî≤ ùî≤ }\OtherTok{(}\NormalTok{distrLaw? ùî≤ œÄ}\OtherTok{)} 
                                               \OtherTok{(}\NormalTok{distrLaw? ùî≤ œÄ}\OtherTok{)))} 
                    \OtherTok{(}\NormalTok{distrLens ùî≤ ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                               \OtherTok{(}\NormalTok{distrLaw? ùî≤ œÄ}\OtherTok{))}
\NormalTok{    distrLaw1 }\OtherTok{=} 
\NormalTok{        ap‚áà‚ÜíDistributor ùî≤ ùî≤ }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)}\NormalTok{ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}
            \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{comp }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{‚áàDistr ùî≤ ùî≤ ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{œÄ ‚óÉ‚óÉ[ ùî≤ ] œÄ}\OtherTok{))}\NormalTok{ œÉ}\OtherTok{)}
            \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{‚áà[]Lens ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ œÉ }
                             \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)))} 
\NormalTok{                  œÄ}\OtherTok{)}
            \OtherTok{(}\NormalTok{univ }\OtherTok{(}\NormalTok{compCartesian ùî≤ }
                        \OtherTok{(}\NormalTok{compCartesian }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)} 
                            \OtherTok{(}\NormalTok{‚áàDistrCart ùî≤ ùî≤ ùî≤}\OtherTok{)} 
                            \OtherTok{(}\NormalTok{‚óÉ‚óÉCart ùî≤ ùî≤ cœÄ cœÄ}\OtherTok{))} 
\NormalTok{                        cœÉ}\OtherTok{)} 
                  \OtherTok{(}\NormalTok{compCartesian ùî≤ }
                    \OtherTok{(}\NormalTok{‚áà[]LensCart ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ œÉ }
                        \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} 
                        \OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{)}\NormalTok{ cœÉ}\OtherTok{)} 
\NormalTok{                    cœÄ}\OtherTok{))}
    
\NormalTok{    distrLaw2 }\OtherTok{:}\NormalTok{ EqDistributor }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)}\NormalTok{ ùî≤ ùî≤ ùî≤}
                    \OtherTok{(}\NormalTok{distrLens ùî≤ ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{))}\NormalTok{ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                               \OtherTok{(}\NormalTok{distrComp2 ùî≤ ùî≤ }\OtherTok{(}\NormalTok{distrLaw? ùî≤ œÄ}\OtherTok{)} 
                                               \OtherTok{(}\NormalTok{distrLaw? ùî≤ œÄ}\OtherTok{)))} 
                    \OtherTok{(}\NormalTok{distrLens ùî≤ ùî≤ ùî≤ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                               \OtherTok{(}\NormalTok{distrLaw? ùî≤ œÄ}\OtherTok{))}
\NormalTok{    distrLaw2 }\OtherTok{=} 
\NormalTok{        ap‚áà‚ÜíDistributor }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{)}\NormalTok{ ùî≤ ùî≤ ùî≤ œÉ}
            \OtherTok{(}\NormalTok{comp ùî≤ }
                \OtherTok{(}\NormalTok{comp }\OtherTok{(}\NormalTok{ùî≤ ‚áà ùî≤}\OtherTok{)} 
                    \OtherTok{(}\NormalTok{comp }\OtherTok{(}\NormalTok{ùî≤ ‚áà }\OtherTok{(}\NormalTok{ùî≤ ‚áà ùî≤}\OtherTok{))} 
                        \OtherTok{(}\NormalTok{‚áà[]Lens ùî≤ ùî≤ œÉ }\OtherTok{(}\NormalTok{id }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{))} 
                            \OtherTok{(}\NormalTok{id }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{))}\NormalTok{ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                            \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)))} 
                        \OtherTok{(}\NormalTok{‚áàCurry ùî≤ ùî≤ ùî≤}\OtherTok{))} 
                    \OtherTok{(}\NormalTok{‚áàLens ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                           \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} 
\NormalTok{                           œÄ}\OtherTok{))} 
\NormalTok{                œÄ}\OtherTok{)}
            \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{‚áà[]Lens ùî≤ ùî≤ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                             \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)))} 
\NormalTok{                    œÄ}\OtherTok{)}
            \OtherTok{(}\NormalTok{univ }\OtherTok{(}\NormalTok{compCartesian ùî≤ }
                    \OtherTok{(}\NormalTok{compCartesian }\OtherTok{(}\NormalTok{ùî≤ ‚áà ùî≤}\OtherTok{)} 
                        \OtherTok{(}\NormalTok{compCartesian }\OtherTok{(}\NormalTok{ùî≤ ‚áà }\OtherTok{(}\NormalTok{ùî≤ ‚áà ùî≤}\OtherTok{))} 
                            \OtherTok{(}\NormalTok{‚áà[]LensCart ùî≤ ùî≤ œÉ }\OtherTok{(}\NormalTok{id }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{))} 
                                \OtherTok{(}\NormalTok{id }\OtherTok{(}\NormalTok{ùî≤ ‚óÉ ùî≤}\OtherTok{))}\NormalTok{ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                                \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} 
\NormalTok{                                cœÉ }\OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{))} 
                            \OtherTok{(}\NormalTok{‚áàCurryCart ùî≤ ùî≤ ùî≤}\OtherTok{))} 
                        \OtherTok{(}\NormalTok{‚áà[]LensCart ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ œÄ}
                                     \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} 
                                     \OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{)}\NormalTok{ cœÄ}\OtherTok{))} 
\NormalTok{                    cœÄ}\OtherTok{)}
                  \OtherTok{(}\NormalTok{compCartesian ùî≤ }
                    \OtherTok{(}\NormalTok{‚áà[]LensCart ùî≤ ùî≤ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ œÉ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                        \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} 
                        \OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{))} 
\NormalTok{                    cœÄ}\OtherTok{))}
    
\NormalTok{    distrLaw3 }\OtherTok{:}\NormalTok{ EqDistributor ùî≤ ùî≤ ùï™ ùî≤ }
                    \OtherTok{(}\NormalTok{distrLens ùî≤ ùï™ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùï™}\OtherTok{)}\NormalTok{ Œ∑ }
                               \OtherTok{(}\NormalTok{distrId1 ùî≤}\OtherTok{))} 
                    \OtherTok{(}\NormalTok{distrLens ùî≤ ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                               \OtherTok{(}\NormalTok{distrLaw? ùî≤ œÄ}\OtherTok{))}
\NormalTok{    distrLaw3 }\OtherTok{=} 
\NormalTok{        ap‚áà‚ÜíDistributor ùî≤ ùî≤ ùï™ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}
            \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{‚áàùï™ ùî≤}\OtherTok{)}\NormalTok{ Œ∑}\OtherTok{)} 
            \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{‚áàLens ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                           \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))}\NormalTok{ Œ∑}\OtherTok{)}\NormalTok{ œÄ}\OtherTok{)}
            \OtherTok{(}\NormalTok{univ }\OtherTok{(}\NormalTok{compCartesian ùî≤ }\OtherTok{(}\NormalTok{‚áàùï™Cart ùî≤}\OtherTok{)}\NormalTok{ cŒ∑}\OtherTok{)} 
                  \OtherTok{(}\NormalTok{compCartesian ùî≤ }
                    \OtherTok{(}\NormalTok{‚áà[]LensCart ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ Œ∑ }
                                 \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} 
                                 \OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{)}\NormalTok{ cŒ∑}\OtherTok{)} 
\NormalTok{                    cœÄ}\OtherTok{))}
    
\NormalTok{    distrLaw4 }\OtherTok{:}\NormalTok{ EqDistributor ùï™ ùî≤ ùî≤ ùî≤}
                    \OtherTok{(}\NormalTok{distrLens ùî≤ ùî≤ ùî≤ }\OtherTok{(}\NormalTok{id ùï™}\OtherTok{)}\NormalTok{ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                               \OtherTok{(}\NormalTok{distrId2 ùî≤}\OtherTok{))} 
                    \OtherTok{(}\NormalTok{distrLens ùî≤ ùî≤ ùî≤ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                               \OtherTok{(}\NormalTok{distrLaw? ùî≤ œÄ}\OtherTok{))}
\NormalTok{    distrLaw4 }\OtherTok{=}
\NormalTok{        ap‚áà‚ÜíDistributor ùï™ ùî≤ ùî≤ ùî≤ Œ∑ }
            \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{‚áà[]Lens ùî≤ ùî≤ Œ∑ }\OtherTok{(}\NormalTok{id ùï™}\OtherTok{)} \OtherTok{(}\NormalTok{id ùï™}\OtherTok{)}\NormalTok{ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                             \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)))} 
                    \OtherTok{(}\NormalTok{ùï™‚áà ùî≤}\OtherTok{))}
            \OtherTok{(}\NormalTok{comp ùî≤ }\OtherTok{(}\NormalTok{‚áà[]Lens ùî≤ ùî≤ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}
                             \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)))} 
\NormalTok{                    œÄ}\OtherTok{)} 
            \OtherTok{(}\NormalTok{univ }\OtherTok{(}\NormalTok{compCartesian ùî≤ }
                    \OtherTok{(}\NormalTok{‚áà[]LensCart ùî≤ ùî≤ Œ∑ }\OtherTok{(}\NormalTok{id ùï™}\OtherTok{)} \OtherTok{(}\NormalTok{id ùï™}\OtherTok{)}\NormalTok{ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                                 \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} 
\NormalTok{                                 cŒ∑ }\OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{))} 
                    \OtherTok{(}\NormalTok{ùï™‚áàCart ùî≤}\OtherTok{))} 
                  \OtherTok{(}\NormalTok{compCartesian ùî≤ }
                    \OtherTok{(}\NormalTok{‚áà[]LensCart ùî≤ ùî≤ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)}\NormalTok{ Œ∑ }\OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{id ùî≤}\OtherTok{)} 
                                 \OtherTok{((Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a d }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))} 
                                 \OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{)} \OtherTok{(}\NormalTok{idCart ùî≤}\OtherTok{))} 
\NormalTok{                    cœÄ}\OtherTok{))}
\end{Highlighting}
\end{Shaded}

Hence \texttt{distrLaw?\ ùî≤\ œÄ} is a distributive law, as desired (and
moreover, all of the higher coherences of an \(\infty\)-distributive law
could be demonstrated, following this same method.)

\section{\texorpdfstring{From Distributive Laws to
\(\Pi\)-Types}{From Distributive Laws to \textbackslash Pi-Types}}\label{from-distributive-laws-to-pi-types}

As we have just seen, every polynomial universe \texttt{ùî≤} equipped with
unit, \(\Sigma\), and \(\Pi\) types -- given by Cartesian morphisms
\texttt{y\ ‚áÜ\ ùî≤}, \texttt{ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤}, and \texttt{ùî≤\ ‚áà\ ùî≤\ ‚áÜ\ ùî≤},
respectively -- gives rise to a (Cartesian) monad structure on
\texttt{ùî≤} together with a distributive law of this monad over itself.
Does the converse to this statement hold? That is, given a Cartesian
monad structure with a self-distributive law on some polynomial
universe, does this imply that the universe is closed under unit,
\(\Sigma\), and \(\Pi\)? We have already seen that the existence of a
Cartesian monad structure on a polynomial universe corresponds precisely
to the closure of the universe under unit and \(\Sigma\). However, for
\(\Pi\)-types, the situation is more complex -- we cannot in general
obtain \(\Pi\) types on a polynomial universe with unit and \(\Sigma\)
types from an arbitrary distributive law of the corresponding monad over
itself. This can be seen from the fact that the distributive laws
described above (i.e.~those in the image of \texttt{‚áà‚ÜíDistributor}) have
a rather special form. For instance, such a distributive law
\texttt{(Œ¥\ ,\ Œ¥‚ôØ)\ :\ ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤\ ‚óÉ\ ùî≤} must satisfy the following
identity:

\begin{quote}
\texttt{snd\ (Œ¥\ (a\ ,\ Œ≥))\ x\ ‚â°\ a} for all
\texttt{a\ :\ fst\ ùî≤,\ Œ≥\ :\ snd\ ùî≤\ a\ ‚Üí\ fst\ ùî≤,\ x\ :\ snd\ ùî≤\ (fst\ (Œ¥\ (a\ ,\ Œ≥))}
\end{quote}

\noindent and this need not be the case for arbitrary distributive laws.

What is needed to make such a translation from distributive laws to
\texttt{Œ†} types possible is some restriction of the space of possible
distributive laws so as to make the closure of a polynomial universe
under \texttt{Œ†} types equivalent to the existence of such a
distributive law. Indeed, the closure of the universe under unit and
\texttt{Œ£} types corresponded not to the existence of an arbitrary
monad, but rather of a \emph{Cartesian} monad, so what we seek is an
appropriate notion of \emph{Cartesian} distributive law of Cartesian
monads that will give rise to \texttt{Œ†} types on polynomial universes.

For this purpose, we define the auxiliary notion of a \emph{Jump
structure} of a lens \texttt{(f\ ,\ f‚ôØ)\ :\ p\ ‚áÜ\ q} on a distributor
\texttt{(g\ ,\ g‚ôØ)\ :\ p\ ‚óÉ\ r\ ‚áÜ\ q\ ‚óÉ\ s}. Intuitively, a jump
structure of \texttt{(f\ ,\ f‚ôØ)} on \texttt{(g\ ,\ g‚ôØ)} witnesses that
\texttt{(g\ ,\ g‚ôØ)} ``applies the action of \texttt{(f\ ,\ f‚ôØ)} on
\texttt{p} and \texttt{q} while jumping over its action on \texttt{r}
and \texttt{s}.'' In concrete terms, this means that we must have
witnesses to the following equations:

\begin{itemize}
\tightlist
\item
  \texttt{snd\ (g\ (a\ ,\ Œ≥))\ x\ ‚â°\ f\ a} for all
  \texttt{a\ :\ fst\ p,\ Œ≥\ :\ snd\ p\ a\ ‚Üí\ fst\ r,\ x\ :\ snd\ s\ (fst\ (g\ (a\ ,\ Œ≥))}
\item
  \texttt{fst\ (g‚ôØ\ (a\ ,\ Œ≥)\ (x\ ,\ y))\ ‚â°\ f‚ôØ\ a\ y} for all
  \texttt{a,\ Œ≥,\ x} as above and \texttt{y\ :\ snd\ q\ (f\ a)}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{module}\NormalTok{ JumpDistr }\OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 ‚Ñì2 ‚Ñì3 Œ∫0 Œ∫1 Œ∫2 Œ∫3}\OtherTok{\}}
       \OtherTok{(}\NormalTok{p }\OtherTok{:}\NormalTok{ Poly ‚Ñì0 Œ∫0}\OtherTok{)} \OtherTok{(}\NormalTok{q }\OtherTok{:}\NormalTok{ Poly ‚Ñì1 Œ∫1}\OtherTok{)}
       \OtherTok{(}\NormalTok{r }\OtherTok{:}\NormalTok{ Poly ‚Ñì2 Œ∫2}\OtherTok{)} \OtherTok{(}\NormalTok{s }\OtherTok{:}\NormalTok{ Poly ‚Ñì3 Œ∫3}\OtherTok{)}
       \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ p ‚áÜ q}\OtherTok{)} \KeywordTok{where}

\NormalTok{    Jump }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{s ‚óÉ q}\OtherTok{)} \OtherTok{‚Üí} \DataTypeTok{Set} \OtherTok{(}\NormalTok{‚Ñì0 ‚äî ‚Ñì1 ‚äî ‚Ñì2 ‚äî Œ∫0 ‚äî Œ∫1 ‚äî Œ∫3}\OtherTok{)}
\NormalTok{    Jump }\OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{=}
\NormalTok{        Œ£ }\OtherTok{((}\NormalTok{a }\OtherTok{:}\NormalTok{ fst p}\OtherTok{)} \OtherTok{(}\NormalTok{Œ≥ }\OtherTok{:}\NormalTok{ snd p a }\OtherTok{‚Üí}\NormalTok{ fst r}\OtherTok{)} 
           \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ snd s }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))))} 
            \OtherTok{‚Üí}\NormalTok{ snd }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))}\NormalTok{ x ‚â° fst f a}\OtherTok{)} 
           \OtherTok{Œª}\NormalTok{ e }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ fst p}\OtherTok{)} \OtherTok{(}\NormalTok{Œ≥ }\OtherTok{:}\NormalTok{ snd p a }\OtherTok{‚Üí}\NormalTok{ fst r}\OtherTok{)} 
                 \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ snd s }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))))}
                 \OtherTok{(}\NormalTok{y }\OtherTok{:}\NormalTok{ snd q }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{))}\NormalTok{ x}\OtherTok{))}
                 \OtherTok{‚Üí}\NormalTok{ fst }\OtherTok{(}\NormalTok{g‚ôØ }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{(}\NormalTok{x , y}\OtherTok{))}
\NormalTok{                   ‚â° snd f a }\OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd q}\OtherTok{)} \OtherTok{(}\NormalTok{e a Œ≥ x}\OtherTok{)}\NormalTok{ y}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

By construction, the distributive laws \texttt{ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤\ ‚óÉ\ ùî≤}
defined above can be naturally equipped with Jump structures of
\texttt{id\ ùî≤\ :\ ùî≤\ ‚áÜ\ ùî≤}. More generally, in fact, distributors
\texttt{p\ ‚óÉ\ r\ ‚áÜ\ s\ ‚óÉ\ q} arising from morphisms
\texttt{p\ ‚áà{[}\ q\ {]}{[}\ f\ {]}\ r\ ‚áÜ\ s} via \texttt{‚áà‚ÜíDistributor}
as above naturally carry jump structures of \texttt{f\ :\ p\ ‚áÜ\ q}, as
follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    ‚áà‚ÜíJump }\OtherTok{:} \OtherTok{(}\NormalTok{g }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] r}\OtherTok{)}\NormalTok{ ‚áÜ s}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ Jump }\OtherTok{(}\NormalTok{‚áà‚ÜíDistributor q r g}\OtherTok{)}
\NormalTok{    ‚áà‚ÜíJump g }\OtherTok{=} \OtherTok{((Œª}\NormalTok{ a Œ≥ x }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{)}\NormalTok{ , }\OtherTok{(Œª}\NormalTok{ a Œ≥ x y }\OtherTok{‚Üí}\NormalTok{ refl}\OtherTok{))}
\end{Highlighting}
\end{Shaded}

Conversely, given a jump structure of \texttt{f\ :\ p\ ‚áÜ\ q} on a
distributor \texttt{g\ :\ p\ ‚óÉ\ r\ ‚áÜ\ s\ ‚óÉ\ q}, we obtain a morphism
\texttt{p\ ‚áà{[}\ q\ {]}{[}\ f\ {]}\ r\ ‚áÜ\ s} as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    Jump‚Üí‚áà }\OtherTok{:} \OtherTok{(}\NormalTok{g }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚óÉ r}\OtherTok{)}\NormalTok{ ‚áÜ }\OtherTok{(}\NormalTok{s ‚óÉ q}\OtherTok{))} \OtherTok{‚Üí}\NormalTok{ Jump g}
             \OtherTok{‚Üí} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] r}\OtherTok{)}\NormalTok{ ‚áÜ s}
\NormalTok{    Jump‚Üí‚áà }\OtherTok{(}\NormalTok{g , g‚ôØ}\OtherTok{)} \OtherTok{(}\NormalTok{e , e‚ôØ}\OtherTok{)} \OtherTok{=}
      \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ fst }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)))} 
\NormalTok{      , }\OtherTok{Œª} \OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)}\NormalTok{ x y }
        \OtherTok{‚Üí}\NormalTok{ transp }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ snd r }\OtherTok{(}\NormalTok{Œ≥ z}\OtherTok{))}
            \OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{g‚ôØ }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{(}\NormalTok{x , transp }\OtherTok{(}\NormalTok{snd q}\OtherTok{)} \OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{e a Œ≥ x}\OtherTok{))}\NormalTok{ y}\OtherTok{))} 
\NormalTok{                  ‚â°‚å© e‚ôØ a Œ≥ x }\OtherTok{(}\NormalTok{transp }\OtherTok{(}\NormalTok{snd q}\OtherTok{)} \OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{e a Œ≥ x}\OtherTok{))}\NormalTok{ y}\OtherTok{)}\NormalTok{ ‚å™ }
\NormalTok{                  ap }\OtherTok{(}\NormalTok{snd f a}\OtherTok{)} \OtherTok{(}\NormalTok{symr }\OtherTok{(}\NormalTok{e a Œ≥ x}\OtherTok{)}\NormalTok{ y}\OtherTok{))}
            \OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{g‚ôØ }\OtherTok{(}\NormalTok{a , Œ≥}\OtherTok{)} \OtherTok{(}\NormalTok{x , transp }\OtherTok{(}\NormalTok{snd q}\OtherTok{)} \OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{e a Œ≥ x}\OtherTok{))}\NormalTok{ y}\OtherTok{)))} \OtherTok{)}
\end{Highlighting}
\end{Shaded}

We say that a distributor \texttt{g\ :\ p\ ‚óÉ\ r\ ‚áÜ\ s\ ‚óÉ\ q} equipped
with a jump structure \texttt{j\ :\ Jump\ g} of \texttt{f\ :\ p\ ‚áÜ\ q}
is \emph{Cartesian} if the corresponding morphism
\texttt{Jump‚Üí‚áà\ g\ :\ p\ ‚áà{[}\ q\ {]}{[}\ f\ {]}\ r\ ‚áÜ\ s} is Cartesian.
In particular, given a Cartesian morphism
\texttt{g\ :\ p\ ‚áà{[}\ q\ {]}{[}\ f\ {]}\ r\ ‚áÜ\ s}, it follows that the
distributor \texttt{‚áà‚ÜíDistributor\ q\ r\ g\ :\ p\ ‚óÉ\ r\ ‚áÜ\ s\ ‚óÉ\ q}
equipped with the jump structure \texttt{‚áà‚ÜíJump\ g}, is Cartesian.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    JumpCart }\OtherTok{:} \OtherTok{(}\NormalTok{g }\OtherTok{:} \OtherTok{(}\NormalTok{p ‚áà[ q ][ f ] r}\OtherTok{)}\NormalTok{ ‚áÜ s}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isCartesian s g}
               \OtherTok{‚Üí}\NormalTok{ isCartesian s }\OtherTok{(}\NormalTok{Jump‚Üí‚áà }\OtherTok{(}\NormalTok{‚áà‚ÜíDistributor q r g}\OtherTok{)} \OtherTok{(}\NormalTok{‚áà‚ÜíJump g}\OtherTok{))}
\NormalTok{    JumpCart g cg }\OtherTok{=}\NormalTok{ cg}

\KeywordTok{open}\NormalTok{ JumpDistr}
\end{Highlighting}
\end{Shaded}

Hence we define a Cartesian distributive law of polynomial monads
\texttt{m\ ,\ n} as a distributive law
\texttt{Œ¥\ :\ n\ ‚óÉ\ m\ ‚áÜ\ m\ ‚óÉ\ n} of \texttt{m} over \texttt{n},
equipped with a jump structure of \texttt{id\ n\ :\ n\ ‚áÜ\ n} on
\texttt{Œ¥}, such that \texttt{Œ¥} is Cartesian, in the above sense. It
follows, then, that given a polynomial universe \texttt{ùî≤} equipped with
a Cartesian monad structure \texttt{Œ∑\ :\ y\ ‚áÜ\ ùî≤,\ Œº\ :\ ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤}
and a Cartesian distributive law \texttt{Œ¥\ :\ ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤\ ‚óÉ\ ùî≤} of
this monad over itself, applying \texttt{Jump‚Üí‚áà} to this distributive
law yields a Cartesian morphism \texttt{ùî≤\ ‚áà\ ùî≤\ ‚áÜ\ ùî≤} witnessing that
\texttt{ùî≤} is closed under \texttt{Œ†} types.

From this we obtain the main theorem of this paper:

\begin{theorem}
A polynomial universe ùî≤ is closed under unit, Œ£, and Œ† types if and only if there exists a Cartesian monad structure on ùî≤ together with a Cartesian distributive law of this monad over itself.
\end{theorem}

Since from any \texttt{ùî≤} closed under these types we obtain a Cartesian
monad and Cartesian self-distributive law on \texttt{ùî≤}, and from any
Cartesian monad structure on \texttt{ùî≤} and Cartesian distributive law
of this monad over itself, we obtain Cartesian morphisms
\texttt{y\ ‚áÜ\ ùî≤,\ ùî≤\ ‚óÉ\ ùî≤\ ‚áÜ\ ùî≤,\ ùî≤\ ‚áà\ ùî≤\ ‚áÜ\ ùî≤} as above.

\chapter{Further Structures on Polynomial
Universes}\label{further-structures-on-polynomial-universes}

In closing, we turn to briefly consider whether and how some additional
type-theoretic constructs may be defined for natural models / polynomial
universes in the language of polynomial functors, starting with the
concept of a universe itself.

\section{The Shift Operator \&
Universes}\label{the-shift-operator-universes}

Throughout this paper, we have made extensive use of universes of types.
A natural question to ask, then, is when the type theory presented by a
polynomial universe itself contains another such universe as a type
within itself.

For this purpose, let \texttt{ùî≥\ ,\ ùî≤} be polynomial universes with
\texttt{ùî≥\ =\ (ùì•\ ,\ Elùì•)} and \texttt{ùî≤\ =\ (ùì§\ ,\ Elùì§)}. If there is a
(necessarily unique) Cartesian morphism \texttt{ùî≥\ ‚áÜ\ ùî≤}, then it
follows that every type family classified by \texttt{ùî≥} is also
classified by \texttt{ùî≤}, by composition of Cartesian morphisms.
However, what we want in this case is the stronger property that
\texttt{ùî≥} is somehow represented as a type within \texttt{ùî≤}.

For this purpose, we define the following \emph{shift} operation that
takes a polynomial \texttt{p\ =\ (A\ ,\ B)} to the polynomial
\texttt{shift\ p\ =\ (‚ä§\ ,\ Œª\ \_\ ‚Üí\ A)}. Equivalently, this is
\(\left[ \begin{array}{c} p\\ y \end{array} \right]\), where
\(\left[ \begin{array}{c} -\\ - \end{array} \right]\) is the left
coclosure of \(\triangleleft\) defined in \cite{spivak2022poly}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{shift }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì Œ∫ }\OtherTok{‚Üí}\NormalTok{ Poly lzero ‚Ñì}
\NormalTok{shift }\OtherTok{(}\NormalTok{A , }\OtherTok{\_)} \OtherTok{=} \OtherTok{(}\NormalTok{‚ä§ , }\OtherTok{Œª} \OtherTok{\_} \OtherTok{‚Üí}\NormalTok{ A}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

By construction, then, if there is a Cartesian morphism
\texttt{(v\ ,\ v‚ôØ)\ :\ shift\ (ùì•\ ,\ Elùì•)\ ‚áÜ\ (ùì§\ ,\ Elùì§)}, it follows
that:

\begin{itemize}
\tightlist
\item
  There is a type \texttt{v\ tt\ :\ ùì§}; type theoretically, this
  corresponds to a type formation rule of the form \[
  \inferrule{~}{\Gamma \vdash \mathcal{V} ~ \mathsf{Type}}
  \] We think of \texttt{ùì•} as a type whose elements are ``codes'' for
  other types.
\item
  There is a function \texttt{v‚ôØ\ tt\ :\ Elùì§\ (v\ tt)\ ‚Üí\ ùì•},
  corresponding to the rule \[
  \inferrule{\Gamma \vdash e : ùì•}{\Gamma \vdash \lceil e \rceil ~ \mathsf{Type}}
  \] which decodes a code contained in \texttt{ùì•} to its corresponding
  type.
\item
  There is a function \texttt{v‚ôØ‚Åª¬π\ tt\ :\ ùì•\ ‚Üí\ Elùì§\ (v\ tt)},
  corresponding to the rule \[
  \inferrule{\Gamma \vdash A ~ \mathsf{Type}\\ A ~ \text{is classifed by} ~ \mathfrak{v}}{\Gamma \vdash \lfloor A \rfloor : \mathcal{V}}
  \] that assigns a code to each type classified by \texttt{ùî≥} (note
  that this restriction to types classified by \texttt{ùî≥} is necessary
  to avoid the paradoxes that would arise from having a type universe
  that contained itself.)
\item
  Such that the following equations hold \[
  \lceil \lfloor A \rfloor \rceil = A \qquad e = \lfloor \lceil e \rceil \rfloor
  \]
\end{itemize}

\section{\texorpdfstring{The \((-)^=\) Operator \& Extensional Identity
Types}{The (-)\^{}= Operator \& Extensional Identity Types}}\label{the---operator-extensional-identity-types}

Another key construct of dependent type theory which has figured
prominently in the foregoing development of polynomial universes, but
which we have not yet shown how to internalize in such universes, is the
construction of \emph{identity types}. To some extent, this choice has
been deliberate, as the theory of identity types is arguably one of the
most complex aspects of dependent type theory, as evidenced by the fact
that research into this topic ultimately precipitated the development of
homotopy type theory. For this very reason, however, an account of the
semantics of dependent type theory without at least some indication of
its application to the theory of identity types would be incomplete.

Readers familiar with dependent type theory may be aware that an initial
complication posed by the theory of identity types is that these types
come in two flavors: extensional and intensional. Extensional identity
types reflect propositional equality (i.e.~the existence of an
inhabitant for the type \texttt{a\ ‚â°\ b}) into judgmental equality
(i.e.~the metatheoretic proposition that \texttt{a\ =\ b}) and
additionally regard all such proofs of identity as themselves identical.
It follows that these identity types carry none of the homotopical
information afforded by the alternative -- intensional identity types,
which are the sort which we have so far used in this paper. However,
when working within such a homotopical framework, wherein metatheoretic
equality need not be a mere proposition, there exists the possibility of
defining extensional identity types in a polynomial universe so as to
enable the aforementioned reflection while still allowing proofs of
identity to carry higher-dimensional data.

For this purpose, let \texttt{ùî≤\ =\ (ùì§\ ,\ El)} be a polynomial
universe. We wish to establish under what conditions \texttt{ùî≤} would be
closed under the formation of ``identity types'' for the types
classified by it. Solving this problem in essentially the same manner as
led to the definiiton of the \texttt{‚áà} functor in the previous section
yields the following construction, that maps \texttt{p\ =\ (A\ ,\ B)} to
the polynomial
\texttt{p‚Åº\ =\ (Œ£\ A\ (Œª\ a\ ‚Üí\ B\ a\ √ó\ B\ a)\ ,\ Œª\ (\_\ ,\ (b1\ ,\ b2))\ ‚Üí\ b1\ ‚â°\ b2)}.

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{\_}\NormalTok{‚Åº }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{‚Üí}\NormalTok{ Poly ‚Ñì Œ∫ }\OtherTok{‚Üí}\NormalTok{ Poly }\OtherTok{(}\NormalTok{‚Ñì ‚äî Œ∫}\OtherTok{)}\NormalTok{ Œ∫}
\OtherTok{(}\NormalTok{A , B}\OtherTok{)}\NormalTok{‚Åº }\OtherTok{=} \OtherTok{(}\NormalTok{Œ£ A }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ B a √ó B a}\OtherTok{)}\NormalTok{ , }\OtherTok{Œª} \OtherTok{(\_}\NormalTok{ , }\OtherTok{(}\NormalTok{b1 , b2}\OtherTok{))} \OtherTok{‚Üí}\NormalTok{ b1 ‚â° b2}\OtherTok{)}
\end{Highlighting}
\end{Shaded}

If there is a Cartesian morphism \texttt{(Œµ\ ,\ Œµ‚ôØ)\ :\ ùî≤‚Åº\ ‚áÜ\ ùî≤} then:

\begin{itemize}
\tightlist
\item
  For each type \texttt{A\ :\ ùì§} with elements
  \texttt{a‚ÇÄ\ ,\ a‚ÇÅ\ :\ El\ A}, there is a type
  \texttt{Eq(A,\ a‚ÇÄ,\ a‚ÇÅ)\ :\ ùì§}. Type theoretically, this corresponds
  to the type formation rule \[
  \inferrule{\Gamma \vdash A ~ \mathsf{Type}\\ \Gamma \vdash a_0 : A\\ \Gamma \vdash a_1 : A}{\Gamma \vdash a_0 \equiv_A a_1 ~ \mathsf{Type}}
  \]
\item
  For each \texttt{A\ :\ ùì§} and \texttt{a‚ÇÄ\ ,\ a‚ÇÅ\ :\ El\ A} as above,
  there is a function \texttt{El\ Eq(A,\ a‚ÇÄ,\ a‚ÇÅ)\ ‚Üí\ a‚ÇÄ\ ‚â°\ a‚ÇÅ}
  corresponding to the \emph{reflection rule} \[
  \inferrule{\Gamma \vdash e : a_0 \equiv_A a_1}{\Gamma \vdash a_0 = a_1}
  \] that converts an inhabitant of the propositional equality into a
  proof of the corresponding judgmental equality.
\item
  Likewise, there is a function
  \texttt{a‚ÇÄ\ ‚â°\ a‚ÇÅ\ ‚Üí\ El\ Eq(A,\ a‚ÇÄ,\ a‚ÇÅ)} corresponding to the
  \emph{reflexivity rule} \[
  \inferrule{\Gamma \vdash a_0 = a_1}{\Gamma \vdash \mathsf{refl} : a_0 \equiv_A a_1}
  \] that produces an inhabitant of the propositional equality given a
  proof of the corresponding judgmental equality.
\item
  Such that the above two functions/rules are mutually inverse.
\end{itemize}

What is missing from the above description of extensional identity types
is the following rule \[
\inferrule{\Gamma \vdash e_1 : a_0 \equiv_A a_1\\ \Gamma \vdash e_2 : a_0 \equiv_A a_1}{\Gamma \vdash e_1 = e_2}
\] which says that all inhabitants of the identity type are themselves
identical (i.e.~the identity type is a \emph{mere proposition}). This
rule would be validated if we additionally required \texttt{ùî≤} to have
the property that, for all types \texttt{A\ :\ ùì§}, the type
\texttt{El\ A} is a set (hence for any \texttt{a\ b\ :\ El\ A}, the type
\texttt{a\ ‚â°\ b} is a mere proposition.) However, if we do not make this
requirement, this opens the possibility of having a model of extensional
type theory, modulo the above rule, wherein proofs of equality still
carry homotopical information -- a potentially new direction in research
on the semantics of identity types.

\subsection{A Note on Intensional Identity Types \& Inductive
Types}\label{a-note-on-intensional-identity-types-inductive-types}

Attempting to account for \emph{intensional} rather than
\emph{extensional} identity types in the language of polynomial functors
is rather more complicated, however. As mentioned in Section 2, the
inhabitants of intensional identity types are inductively generated from
the constructor \texttt{refl}, corresponding to reflexivity. The problem
with such inductive generation of data from constructors -- from the
point of view taken in this paper -- is that it characterizes types in
terms of their introduction forms, rather than their elimination forms.
In type theoretic jargon, we say that intensional identity types, and
inductive types more generally are \emph{positive,} whereas all of the
types we have considered so far are \emph{negative,} in that they are
characterized by their elimination forms. The universal properties of
such negative types are therefore \emph{mapping-in} properties, which
are naturally described in terms of presheaves, which we have taken as
our intended model for the development of this paper. By contrast,
however, the universal properties of positive types are given by
\emph{mapping-out} properties, which are rather described in terms of
(the opposite category of) \emph{co-presheaves.}

As an illustrative example, let us consider the rather simpler case of
(binary) coproducts, which are naturally regarded as positive types
characterized by the left and right injections \texttt{A\ ‚Üí\ A\ +\ B}
and \texttt{B\ ‚Üí\ A\ +\ B}. one might think to define binary coproducts
on a polynomial universe \texttt{ùî≤} in the following way:

The \emph{product} of two polynomial functors
\(p = \sum_{a : A} y^{B[a]}\) and \(q = \sum_{c : C} y^{D[c]}\) can be
calculated as follows: \[
\begin{array}{rl} & \left( \sum_{a : A} y^{B[a]} \right) \times \left( \sum_{c : C} y^{D[c]} \right)\\
\simeq & \sum_{(a , c) : A \times C} y^{B[a]} \times y^{D[c]}\\
\simeq & \sum_{(a , c) : A \times C} y^{B[a] + D[c]}
\end{array}
\] Hence one might think to define binary coproducts on a polynomial
universe \texttt{ùî≤\ =\ (ùì§\ ,\ El)} by asking there to be a Cartesian
morphism \texttt{ùî≤\ √ó\ ùî≤\ ‚áÜ\ ùî≤}, since this would mean that for every
pair of types \texttt{(A\ ,\ B)\ :\ ùì§\ √ó\ ùì§}, there is a type
\texttt{plus(A\ ,\ B)\ :\ ùì§} such that
\texttt{El(plus(A\ ,\ B))\ ‚âÉ\ El\ A\ +\ El\ B}.

However, from the perspective of natural models, this condition is too
strong. Given a category of contexts \(\mathcal{C}\), the category
\(\mathbf{Set}^{\mathcal{C}^{op}}\) of presheaves on \(\mathcal{C}\) is
the free cocompletion of \(\mathcal{C}\), which means that requiring
\(\mathcal{C}\) to be closed under taking binary coproducts of
representables in \(\mathbf{Set}^{\mathcal{C}^{op}}\) means not only
that \(\mathcal{C}\) has all binary coproducts, but that in fact all
such coproducts in \(\mathcal{C}\) are \emph{free.}

Hence it remains to be seen if there can be found a general way of
correctly expressing such ``positive'' type-theoretic concepts as for
polynomial universes and natural models in the language of polynomial
functors. We hope to continue investigations into these and related
questions in future work.

\section{Conclusion}\label{conclusion}

In this paper, we have advanced a simplified and unified account of the
categorical semantics of dependent type theory by expressing the core
concepts of natural models entirely within the framework of polynomial
functors in HoTT. By utilizing HoTT, we have been able strike an ideal
balance between issues of strictness and higher-dimensional coherence
that have bedeviled previous accounts. This shift not only streamlines
the presentation of the semantics of dependent type theory, but also
reveals additional structures thereof, such as the self-distributive law
governing the interaction between dependent products and sums.

However, there remain many open questions regarding the further
development of this framework, particularly with respect to
\emph{positive} type-theoretic constructs such as coproducts, inductive
types, and intensional identity types. Further work is needed to explore
whether polynomial functors can provide a fully general account of these
concepts. We look forward to continuing these investigations, with the
aim of extending the unification presented here to encompass a wider
range of type-theoretic phenomena.

\printbibliography

\chapter{Appendix A}\label{appendix-a}

Some additional identities/theorems from HoTT used throughout this
paper:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transpAp }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì ‚Ñì\textquotesingle{} Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A\textquotesingle{} }\OtherTok{:}\NormalTok{ Type ‚Ñì\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
           \OtherTok{‚Üí} \OtherTok{(}\NormalTok{B }\OtherTok{:}\NormalTok{ A\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{)} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ A\textquotesingle{}}\OtherTok{)} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ B }\OtherTok{(}\NormalTok{f a}\OtherTok{))}
           \OtherTok{‚Üí}\NormalTok{ transp }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ B }\OtherTok{(}\NormalTok{f x}\OtherTok{))}\NormalTok{ e x ‚â° transp B }\OtherTok{(}\NormalTok{ap f e}\OtherTok{)}\NormalTok{ x}
\NormalTok{transpAp B f refl x }\OtherTok{=}\NormalTok{ refl}

\NormalTok{‚Ä¢invr }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{sym e}\OtherTok{)}\NormalTok{ ‚Ä¢ e ‚â° refl}
\NormalTok{‚Ä¢invr refl }\OtherTok{=}\NormalTok{ refl}

\NormalTok{‚â°siml }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
        \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ refl ‚â° }\OtherTok{(}\NormalTok{b ‚â°‚å© sym e ‚å™ e}\OtherTok{)}
\NormalTok{‚â°siml refl }\OtherTok{=}\NormalTok{ refl}

\NormalTok{‚â°idr }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
       \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ e ‚â° }\OtherTok{(}\NormalTok{a ‚â°‚å© refl ‚å™ e}\OtherTok{)}
\NormalTok{‚â°idr refl }\OtherTok{=}\NormalTok{ refl}

\NormalTok{conj }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b c d }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
       \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e1 }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \OtherTok{(}\NormalTok{e2 }\OtherTok{:}\NormalTok{ a ‚â° c}\OtherTok{)} \OtherTok{(}\NormalTok{e3 }\OtherTok{:}\NormalTok{ b ‚â° d}\OtherTok{)} \OtherTok{(}\NormalTok{e4 }\OtherTok{:}\NormalTok{ c ‚â° d}\OtherTok{)}
       \OtherTok{‚Üí} \OtherTok{(}\NormalTok{a ‚â°‚å© e1 ‚å™ e3}\OtherTok{)}\NormalTok{ ‚â° }\OtherTok{(}\NormalTok{a ‚â°‚å© e2 ‚å™ e4}\OtherTok{)}
       \OtherTok{‚Üí}\NormalTok{ e3 ‚â° }\OtherTok{(}\NormalTok{b ‚â°‚å© sym e1 ‚å™}\OtherTok{(}\NormalTok{a ‚â°‚å© e2 ‚å™ e4}\OtherTok{))}
\NormalTok{conj e1 e2 refl refl refl }\OtherTok{=}\NormalTok{ ‚â°siml e1}

\NormalTok{nat }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{f g }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
      \OtherTok{‚Üí} \OtherTok{(}\NormalTok{Œ± }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f x ‚â° g x}\OtherTok{)} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)}
      \OtherTok{‚Üí} \OtherTok{((}\NormalTok{f a}\OtherTok{)}\NormalTok{ ‚â°‚å© Œ± a ‚å™ }\OtherTok{(}\NormalTok{ap g e}\OtherTok{))}\NormalTok{ ‚â° }\OtherTok{((}\NormalTok{f a}\OtherTok{)}\NormalTok{ ‚â°‚å© ap f e ‚å™ }\OtherTok{(}\NormalTok{Œ± b}\OtherTok{))}
\NormalTok{nat }\OtherTok{\{}\NormalTok{a }\OtherTok{=}\NormalTok{ a}\OtherTok{\}}\NormalTok{ Œ± refl }\OtherTok{=}\NormalTok{ ‚â°idr }\OtherTok{(}\NormalTok{Œ± a}\OtherTok{)}

\NormalTok{cancel }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b c }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
         \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e1 e2 }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \OtherTok{(}\NormalTok{e3 }\OtherTok{:}\NormalTok{ b ‚â° c}\OtherTok{)}
         \OtherTok{‚Üí} \OtherTok{(}\NormalTok{a ‚â°‚å© e1 ‚å™ e3}\OtherTok{)}\NormalTok{ ‚â° }\OtherTok{(}\NormalTok{a ‚â°‚å© e2 ‚å™ e3}\OtherTok{)}
         \OtherTok{‚Üí}\NormalTok{ e1 ‚â° e2}
\NormalTok{cancel e1 e2 refl refl }\OtherTok{=}\NormalTok{ refl}

\NormalTok{apId }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
       \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ ap }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ x}\OtherTok{)}\NormalTok{ e ‚â° e}
\NormalTok{apId refl }\OtherTok{=}\NormalTok{ refl}

\NormalTok{apComp }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì ‚Ñì\textquotesingle{} ‚Ñì\textquotesingle{}\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type ‚Ñì\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{C }\OtherTok{:}\NormalTok{ Type ‚Ñì\textquotesingle{}\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{a b }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
         \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \OtherTok{(}\NormalTok{g }\OtherTok{:}\NormalTok{ B }\OtherTok{‚Üí}\NormalTok{ C}\OtherTok{)} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° b}\OtherTok{)}
         \OtherTok{‚Üí}\NormalTok{ ap }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f x}\OtherTok{))}\NormalTok{ e ‚â° ap g }\OtherTok{(}\NormalTok{ap f e}\OtherTok{)}
\NormalTok{apComp f g refl }\OtherTok{=}\NormalTok{ refl}

\NormalTok{apHtpy }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
         \OtherTok{‚Üí} \OtherTok{(}\NormalTok{i }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ A}\OtherTok{)} \OtherTok{(}\NormalTok{Œ± }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ i x ‚â° x}\OtherTok{)}
         \OtherTok{‚Üí}\NormalTok{ ap i }\OtherTok{(}\NormalTok{Œ± a}\OtherTok{)}\NormalTok{ ‚â° Œ± }\OtherTok{(}\NormalTok{i a}\OtherTok{)}
\NormalTok{apHtpy }\OtherTok{\{}\NormalTok{a }\OtherTok{=}\NormalTok{ a}\OtherTok{\}}\NormalTok{ i Œ± }\OtherTok{=} 
\NormalTok{    cancel }\OtherTok{(}\NormalTok{ap i }\OtherTok{(}\NormalTok{Œ± a}\OtherTok{))} \OtherTok{(}\NormalTok{Œ± }\OtherTok{(}\NormalTok{i a}\OtherTok{))} \OtherTok{(}\NormalTok{Œ± a}\OtherTok{)} 
           \OtherTok{((}\NormalTok{i }\OtherTok{(}\NormalTok{i a}\OtherTok{)}\NormalTok{ ‚â°‚å© ap i }\OtherTok{(}\NormalTok{Œ± a}\OtherTok{)}\NormalTok{ ‚å™ Œ± a}\OtherTok{)} 
\NormalTok{           ‚â°‚å© sym }\OtherTok{(}\NormalTok{nat Œ± }\OtherTok{(}\NormalTok{Œ± a}\OtherTok{))}\NormalTok{ ‚å™ }
           \OtherTok{((}\NormalTok{i }\OtherTok{(}\NormalTok{i a}\OtherTok{)}\NormalTok{ ‚â°‚å© Œ± }\OtherTok{(}\NormalTok{i a}\OtherTok{)}\NormalTok{ ‚å™ ap }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ z}\OtherTok{)} \OtherTok{(}\NormalTok{Œ± a}\OtherTok{))} 
\NormalTok{           ‚â°‚å© ap }\OtherTok{(Œª}\NormalTok{ e }\OtherTok{‚Üí}\NormalTok{ i }\OtherTok{(}\NormalTok{i a}\OtherTok{)}\NormalTok{ ‚â°‚å© Œ± }\OtherTok{(}\NormalTok{i a}\OtherTok{)}\NormalTok{ ‚å™ e}\OtherTok{)} \OtherTok{(}\NormalTok{apId }\OtherTok{(}\NormalTok{Œ± a}\OtherTok{))}\NormalTok{ ‚å™ }
           \OtherTok{((}\NormalTok{i }\OtherTok{(}\NormalTok{i a}\OtherTok{)}\NormalTok{ ‚â°‚å© Œ± }\OtherTok{(}\NormalTok{i a}\OtherTok{)}\NormalTok{ ‚å™ Œ± a}\OtherTok{)}\NormalTok{ ‚ñ°}\OtherTok{)))}

\NormalTok{HAdj }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}}
       \OtherTok{‚Üí} \OtherTok{(}\NormalTok{A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí} \DataTypeTok{Set} \OtherTok{(}\NormalTok{‚Ñì ‚äî Œ∫}\OtherTok{)}
\NormalTok{HAdj }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ A}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ B}\OtherTok{\}}\NormalTok{ f }\OtherTok{=}
\NormalTok{    Œ£ }\OtherTok{(}\NormalTok{B }\OtherTok{‚Üí}\NormalTok{ A}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ g }\OtherTok{‚Üí} 
\NormalTok{      Œ£ }\OtherTok{((}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f x}\OtherTok{)}\NormalTok{ ‚â° x}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ Œ∑ }\OtherTok{‚Üí} 
\NormalTok{        Œ£ }\OtherTok{((}\NormalTok{y }\OtherTok{:}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f }\OtherTok{(}\NormalTok{g y}\OtherTok{)}\NormalTok{ ‚â° y}\OtherTok{)} \OtherTok{(Œª}\NormalTok{ Œµ }\OtherTok{‚Üí} 
          \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ ap f }\OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)}\NormalTok{ ‚â° Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{))))}

\NormalTok{Iso‚ÜíHAdj }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{\}}
           \OtherTok{‚Üí}\NormalTok{ Iso f }\OtherTok{‚Üí}\NormalTok{ HAdj f}
\NormalTok{Iso‚ÜíHAdj }\OtherTok{\{}\NormalTok{f }\OtherTok{=}\NormalTok{ f}\OtherTok{\}} \OtherTok{(}\NormalTok{g , Œ∑ , Œµ}\OtherTok{)} \OtherTok{=}
\NormalTok{    g , }\OtherTok{(}\NormalTok{Œ∑ }
\NormalTok{    , }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ y }\OtherTok{‚Üí} 
\NormalTok{           f }\OtherTok{(}\NormalTok{g y}\OtherTok{)}\NormalTok{         ‚â°‚å© sym }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g y}\OtherTok{)))}\NormalTok{ ‚å™ }
          \OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g y}\OtherTok{)))}\NormalTok{ ‚â°‚å© ap f }\OtherTok{(}\NormalTok{Œ∑ }\OtherTok{(}\NormalTok{g y}\OtherTok{))}\NormalTok{ ‚å™ }
          \OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g y}\OtherTok{)}\NormalTok{         ‚â°‚å© Œµ y ‚å™ }
          \OtherTok{(}\NormalTok{y               ‚ñ°}\OtherTok{))))} 
\NormalTok{      , }\OtherTok{Œª}\NormalTok{ x }
          \OtherTok{‚Üí}\NormalTok{ conj }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{))))} \OtherTok{(}\NormalTok{ap f }\OtherTok{(}\NormalTok{Œ∑ }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{))))} 
              \OtherTok{(}\NormalTok{ap f }\OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{))} \OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{))} 
              \OtherTok{(((}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{))))}\NormalTok{ ‚â°‚å© Œµ }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ ‚å™ ap f }\OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)))} 
\NormalTok{              ‚â°‚å© nat }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ Œµ }\OtherTok{(}\NormalTok{f z}\OtherTok{))} \OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)}\NormalTok{ ‚å™ }
              \OtherTok{(((}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{))))} 
\NormalTok{                ‚â°‚å© ap }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f z}\OtherTok{)))} \OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)}\NormalTok{ ‚å™ }
\NormalTok{                Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}
\NormalTok{              ‚â°‚å© ap }\OtherTok{(Œª}\NormalTok{ e }\OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{))))}\NormalTok{ ‚â°‚å© e ‚å™ Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))} 
                    \OtherTok{((}\NormalTok{ap }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f z}\OtherTok{)))} \OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{))} 
\NormalTok{                     ‚â°‚å© apComp }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f z}\OtherTok{))}\NormalTok{ f }\OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)}\NormalTok{ ‚å™ }
                     \OtherTok{((}\NormalTok{ap f }\OtherTok{(}\NormalTok{ap }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f z}\OtherTok{))} \OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)))} 
\NormalTok{                     ‚â°‚å© ap }\OtherTok{(}\NormalTok{ap f}\OtherTok{)} \OtherTok{(}\NormalTok{apHtpy }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f z}\OtherTok{))}\NormalTok{ Œ∑}\OtherTok{)}\NormalTok{ ‚å™ }
                     \OtherTok{(}\NormalTok{ap f }\OtherTok{(}\NormalTok{Œ∑ }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ ‚ñ°}\OtherTok{)))}\NormalTok{ ‚å™ }
              \OtherTok{(((}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{))))} 
\NormalTok{                ‚â°‚å© ap f }\OtherTok{(}\NormalTok{Œ∑ }\OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ ‚å™}
\NormalTok{                Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ ‚ñ°}\OtherTok{)))))}

\NormalTok{pairEquiv1 }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì ‚Ñì\textquotesingle{} Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A\textquotesingle{} }\OtherTok{:}\NormalTok{ Type ‚Ñì\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}}
             \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ A\textquotesingle{}}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isEquiv f}
             \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ Œ£ A }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ B }\OtherTok{(}\NormalTok{f x}\OtherTok{))\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ Œ£ A\textquotesingle{} B}\OtherTok{\}} 
                       \OtherTok{(Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f x , y}\OtherTok{))}
\NormalTok{pairEquiv1 }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ A}\OtherTok{\}} \OtherTok{\{}\NormalTok{A\textquotesingle{} }\OtherTok{=}\NormalTok{ A\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ B}\OtherTok{\}}\NormalTok{ f ef }\OtherTok{=}
\NormalTok{  Iso‚ÜíisEquiv}
    \OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{g x , transp B }\OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{Œµ x}\OtherTok{))}\NormalTok{ y}\OtherTok{))}
\NormalTok{    , }\OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ pairEq }\OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)} \OtherTok{(}\NormalTok{lemma x y}\OtherTok{))} 
\NormalTok{      , }\OtherTok{Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ pairEq }\OtherTok{(}\NormalTok{Œµ x}\OtherTok{)} \OtherTok{(}\NormalTok{symr }\OtherTok{(}\NormalTok{Œµ x}\OtherTok{)}\NormalTok{ y}\OtherTok{)} \OtherTok{)} \OtherTok{)}
  \KeywordTok{where}
\NormalTok{    g }\OtherTok{:}\NormalTok{ A\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ A}
\NormalTok{    g }\OtherTok{=}\NormalTok{ fst }\OtherTok{(}\NormalTok{Iso‚ÜíHAdj }\OtherTok{(}\NormalTok{isEquiv‚ÜíIso ef}\OtherTok{))}
\NormalTok{    Œ∑ }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f x}\OtherTok{)}\NormalTok{ ‚â° x}
\NormalTok{    Œ∑ }\OtherTok{=}\NormalTok{ fst }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{Iso‚ÜíHAdj }\OtherTok{(}\NormalTok{isEquiv‚ÜíIso ef}\OtherTok{)))}
\NormalTok{    Œµ }\OtherTok{:} \OtherTok{(}\NormalTok{y }\OtherTok{:}\NormalTok{ A\textquotesingle{}}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f }\OtherTok{(}\NormalTok{g y}\OtherTok{)}\NormalTok{ ‚â° y}
\NormalTok{    Œµ }\OtherTok{=}\NormalTok{ fst }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{Iso‚ÜíHAdj }\OtherTok{(}\NormalTok{isEquiv‚ÜíIso ef}\OtherTok{))))}
\NormalTok{    œÅ }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ ap f }\OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)}\NormalTok{ ‚â° Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)}
\NormalTok{    œÅ }\OtherTok{=}\NormalTok{ snd }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{Iso‚ÜíHAdj }\OtherTok{(}\NormalTok{isEquiv‚ÜíIso ef}\OtherTok{))))}
\NormalTok{    lemma }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{(}\NormalTok{y }\OtherTok{:}\NormalTok{ B }\OtherTok{(}\NormalTok{f x}\OtherTok{))}
            \OtherTok{‚Üí}\NormalTok{ transp }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ B }\OtherTok{(}\NormalTok{f z}\OtherTok{))} \OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)}
                     \OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ y}\OtherTok{)}
\NormalTok{              ‚â° y}
\NormalTok{    lemma x y }\OtherTok{=} \OtherTok{(}\NormalTok{transp }\OtherTok{(Œª}\NormalTok{ z }\OtherTok{‚Üí}\NormalTok{ B }\OtherTok{(}\NormalTok{f z}\OtherTok{))} \OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)} 
                        \OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ y}\OtherTok{))} 
\NormalTok{                ‚â°‚å© transpAp B f }\OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{)} 
                            \OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ y}\OtherTok{)}\NormalTok{ ‚å™ }
                \OtherTok{(}\NormalTok{ transp B }\OtherTok{(}\NormalTok{ap f }\OtherTok{(}\NormalTok{Œ∑ x}\OtherTok{))} 
                           \OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ y}\OtherTok{)} 
\NormalTok{                ‚â°‚å© ap }\OtherTok{(Œª}\NormalTok{ e }\OtherTok{‚Üí}\NormalTok{ transp B e }
                                \OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ y}\OtherTok{))} 
                      \OtherTok{(}\NormalTok{œÅ x}\OtherTok{)}\NormalTok{ ‚å™ }
                \OtherTok{(} \OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{))} 
                          \OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{)))}\NormalTok{ y}\OtherTok{))} 
\NormalTok{                ‚â°‚å© }\OtherTok{(}\NormalTok{symr }\OtherTok{(}\NormalTok{Œµ }\OtherTok{(}\NormalTok{f x}\OtherTok{))}\NormalTok{ y}\OtherTok{)}\NormalTok{ ‚å™ }
                \OtherTok{(}\NormalTok{y ‚ñ°}\OtherTok{)))}

\NormalTok{pairEquiv2 }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫ Œ∫\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} 
             \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{B\textquotesingle{} }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫\textquotesingle{}}\OtherTok{\}}
             \OtherTok{‚Üí} \OtherTok{(}\NormalTok{g }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x }\OtherTok{‚Üí}\NormalTok{ B\textquotesingle{} x}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{((}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{(}\NormalTok{g x}\OtherTok{))}
             \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ Œ£ A B}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ Œ£ A B\textquotesingle{}}\OtherTok{\}}
                       \OtherTok{(Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{x , g x y}\OtherTok{))}
\NormalTok{pairEquiv2 g eg }\OtherTok{=}
    \KeywordTok{let}\NormalTok{ isog }\OtherTok{=} \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ isEquiv‚ÜíIso }\OtherTok{(}\NormalTok{eg x}\OtherTok{))} 
    \KeywordTok{in}\NormalTok{ Iso‚ÜíisEquiv }\OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{x , fst }\OtherTok{(}\NormalTok{isog x}\OtherTok{)}\NormalTok{ y}\OtherTok{))} 
\NormalTok{                   , }\OtherTok{(} \OtherTok{(Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí} 
\NormalTok{                          pairEq refl }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{isog x}\OtherTok{))}\NormalTok{ y}\OtherTok{))} 
\NormalTok{                     , }\OtherTok{Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí} 
\NormalTok{                         pairEq refl }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{isog x}\OtherTok{))}\NormalTok{ y}\OtherTok{)))}

\NormalTok{pairEquiv }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì ‚Ñì\textquotesingle{} Œ∫ Œ∫\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{A\textquotesingle{} }\OtherTok{:}\NormalTok{ Type ‚Ñì\textquotesingle{}}\OtherTok{\}}
            \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{B\textquotesingle{} }\OtherTok{:}\NormalTok{ A\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ Type Œ∫\textquotesingle{}}\OtherTok{\}}
            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ A\textquotesingle{}}\OtherTok{)} \OtherTok{(}\NormalTok{g }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x }\OtherTok{‚Üí}\NormalTok{ B\textquotesingle{} }\OtherTok{(}\NormalTok{f x}\OtherTok{))}
            \OtherTok{‚Üí}\NormalTok{ isEquiv f }\OtherTok{‚Üí} \OtherTok{((}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{(}\NormalTok{g x}\OtherTok{))}
            \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{\{}\NormalTok{A }\OtherTok{=}\NormalTok{ Œ£ A B}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ Œ£ A\textquotesingle{} B\textquotesingle{}}\OtherTok{\}}
                      \OtherTok{(Œª} \OtherTok{(}\NormalTok{x , y}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f x , g x y}\OtherTok{))}
\NormalTok{pairEquiv f g ef eg }\OtherTok{=} 
\NormalTok{    compIsEquiv }\OtherTok{(}\NormalTok{pairEquiv1 f ef}\OtherTok{)} 
                \OtherTok{(}\NormalTok{pairEquiv2 g eg}\OtherTok{)}

\NormalTok{J }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} \OtherTok{(}\NormalTok{B }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ a ‚â° x }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{)}
    \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{a\textquotesingle{} }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° a\textquotesingle{}}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B a refl }\OtherTok{‚Üí}\NormalTok{ B a\textquotesingle{} e}
\NormalTok{J B refl b }\OtherTok{=}\NormalTok{ b}

\NormalTok{transpPre }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì0 ‚Ñì1 Œ∫0 Œ∫1}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì0}\OtherTok{\}} \OtherTok{\{}\NormalTok{a a\textquotesingle{} }\OtherTok{:}\NormalTok{ A}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫0}\OtherTok{\}}
              \OtherTok{\{}\NormalTok{C }\OtherTok{:}\NormalTok{ Type ‚Ñì1}\OtherTok{\}} \OtherTok{\{}\NormalTok{D }\OtherTok{:}\NormalTok{ C }\OtherTok{‚Üí}\NormalTok{ Type Œ∫1}\OtherTok{\}} \OtherTok{\{}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ C}\OtherTok{\}}
              \OtherTok{(}\NormalTok{mf }\OtherTok{:}\NormalTok{ isMono f}\OtherTok{)} \OtherTok{(}\NormalTok{g }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x }\OtherTok{‚Üí}\NormalTok{ D }\OtherTok{(}\NormalTok{f x}\OtherTok{))}
              \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ f a ‚â° f a\textquotesingle{}}\OtherTok{)} \OtherTok{\{}\NormalTok{b }\OtherTok{:}\NormalTok{ B a}\OtherTok{\}}
              \OtherTok{‚Üí}\NormalTok{ transp D e }\OtherTok{(}\NormalTok{g a b}\OtherTok{)}\NormalTok{ ‚â° g a\textquotesingle{} }\OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{inv mf e}\OtherTok{)}\NormalTok{ b}\OtherTok{)}
\NormalTok{transpPre }\OtherTok{\{}\NormalTok{a }\OtherTok{=}\NormalTok{ a}\OtherTok{\}} \OtherTok{\{}\NormalTok{a\textquotesingle{} }\OtherTok{=}\NormalTok{ a\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{=}\NormalTok{ B}\OtherTok{\}} \OtherTok{\{}\NormalTok{D }\OtherTok{=}\NormalTok{ D}\OtherTok{\}} \OtherTok{\{}\NormalTok{f }\OtherTok{=}\NormalTok{ f}\OtherTok{\}}\NormalTok{ mf g e }\OtherTok{\{}\NormalTok{b }\OtherTok{=}\NormalTok{ b}\OtherTok{\}} \OtherTok{=} 
\NormalTok{    transp D e }\OtherTok{(}\NormalTok{g a b}\OtherTok{)}  
\NormalTok{        ‚â°‚å© ap }\OtherTok{(Œª}\NormalTok{ e\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ transp D e\textquotesingle{} }\OtherTok{(}\NormalTok{g a b}\OtherTok{))} \OtherTok{(}\NormalTok{sym }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{snd mf}\OtherTok{)}\NormalTok{ e}\OtherTok{))}\NormalTok{ ‚å™ }
    \OtherTok{(} \OtherTok{\_}\NormalTok{ ‚â°‚å© }\OtherTok{(}\NormalTok{J }\OtherTok{(Œª}\NormalTok{ x e\textquotesingle{} }\OtherTok{‚Üí}\NormalTok{ transp D }\OtherTok{(}\NormalTok{ap f e\textquotesingle{}}\OtherTok{)} \OtherTok{(}\NormalTok{g a b}\OtherTok{)}\NormalTok{ ‚â° g x }\OtherTok{(}\NormalTok{transp B e\textquotesingle{} b}\OtherTok{))} 
               \OtherTok{(}\NormalTok{inv mf e}\OtherTok{)}\NormalTok{ refl}\OtherTok{)}\NormalTok{ ‚å™ }
    \OtherTok{((}\NormalTok{g a\textquotesingle{} }\OtherTok{(}\NormalTok{transp B }\OtherTok{(}\NormalTok{inv mf e}\OtherTok{)}\NormalTok{ b}\OtherTok{))}\NormalTok{ ‚ñ°}\OtherTok{))}

\KeywordTok{postulate}
\NormalTok{    funext }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} 
             \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{f g }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x}\OtherTok{\}}
             \OtherTok{‚Üí} \OtherTok{((}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f x ‚â° g x}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f ‚â° g}
\NormalTok{    funextr }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} 
              \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{f g }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x}\OtherTok{\}}
              \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ f x ‚â° g x}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ coAp }\OtherTok{(}\NormalTok{funext e}\OtherTok{)}\NormalTok{ ‚â° e}
\NormalTok{    funextl }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} 
              \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{f g }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x}\OtherTok{\}}
              \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ f ‚â° g}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ funext }\OtherTok{(}\NormalTok{coAp e}\OtherTok{)}\NormalTok{ ‚â° e}

\NormalTok{transpD }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{a a\textquotesingle{} }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
          \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x}\OtherTok{)} \OtherTok{(}\NormalTok{e }\OtherTok{:}\NormalTok{ a ‚â° a\textquotesingle{}}\OtherTok{)}
          \OtherTok{‚Üí}\NormalTok{ transp B e }\OtherTok{(}\NormalTok{f a}\OtherTok{)}\NormalTok{ ‚â° f a\textquotesingle{}}
\NormalTok{transpD f refl }\OtherTok{=}\NormalTok{ refl}

\NormalTok{transpHAdj }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì ‚Ñì\textquotesingle{} Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type ‚Ñì\textquotesingle{}}\OtherTok{\}} 
            \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{C }\OtherTok{:}\NormalTok{ B }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{\}}
            \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{g }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{\}} \OtherTok{\{}\NormalTok{h }\OtherTok{:}\NormalTok{ B }\OtherTok{‚Üí}\NormalTok{ A}\OtherTok{\}} 
            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ C }\OtherTok{(}\NormalTok{g x}\OtherTok{))} 
            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e }\OtherTok{:} \OtherTok{(}\NormalTok{y }\OtherTok{:}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{h y}\OtherTok{)}\NormalTok{ ‚â° y}\OtherTok{)}
            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e\textquotesingle{} }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ h }\OtherTok{(}\NormalTok{g x}\OtherTok{)}\NormalTok{ ‚â° x}\OtherTok{)}
            \OtherTok{‚Üí} \OtherTok{(}\NormalTok{e\textquotesingle{}\textquotesingle{} }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ e }\OtherTok{(}\NormalTok{g x}\OtherTok{)}\NormalTok{ ‚â° ap g }\OtherTok{(}\NormalTok{e\textquotesingle{} x}\OtherTok{))}
            \OtherTok{‚Üí}\NormalTok{ transp C }\OtherTok{(}\NormalTok{e }\OtherTok{(}\NormalTok{g a}\OtherTok{))} \OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{g a}\OtherTok{)))}\NormalTok{ ‚â° f a}
\NormalTok{transpHAdj }\OtherTok{\{}\NormalTok{C }\OtherTok{=}\NormalTok{ C}\OtherTok{\}} \OtherTok{\{}\NormalTok{a }\OtherTok{=}\NormalTok{ a}\OtherTok{\}} \OtherTok{\{}\NormalTok{g }\OtherTok{=}\NormalTok{ g}\OtherTok{\}} \OtherTok{\{}\NormalTok{h }\OtherTok{=}\NormalTok{ h}\OtherTok{\}}\NormalTok{ f e e\textquotesingle{} e\textquotesingle{}\textquotesingle{} }\OtherTok{=} 
\NormalTok{    transp C }\OtherTok{(}\NormalTok{e }\OtherTok{(}\NormalTok{g a}\OtherTok{))} \OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{g a}\OtherTok{)))}               
\NormalTok{        ‚â°‚å© ap }\OtherTok{(Œª}\NormalTok{ ee }\OtherTok{‚Üí}\NormalTok{ transp C ee }\OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{g a}\OtherTok{))))} \OtherTok{(}\NormalTok{e\textquotesingle{}\textquotesingle{} a}\OtherTok{)}\NormalTok{ ‚å™ }
    \OtherTok{(}\NormalTok{transp C }\OtherTok{(}\NormalTok{ap g }\OtherTok{(}\NormalTok{e\textquotesingle{} a}\OtherTok{))} \OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{g a}\OtherTok{)))} 
\NormalTok{        ‚â°‚å© sym }\OtherTok{(}\NormalTok{transpAp C g }\OtherTok{(}\NormalTok{e\textquotesingle{} a}\OtherTok{)} \OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{g a}\OtherTok{))))}\NormalTok{ ‚å™ }
    \OtherTok{((}\NormalTok{transp }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ C }\OtherTok{(}\NormalTok{g x}\OtherTok{))} \OtherTok{(}\NormalTok{e\textquotesingle{} a}\OtherTok{)} \OtherTok{(}\NormalTok{f }\OtherTok{(}\NormalTok{h }\OtherTok{(}\NormalTok{g a}\OtherTok{))))} 
\NormalTok{        ‚â°‚å© transpD f }\OtherTok{(}\NormalTok{e\textquotesingle{} a}\OtherTok{)}\NormalTok{ ‚å™}
    \OtherTok{((}\NormalTok{f a}\OtherTok{)}\NormalTok{ ‚ñ°}\OtherTok{)))}

\NormalTok{PreCompEquiv }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì ‚Ñì\textquotesingle{} Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} 
               \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ Type ‚Ñì\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{C }\OtherTok{:}\NormalTok{ B }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}}
               \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isEquiv f }
               \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{\{}\NormalTok{A }\OtherTok{=} \OtherTok{(}\NormalTok{b }\OtherTok{:}\NormalTok{ B}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ C b}\OtherTok{\}} 
                         \OtherTok{\{}\NormalTok{B }\OtherTok{=} \OtherTok{(}\NormalTok{a }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ C }\OtherTok{(}\NormalTok{f a}\OtherTok{)\}} 
                         \OtherTok{(Œª}\NormalTok{ g }\OtherTok{‚Üí} \OtherTok{Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ g }\OtherTok{(}\NormalTok{f a}\OtherTok{))}
\NormalTok{PreCompEquiv }\OtherTok{\{}\NormalTok{C }\OtherTok{=}\NormalTok{ C}\OtherTok{\}}\NormalTok{ f ef }\OtherTok{=}
    \KeywordTok{let} \OtherTok{(}\NormalTok{f‚Åª¬π , l , r , e}\OtherTok{)} \OtherTok{=}\NormalTok{ Iso‚ÜíHAdj }\OtherTok{(}\NormalTok{isEquiv‚ÜíIso ef}\OtherTok{)} 
    \KeywordTok{in}\NormalTok{ Iso‚ÜíisEquiv }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ g b }\OtherTok{‚Üí}\NormalTok{ transp C }\OtherTok{(}\NormalTok{r b}\OtherTok{)} \OtherTok{(}\NormalTok{g }\OtherTok{(}\NormalTok{f‚Åª¬π b}\OtherTok{)))} 
\NormalTok{                   , }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ g }\OtherTok{‚Üí}\NormalTok{ funext }\OtherTok{(Œª}\NormalTok{ b }\OtherTok{‚Üí}\NormalTok{ transpD g }\OtherTok{(}\NormalTok{r b}\OtherTok{)))} 
\NormalTok{                     , }\OtherTok{Œª}\NormalTok{ g }\OtherTok{‚Üí}\NormalTok{ funext }\OtherTok{(Œª}\NormalTok{ a }\OtherTok{‚Üí}\NormalTok{ transpHAdj g r l }
                                             \OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ sym }\OtherTok{(}\NormalTok{e x}\OtherTok{)))))}

\NormalTok{PostCompEquiv }\OtherTok{:} \OtherTok{‚àÄ} \OtherTok{\{}\NormalTok{‚Ñì Œ∫ Œ∫\textquotesingle{}}\OtherTok{\}} \OtherTok{\{}\NormalTok{A }\OtherTok{:}\NormalTok{ Type ‚Ñì}\OtherTok{\}} 
                \OtherTok{‚Üí} \OtherTok{\{}\NormalTok{B }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫}\OtherTok{\}} \OtherTok{\{}\NormalTok{C }\OtherTok{:}\NormalTok{ A }\OtherTok{‚Üí}\NormalTok{ Type Œ∫\textquotesingle{}}\OtherTok{\}}
                \OtherTok{‚Üí} \OtherTok{(}\NormalTok{f }\OtherTok{:} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x }\OtherTok{‚Üí}\NormalTok{ C x}\OtherTok{)} \OtherTok{‚Üí} \OtherTok{((}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{(}\NormalTok{f x}\OtherTok{))}
                \OtherTok{‚Üí}\NormalTok{ isEquiv }\OtherTok{\{}\NormalTok{A }\OtherTok{=} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ B x}\OtherTok{\}} 
                          \OtherTok{\{}\NormalTok{B }\OtherTok{=} \OtherTok{(}\NormalTok{x }\OtherTok{:}\NormalTok{ A}\OtherTok{)} \OtherTok{‚Üí}\NormalTok{ C x}\OtherTok{\}}
                          \OtherTok{(Œª}\NormalTok{ g x }\OtherTok{‚Üí}\NormalTok{ f x }\OtherTok{(}\NormalTok{g x}\OtherTok{))}
\NormalTok{PostCompEquiv f ef }\OtherTok{=} 
    \OtherTok{(} \OtherTok{(} \OtherTok{(Œª}\NormalTok{ g x }\OtherTok{‚Üí}\NormalTok{ fst }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{ef x}\OtherTok{))} \OtherTok{(}\NormalTok{g x}\OtherTok{))}
\NormalTok{      , }\OtherTok{Œª}\NormalTok{ g }\OtherTok{‚Üí}\NormalTok{ funext }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ snd }\OtherTok{(}\NormalTok{fst }\OtherTok{(}\NormalTok{ef x}\OtherTok{))} \OtherTok{(}\NormalTok{g x}\OtherTok{))))}
\NormalTok{    , }\OtherTok{(} \OtherTok{(Œª}\NormalTok{ g x }\OtherTok{‚Üí}\NormalTok{ fst }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{ef x}\OtherTok{))} \OtherTok{(}\NormalTok{g x}\OtherTok{))} 
\NormalTok{      , }\OtherTok{Œª}\NormalTok{ g }\OtherTok{‚Üí}\NormalTok{ funext }\OtherTok{(Œª}\NormalTok{ x }\OtherTok{‚Üí}\NormalTok{ snd }\OtherTok{(}\NormalTok{snd }\OtherTok{(}\NormalTok{ef x}\OtherTok{))} \OtherTok{(}\NormalTok{g x}\OtherTok{)))}
\end{Highlighting}
\end{Shaded}


\makeatletter
\@ifclassloaded{memoir}{\ifartopt\else\backmatter\fi}{\backmatter}
\makeatother
\end{document}
